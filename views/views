{"blocks":[{"type":"codeTool","data":{"codeData":{"value":"md`# Introduction to views\n\nIn Observable, a *view* is a user interface element that directly controls a *value* in the notebook. A view consists of two parts:\n\n* The *view*, which is typically an interactive DOM element (see [Introduction to HTML](https://observablehq.com/@observablehq/introduction-to-html) for more about DOM elements).\n* The *value*, which is any JavaScript value.\n\nFor example, a view could be an [Observable range input](https://observablehq.com/@observablehq/input-range?collection=@observablehq/inputs) whose value is a number:`","pinCode":false,"dname":"4a1095ed-4b91-4afd-9552-578c9000e708","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof x = (Inputs.range([0,1]))","pinCode":false,"dname":"b72c47cd-c0a8-48db-87f0-2249d731a823","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"x","pinCode":false,"dname":"216a2a50-bb30-4f32-819b-8b876b6a0fd1","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`A view could be a text input whose value is a string:`","pinCode":false,"dname":"67c7efc1-0411-47c4-b930-ac2bd6138ddb","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof message = (Inputs.text({placeholder: \"Say hello\"}))","pinCode":false,"dname":"e32187bd-7a2f-4c3b-a8ea-1f0f8d6baf1e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"message","pinCode":false,"dname":"b0552fb5-97ee-4056-a053-ceef77eb6592","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"dropdownMenu = (md `A view could be a dropdown menu to choose from a set of options:`)","pinCode":false,"dname":"eac86313-d713-4fb2-9070-2a09951957d9","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof color = (Inputs.select([\"red\", \"orange\", \"yellow\", \"green\", \"blue\", \"violet\"], {value: \"green\"}))","pinCode":false,"dname":"b253787d-8537-4f2d-a4cf-eaad1b8d4dfc","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"color","pinCode":false,"dname":"08a7efa8-0e43-47b2-b511-00ab7aade7c2","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`So far we've made use of [Observable Inputs](https://observablehq.com/@observablehq/inputs?collection=@observablehq/inputs)—range sliders, dropdowns, and other lightweight interface components that help you explore data and build interactivity into your notebook. But views aren't limited to these input types. A view can have any visual representation you desire, and any value, too. You can use DOM elements to build more complex views.`","pinCode":false,"dname":"98d453e7-2aee-4178-b72e-4dc245280806","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`For example, a view could be a map that lets you specify any point on Earth:`","pinCode":false,"dname":"2943a574-909b-4740-87d2-6e0b3f663530","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof point = {\n  const height = width / 2;\n  const context = DOM.context2d(width, height);\n  const projection = d3.geoEqualEarth().fitSize([width, height], {type: \"Sphere\"});\n  const path = d3.geoPath(projection, context);\n  let mousedown = false;\n\n  context.beginPath(), path(graticule), context.strokeStyle = \"#ccc\", context.stroke();\n  context.beginPath(), path(land), context.fill();\n  context.beginPath(), path(sphere), context.strokeStyle = \"#000\", context.stroke();\n  context.lineWidth = 2, context.strokeStyle = \"#f00\";\n  const image = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n\n  function render(coordinates) {\n    context.canvas.value = coordinates;\n    context.clearRect(0, 0, width, height);\n    context.putImageData(image, 0, 0);\n    context.beginPath(), path({type: \"Point\", coordinates}), context.stroke();\n  }\n\n  context.canvas.onmousedown = event => {\n    mousedown = true;\n    context.canvas.onmousemove(event);\n  };\n\n  context.canvas.onmousemove = ({layerX, layerY}) => {\n    if (!mousedown) return;\n    render(projection.invert([layerX, layerY]));\n    context.canvas.dispatchEvent(new CustomEvent(\"input\"));\n  };\n\n  context.canvas.onmouseup = event => {\n    mousedown = false;\n  };\n\n  render([0, 0]);\n  return context.canvas;\n}","pinCode":false,"dname":"0e712889-f6a2-4b20-8c10-c53bf7c31e42","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"point","pinCode":false,"dname":"aab5fb80-f0b4-46db-918b-97160a8dc151","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`A view could be a blank canvas for the user to draw a squiggle:`","pinCode":false,"dname":"17e5e4cf-d2a7-45ab-8a52-c39a8d28beed","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof stroke = {\n  const height = 280;\n  const context = DOM.context2d(width, height);\n  const curve = d3.curveBasis(context);\n  const canvas = context.canvas;\n  let stroke = [[102,211],[103,210],[108,200],[120,187],[142,154],[159,121],[173,90],[185,66],[192,52],[197,41],[199,35],[199,33],[199,32],[199,31],[199,31],[199,30],[199,31],[195,39],[187,53],[177,75],[166,103],[155,129],[147,144],[135,171],[132,178],[124,194],[120,203],[118,208],[116,213],[115,216],[114,218],[114,219],[113,220],[113,218],[114,214],[122,203],[134,185],[141,175],[148,168],[154,161],[159,157],[163,155],[167,153],[169,153],[171,153],[172,153],[173,155],[173,162],[173,171],[173,181],[173,193],[173,204],[173,210],[173,215],[174,218],[176,220],[178,221],[179,221],[183,222],[189,222],[197,216],[209,205],[222,188],[230,174],[235,164],[238,157],[239,152],[239,149],[238,148],[235,148],[230,148],[225,149],[221,153],[218,159],[216,165],[216,172],[216,180],[218,188],[224,196],[230,203],[236,206],[246,209],[253,209],[259,206],[265,199],[271,190],[280,174],[283,168],[287,159],[289,155],[290,151],[293,145],[296,139],[303,128],[310,113],[315,100],[320,86],[320,79],[321,70],[319,67],[312,66],[303,66],[291,74],[282,86],[273,102],[267,121],[262,141],[260,162],[260,176],[260,195],[263,210],[269,220],[275,225],[282,227],[288,226],[299,216],[311,192],[317,172],[328,139],[334,117],[341,92],[345,72],[347,65],[348,55],[349,50],[349,48],[347,47],[344,47],[340,51],[332,62],[327,72],[319,90],[314,109],[310,129],[308,152],[308,169],[308,188],[309,205],[314,218],[319,226],[326,231],[331,232],[337,232],[341,228],[345,223],[348,217],[351,211],[355,205],[357,201],[360,195],[361,192],[361,187],[362,182],[362,180],[362,178],[362,177],[362,176],[362,175],[361,175],[359,174],[358,174],[356,174],[355,174],[353,174],[352,175],[351,176],[349,180],[348,185],[347,190],[347,197],[347,203],[349,206],[353,208],[358,209],[362,209],[366,204],[368,197],[370,189],[370,181],[370,176],[370,171],[369,167],[368,164],[367,162],[366,162],[365,162],[365,162],[365,162],[366,162],[371,162],[379,162],[389,162],[399,161],[413,154],[421,146],[425,142]];\n\n  context.beginPath();\n  curve.lineStart();\n  for (const p of stroke) curve.point(...p);\n  curve.lineEnd();\n  context.stroke();\n\n  canvas.value = stroke;\n  stroke = null;\n\n  canvas.ontouchstart =\n  canvas.onmousedown = event => {\n    stroke = canvas.value = [];\n    canvas.onmousemove(event);\n  };\n\n  canvas.ontouchend =\n  canvas.onmouseup = () => {\n    stroke = null;\n  };\n\n  canvas.ontouchmove =\n  canvas.onmousemove = event => {\n    if (stroke === null) return;\n    event.preventDefault();\n    stroke.push([event.layerX, event.layerY]);\n    context.clearRect(0, 0, width, height);\n    context.beginPath();\n    curve.lineStart();\n    for (const p of stroke) curve.point(...p);\n    curve.lineEnd();\n    context.stroke();\n    canvas.dispatchEvent(new CustomEvent(\"input\"));\n  };\n\n  return canvas;\n}","pinCode":false,"dname":"dee43a8a-bbaf-41e4-8209-e1bc893ef8a2","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"stroke","pinCode":false,"dname":"4c4de1c3-4564-4d7d-a7b1-60a013a5f7fb","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`If there is a value you’d like the user to control in your notebook, represent that value as a view. By doing so, you won’t need to manage event listeners and mutable state—you can simply refer to the value, and whenever the user changes it, your code will run automatically. For example, in the color dropdown menu you saw earlier, the selected color is <span style=\"display:inline-block;background-color:${color.toLowerCase()};width:1em;height:1em;\"></span> ${color}; if you [go back](#dropdownMenu) and select a different color, the color patch in this cell updates.`","pinCode":false,"dname":"9282911d-9b77-4d6a-a900-77f45ed00d23","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`A view’s value is exposed as *element*.value. For example, here's a static view (one whose value never changes), for the purposes of illustration:`","pinCode":false,"dname":"937bad70-3716-4c5e-b86b-b2bdad9e7fcd","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof silly = {\n  const element = htl.html`<div>I am a silly view!</div>`;\n  element.value = \"I am a silly value.\";\n  return element;\n}","pinCode":false,"dname":"5c24fb78-85d6-4dcf-a867-295d72611ea6","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"silly","pinCode":false,"dname":"538edf8f-0650-4888-8688-cd9dcde8d935","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewOf_defined = (md`The \\`viewof\\` operator is just shorthand for defining the view and its value in the same cell. You can define them as separate cells if you prefer:`)","pinCode":false,"dname":"91080885-3897-4832-b21e-70145fda1d67","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"explicitView = (Inputs.range([0,100]))","pinCode":false,"dname":"0d139b19-9c93-42d5-9ada-7590cae024c2","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"explicitValue = (Generators.input(explicitView))","pinCode":false,"dname":"3a79f83c-d7df-4d57-b25e-21f90f2d5f55","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`And, just as you can reference *explicitView* from another cell, you can reference the view defined by \\`viewof\\` from another cell, too. For example, you can refer to the value of the view *x* defined at the top of this notebook:`","pinCode":false,"dname":"eeb70997-08bf-4e00-9047-c877bb6bf714","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md `The value of *x* is ${viewof x.value}.`","pinCode":false,"dname":"00bb1acb-2a01-4c38-b478-c1710adb9a37","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`To trigger the re-evaluation of any cell that references a view's value, the view must emit an *input* event. Here's another silly view that counts clicks (click on the emoji and then read the value of *count* below):`","pinCode":false,"dname":"4e5fb5a1-edd8-4f0f-97a8-0e8a55fb56de","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof count = {\n  const element = html`<div style=\"display: inline-block; font-size: 64px; user-select: none;\">🤪</div>`;\n  element.value = 0;\n  element.onmousedown = () => {\n    element.style.transition = \"none\";\n    element.style.transform = `scale(1.5) rotate(${Math.random() * 90 - 45}deg)`;\n  };\n  element.onclick = () => {\n    ++element.value;\n    element.dispatchEvent(new Event(\"input\", {bubbles: true}));\n    requestAnimationFrame(() => {\n      element.style.transition = \"transform 250ms ease\";\n      element.style.transform = \"inherit\";\n    });\n  };\n  return element;\n}","pinCode":false,"dname":"b7a1fb76-357c-46e5-974b-ca393905849e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"count","pinCode":false,"dname":"42c6fa98-e714-4616-8bee-9393fc5982d8","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`As you might have guessed, the reason that HTML input elements work by default as views is that these elements have a value property and they emit *input* events when you interact with them. (There is a little extra logic for dealing with idiosyncrasies; see the [Generators.input](https://github.com/observablehq/stdlib/blob/master/src/generators/input.js) source for details. And actually, a view doesn’t need to be a DOM element; it only needs to support the [EventTarget interface](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget). For an example of a non-element view, see the [Synchronized Inputs](https://observablehq.com/@observablehq/synchronized-inputs?collection=@observablehq/inputs) notebook.)\n\nNext time you find yourself reaching for an event listener or mutating global state, try a view instead. Now you’re thinking with dataflow.`","pinCode":false,"dname":"d828d9ef-262a-4f67-bc41-75547dead494","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`---\n\n## Appendix`","pinCode":false,"dname":"2732c11f-4ce5-4367-8d62-94aba342459f","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"sphere = ({type: \"Sphere\"})","pinCode":false,"dname":"6a288961-e286-4839-a705-2c170fff0032","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"graticule = (d3.geoGraticule10())","pinCode":false,"dname":"b339452d-2629-4aab-bbcc-2ce1766fb79e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"land = (topojson.feature(world, world.objects.land))","pinCode":false,"dname":"6a7c8887-c8ce-45fb-9b49-3d24274fba40","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"world = (FileAttachment(\"land-50m.json\").json())","pinCode":false,"dname":"c59f2238-cacd-4baf-9e92-09f312b77922","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"topojson = (require(\"topojson-client@3\"))","pinCode":false,"dname":"854cff59-f156-4136-8ea8-b348ea06e169","codeMode":"javascript2"}}}],"version":"2.19.1"}