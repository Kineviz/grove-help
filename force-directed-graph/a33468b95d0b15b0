{"blocks":[{"type":"codeTool","data":{"codeData":{"value":"md`# Color Legend\n\nA simple legend for a [color scale](/@d3/color-schemes). Supports [continuous](/@d3/continuous-scales), [sequential](/@d3/sequential-scales), [diverging](/@d3/diverging-scales), [quantize, quantile, threshold](/@d3/quantile-quantize-and-threshold-scales) and [ordinal](/@d3/d3-scaleordinal) scales. To use:\n\n~~~js\nimport {Legend, Swatches} from \"@d3/color-legend\"\n~~~\n\nThen call the legend function as shown below. (For ordinal scales, also consider the swatches function.)`","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleSequential([0, 100], d3.interpolateViridis), {\n  title: \"Temperature (°F)\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleSequentialSqrt([0, 1], d3.interpolateTurbo), {\n  title: \"Speed (kts)\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleDiverging([-0.1, 0, 0.1], d3.interpolatePiYG), {\n  title: \"Daily change\",\n  tickFormat: \"+%\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleDivergingSqrt([-0.1, 0, 0.1], d3.interpolateRdBu), {\n  title: \"Daily change\",\n  tickFormat: \"+%\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleSequentialLog([1, 100], d3.interpolateBlues), {\n  title: \"Energy (joules)\",\n  ticks: 10\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleSequentialQuantile(d3.range(100).map(() => Math.random() ** 2), d3.interpolateBlues), {\n  title: \"Quantile\",\n  tickFormat: \".2f\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleSqrt([-100, 0, 100], [\"blue\", \"white\", \"red\"]), {\n  title: \"Temperature (°C)\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleQuantize([1, 10], d3.schemePurples[9]), {\n  title: \"Unemployment rate (%)\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleQuantile(d3.range(1000).map(d3.randomNormal(100, 20)), d3.schemeSpectral[9]), {\n  title: \"Height (cm)\",\n  tickFormat: \".0f\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleThreshold([2.5, 3.1, 3.5, 3.9, 6, 7, 8, 9.5], d3.schemeRdBu[9]), {\n  title: \"Unemployment rate (%)\",\n  tickSize: 0\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend(d3.scaleOrdinal([\"<10\", \"10-19\", \"20-29\", \"30-39\", \"40-49\", \"50-59\", \"60-69\", \"70-79\", \"≥80\"], d3.schemeSpectral[10]), {\n  title: \"Age (years)\",\n  tickSize: 0\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"md`But wait, there’s more!\n\nHow about swatches for ordinal color scales? Both variable-width swatches and [column layout](https://developer.mozilla.org/en-US/docs/Web/CSS/columns) are supported.`","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Swatches(d3.scaleOrdinal([\"blueberries\", \"oranges\", \"apples\"], d3.schemeCategory10))","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Swatches(d3.scaleOrdinal([\"Wholesale and Retail Trade\", \"Manufacturing\", \"Leisure and hospitality\", \"Business services\", \"Construction\", \"Education and Health\", \"Government\", \"Finance\", \"Self-employed\", \"Other\"], d3.schemeTableau10), {\n  columns: \"180px\"\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"md`---\n\n## Implementation`","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Legend = (function Legend(color, {\n  title,\n  tickSize = 6,\n  width = 320, \n  height = 44 + tickSize,\n  marginTop = 18,\n  marginRight = 0,\n  marginBottom = 16 + tickSize,\n  marginLeft = 0,\n  ticks = width / 64,\n  tickFormat,\n  tickValues\n} = {}) {\n\n  function ramp(color, n = 256) {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = n;\n    canvas.height = 1;\n    const context = canvas.getContext(\"2d\");\n    for (let i = 0; i < n; ++i) {\n      context.fillStyle = color(i / (n - 1));\n      context.fillRect(i, 0, 1, 1);\n    }\n    return canvas;\n  }\n\n  const svg = d3.create(\"svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .attr(\"viewBox\", [0, 0, width, height])\n      .style(\"overflow\", \"visible\")\n      .style(\"display\", \"block\");\n\n  let tickAdjust = g => g.selectAll(\".tick line\").attr(\"y1\", marginTop + marginBottom - height);\n  let x;\n\n  // Continuous\n  if (color.interpolate) {\n    const n = Math.min(color.domain().length, color.range().length);\n\n    x = color.copy().rangeRound(d3.quantize(d3.interpolate(marginLeft, width - marginRight), n));\n\n    svg.append(\"image\")\n        .attr(\"x\", marginLeft)\n        .attr(\"y\", marginTop)\n        .attr(\"width\", width - marginLeft - marginRight)\n        .attr(\"height\", height - marginTop - marginBottom)\n        .attr(\"preserveAspectRatio\", \"none\")\n        .attr(\"xlink:href\", ramp(color.copy().domain(d3.quantize(d3.interpolate(0, 1), n))).toDataURL());\n  }\n\n  // Sequential\n  else if (color.interpolator) {\n    x = Object.assign(color.copy()\n        .interpolator(d3.interpolateRound(marginLeft, width - marginRight)),\n        {range() { return [marginLeft, width - marginRight]; }});\n\n    svg.append(\"image\")\n        .attr(\"x\", marginLeft)\n        .attr(\"y\", marginTop)\n        .attr(\"width\", width - marginLeft - marginRight)\n        .attr(\"height\", height - marginTop - marginBottom)\n        .attr(\"preserveAspectRatio\", \"none\")\n        .attr(\"xlink:href\", ramp(color.interpolator()).toDataURL());\n\n    // scaleSequentialQuantile doesn’t implement ticks or tickFormat.\n    if (!x.ticks) {\n      if (tickValues === undefined) {\n        const n = Math.round(ticks + 1);\n        tickValues = d3.range(n).map(i => d3.quantile(color.domain(), i / (n - 1)));\n      }\n      if (typeof tickFormat !== \"function\") {\n        tickFormat = d3.format(tickFormat === undefined ? \",f\" : tickFormat);\n      }\n    }\n  }\n\n  // Threshold\n  else if (color.invertExtent) {\n    const thresholds\n        = color.thresholds ? color.thresholds() // scaleQuantize\n        : color.quantiles ? color.quantiles() // scaleQuantile\n        : color.domain(); // scaleThreshold\n\n    const thresholdFormat\n        = tickFormat === undefined ? d => d\n        : typeof tickFormat === \"string\" ? d3.format(tickFormat)\n        : tickFormat;\n\n    x = d3.scaleLinear()\n        .domain([-1, color.range().length - 1])\n        .rangeRound([marginLeft, width - marginRight]);\n\n    svg.append(\"g\")\n      .selectAll(\"rect\")\n      .data(color.range())\n      .join(\"rect\")\n        .attr(\"x\", (d, i) => x(i - 1))\n        .attr(\"y\", marginTop)\n        .attr(\"width\", (d, i) => x(i) - x(i - 1))\n        .attr(\"height\", height - marginTop - marginBottom)\n        .attr(\"fill\", d => d);\n\n    tickValues = d3.range(thresholds.length);\n    tickFormat = i => thresholdFormat(thresholds[i], i);\n  }\n\n  // Ordinal\n  else {\n    x = d3.scaleBand()\n        .domain(color.domain())\n        .rangeRound([marginLeft, width - marginRight]);\n\n    svg.append(\"g\")\n      .selectAll(\"rect\")\n      .data(color.domain())\n      .join(\"rect\")\n        .attr(\"x\", x)\n        .attr(\"y\", marginTop)\n        .attr(\"width\", Math.max(0, x.bandwidth() - 1))\n        .attr(\"height\", height - marginTop - marginBottom)\n        .attr(\"fill\", color);\n\n    tickAdjust = () => {};\n  }\n\n  svg.append(\"g\")\n      .attr(\"transform\", `translate(0,${height - marginBottom})`)\n      .call(d3.axisBottom(x)\n        .ticks(ticks, typeof tickFormat === \"string\" ? tickFormat : undefined)\n        .tickFormat(typeof tickFormat === \"function\" ? tickFormat : undefined)\n        .tickSize(tickSize)\n        .tickValues(tickValues))\n      .call(tickAdjust)\n      .call(g => g.select(\".domain\").remove())\n      .call(g => g.append(\"text\")\n        .attr(\"x\", marginLeft)\n        .attr(\"y\", marginTop + marginBottom - height - 6)\n        .attr(\"fill\", \"currentColor\")\n        .attr(\"text-anchor\", \"start\")\n        .attr(\"font-weight\", \"bold\")\n        .attr(\"class\", \"title\")\n        .text(title));\n\n  return svg.node();\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"legend = (function legend({color, ...options}) {\n  return Legend(color, options);\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"Swatches = (function Swatches(color, {\n  columns = null,\n  format,\n  unknown: formatUnknown,\n  swatchSize = 15,\n  swatchWidth = swatchSize,\n  swatchHeight = swatchSize,\n  marginLeft = 0\n} = {}) {\n  const id = `-swatches-${Math.random().toString(16).slice(2)}`;\n  const unknown = formatUnknown == null ? undefined : color.unknown();\n  const unknowns = unknown == null || unknown === d3.scaleImplicit ? [] : [unknown];\n  const domain = color.domain().concat(unknowns);\n  if (format === undefined) format = x => x === unknown ? formatUnknown : x;\n\n  function entity(character) {\n    return `&#${character.charCodeAt(0).toString()};`;\n  }\n\n  if (columns !== null) return htl.html`<div style=\"display: flex; align-items: center; margin-left: ${+marginLeft}px; min-height: 33px; font: 10px sans-serif;\">\n  <style>\n\n.${id}-item {\n  break-inside: avoid;\n  display: flex;\n  align-items: center;\n  padding-bottom: 1px;\n}\n\n.${id}-label {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: calc(100% - ${+swatchWidth}px - 0.5em);\n}\n\n.${id}-swatch {\n  width: ${+swatchWidth}px;\n  height: ${+swatchHeight}px;\n  margin: 0 0.5em 0 0;\n}\n\n  </style>\n  <div style=${{width: \"100%\", columns}}>${domain.map(value => {\n    const label = `${format(value)}`;\n    return htl.html`<div class=${id}-item>\n      <div class=${id}-swatch style=${{background: color(value)}}></div>\n      <div class=${id}-label title=${label}>${label}</div>\n    </div>`;\n  })}\n  </div>\n</div>`;\n\n  return htl.html`<div style=\"display: flex; align-items: center; min-height: 33px; margin-left: ${+marginLeft}px; font: 10px sans-serif;\">\n  <style>\n\n.${id} {\n  display: inline-flex;\n  align-items: center;\n  margin-right: 1em;\n}\n\n.${id}::before {\n  content: \"\";\n  width: ${+swatchWidth}px;\n  height: ${+swatchHeight}px;\n  margin-right: 0.5em;\n  background: var(--color);\n}\n\n  </style>\n  <div>${domain.map(value => htl.html`<span class=\"${id}\" style=\"--color: ${color(value)}\">${format(value)}</span>`)}</div>`;\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"swatches = (function swatches({color, ...options}) {\n  return Swatches(color, options);\n})","pinCode":false}}}],"version":"2.19.1"}