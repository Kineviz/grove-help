{"blocks":[{"type":"codeTool","data":{"codeData":{"value":"md`# Cross-Origin Images\n\nBecause Observable runs in a sandbox, you need to use [CORS-enabled images](https://developer.mozilla.org/docs/Web/HTML/CORS_enabled_image) if you want to render them to a Canvas or use them to create a WebGL texture.`","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"fetchImage = (function fetchImage(src) {\n  return new Promise((resolve, reject) => {\n    const image = new Image;\n    image.crossOrigin = \"anonymous\";\n    image.src = src;\n    image.onload = () => resolve(image);\n    image.onerror = reject;\n  });\n})","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"md`Try commenting out the *image*.crossOrigin line above. You should see a security error below because the canvas has been tainted by cross-origin data.`","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"image = (fetchImage(\"https://gist.githubusercontent.com/mbostock/9511ae067889eefa5537eedcbbf87dab/raw/944b6e5fe8dd535d6381b93d88bf4a854dac53d4/mona-lisa.jpg\"))","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"{\n  const context = DOM.context2d(width, height, 1);\n  context.drawImage(image, 0, 0, width, height);\n  const buffer = context.getImageData(0, 0, width, height);\n  for (let y = 0, i = 0; y < height; ++y) {\n    for (let x = 0; x < width; ++x, i += 4) {\n      buffer.data[i + 0] = 255 - buffer.data[i + 0];\n      buffer.data[i + 1] = 255 - buffer.data[i + 1];\n      buffer.data[i + 2] = 255 - buffer.data[i + 2];\n    }\n  }\n  context.putImageData(buffer, 0, 0);\n  return context.canvas;\n}","pinCode":false}}},{"type":"codeTool","data":{"codeData":{"value":"height = (Math.round(width / image.naturalWidth * image.naturalHeight))","pinCode":false}}}],"version":"2.19.1"}