{"blocks":[{"type":"codeTool","data":{"codeData":{"value":"md`# p5\n\n> [p5.js](https://p5js.org/) is a JavaScript library that starts with the original goal of Processing, to make coding accessible for artists, designers, educators, and beginners, and reinterprets this for today's web.\n\nThis notebook demonstrates how you can use p5.js in Observable. There are a few tricks involved, because p5.js is optimized to be the only script on a webpage - its examples mostly use ‘global mode,’ a strategy that makes programs very simple and terse, but doesn’t allow for multiple programs on a page. Observable is all about making notebooks relatively modular and isolated, so we’ll use p5’s _instance mode_ instead.\n\nYou can import the p5 helper function from this notebook like\n\n${copiable(md`\\`\\`\\`js\nimport {p5} from \"@tmcw/p5\";\n\\`\\`\\``)}\n\nYou can also [fork this basic example](https://beta.observablehq.com/@tmcw/p5-basic-example) to get started quickly - don’t forget to rename it by changing the title in the first cell.\n\nThis function:\n\n- Loads p5.js\n- Cleans up after sketches when you update their code. This is essential, because otherwise multiple draw() loops will be going at the same time.\n\n### Basic example:`","pinCode":false,"dname":"ef9ec88f-39b1-4bc9-a920-5b8e82f37e1d","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"p5(sketch => {\n  let system;\n  const c = sketch.color('#DC3F74');\n  sketch.setup = function() {\n    sketch.createCanvas(640, 300);\n    sketch.textAlign(sketch.CENTER);\n    sketch.textFont('sans-serif');\n    sketch.textStyle(sketch.BOLD);\n  };\n  sketch.draw = function() {\n    sketch.translate(sketch.millis() / 10 % sketch.width, sketch.height / 2);\n    sketch.background(viewof background.valueAsNumber);\n    sketch.fill(c).textSize(100);\n    sketch.text('p5.js', 0, 0);\n  };\n})","pinCode":false,"dname":"bc504f38-95de-4268-acfa-f9b6623f3c63","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"viewof background = (html`<input type='range' min=0 max=255 value=255 />`)","pinCode":false,"dname":"598b8d3d-9773-48d6-aac7-3d6cd41fdb0a","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`And here’s an example of an input that affects the sketch above. Note that we’re doing kind of a trick here: the input is called background, and the sketch references it like:\n\n\\`\\`\\`js\nviewof background.valueAsNumber\n\\`\\`\\`\n\nSo what we’re doing is referring to the curent value of this range slider, whatever it is, without wiring _updates_ from the range slider to the sketch. So when you move the slider, the sketch doesn’t re-render. This is because p5 itself manages when the sketch re-renders (the run-loop), and all we want to do is to expose a value that is read every time that the picture is drawn.`","pinCode":false,"dname":"f4191154-5794-47ed-b10a-e0d3a7995449","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`For those interested, here’s how the helper works.`","pinCode":false,"dname":"13d2a30b-7222-432c-9200-e88d148079ed","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"p5 = (function* p5(sketch) {\n  const element = DOM.element('div');\n  \n  // p5.js really likes its target element to already be in the DOM, not just\n  // floating around detached. So, before we call P5, we yield it, which puts\n  // in the DOM.\n  yield element;\n  \n  // This is ‘instance mode’ in p5 jargon: instead of relying on lots of\n  // globals, we create a sketch that has its own copy of everything under p5.\n  const instance = new P5(sketch, element, true);\n  \n  // This is the tricky part: when you run P5(sketch, element), it starts a\n  // loop that updates the drawing a bunch of times a second. If we were just\n  // to call P5 repeatedly with different arguments, the loops would all keep\n  // running, one on top of the other. So what we do is we use this cell\n  // as a generator, and then when that generator is interrupted, like\n  // when you update the code in the sketch() method, then we call instance.remove()\n  // to clean it up.\n  try {\n    while (true) {\n      yield element;\n    }\n  } finally {\n    instance.remove();\n  }\n})","pinCode":false,"dname":"03d06e56-2df8-470c-89d1-b1e72e928cbf","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`## More advanced example:\n\nHere’s how you use this code: call the p5 function with your sketch code. Note that, because we’re in [instance mode, not global mode](https://github.com/processing/p5.js/wiki/Global-and-instance-mode), you’ll need to call, for instance, \\`sketch.color\\` instead of just \\`color()\\`. That’s pretty likely also what you’ll end up doing if you use p5.js on any webpage.\n\nThis example is taken from the [Particle System](https://p5js.org/examples/simulate-particle-system.html), example, which in turn is from [The Nature of Code](http://natureofcode.com/). I’ve modernized it a little bit by making the classes into proper JavaScript classes, and making it work in instance mode.`","pinCode":false,"dname":"9239d585-8ee6-4b86-bd11-6974b7e29f7b","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"p5(sketch => {\n  let system;\n  sketch.setup = function() {\n    sketch.createCanvas(400, 300);\n    system = new ParticleSystem(sketch, sketch.createVector(sketch.width/2, 50));\n  };\n  sketch.draw = function() {\n    sketch.background(51);\n    system.addParticle();\n    system.run();\n  }\n})","pinCode":false,"dname":"a3e0ecb5-c60d-4426-b03d-b368f5c3357e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"Particle = (class Particle {\n  constructor(p5, position) {\n    this.p5 = p5;\n    this.acceleration = this.p5.createVector(0, 0.05);\n    this.velocity = this.p5.createVector(this.p5.random(-1, 1), this.p5.random(-1, 0));\n    this.position = position.copy();\n    this.lifespan = 255;\n  }\n  run() {\n    this.update();\n    this.display();\n  }\n  // Method to update position\n  update() {\n    this.velocity.add(this.acceleration);\n    this.position.add(this.velocity);\n    this.lifespan -= 2;\n  }\n  // Method to display\n  display() {\n    this.p5.stroke(200, this.lifespan);\n    this.p5.strokeWeight(2);\n    this.p5.fill(127, this.lifespan);\n    this.p5.ellipse(this.position.x, this.position.y, 12, 12);\n  }\n  // Is the particle still useful?\n  isDead() {\n    return this.lifespan < 0;\n  }\n})","pinCode":false,"dname":"21bb97b0-9216-4546-99a4-de29f7390308","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"ParticleSystem = (class ParticleSystem {\n  constructor(p5, position) {\n    this.p5 = p5;\n    this.origin = position.copy();\n    this.particles = [];\n  }\n  addParticle() {\n    this.particles.push(new Particle(this.p5, this.origin));\n  }\n  run() {\n    this.particles = this.particles.filter(particle => {\n      particle.run();\n      return !particle.isDead();\n    });\n  }\n})","pinCode":false,"dname":"cd1bbfd1-0a6a-482a-9614-9045ed85ea08","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"P5 = (require('https://unpkg.com/p5@1.2.0/lib/p5.js'))","pinCode":false,"dname":"9c7a4381-da1a-43d1-9640-8a144ad87d3d","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`This code is just used to make the \\`import\\` statement in the top part of this notebook copiable with just a click.`","pinCode":false,"dname":"044095a8-c578-4267-88fc-1709dd3fbff0","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"import { copiable,style }  from './copiable'","pinCode":false,"dname":"761dcbb3-403d-4cd1-aa3a-47c106c5a683","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"style","pinCode":false,"dname":"56823072-d11c-46cc-8739-37c16cbe8946","codeMode":"javascript2"}}}],"version":"2.19.1"}