{"blocks":[{"type":"codeTool","data":{"codeData":{"value":"md`# File Attachments\n\n<figure>\n  <img src=\"${await FileAttachment(\"national-archive.jpg\").url()}\" style=\"background: #6d6359; width: 640px; height: 395px; max-height: calc(0.618 * (100vw - 28px));\">\n  <figcaption>Files, IRL. Photo: [EduVolunteer/Wikimedia](https://commons.wikimedia.org/wiki/File:A_corridor_of_files_at_The_National_Archives_UK.jpg)</figcaption>\n</figure>\n\n${classicVsNextFiles}`","pinCode":false,"dname":"9dafbbb7-013b-4bb7-a098-7bd56414e4cb","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`The quickest way to work with small-ish datasets in a notebook is to attach a file. Files in Grove can be used for a variety of purposes besides data too, such as videos or images (like the one above!).\n\nFile attachments behave like you expect: files are private when notebooks are private, files are copied when you fork or merge, files can be reused across notebooks through imports, and you can go back in time in notebook history. And because Grove is designed for tinkering, you can even play with your local files in other people’s notebooks, then fork to upload your files and save your work.`","pinCode":false,"dname":"66bc737e-7a45-4eb2-85f1-eb0a6e881224","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`(If you want to work with live data, we recommend ${Link(\"databases/databases\",\"database clients\")} to talk to databases, or ${Link(\"secrets/secrets\",\"secrets\")} to talk to API servers.)`","pinCode":false,"dname":"bf48d259-0f7c-44dd-a0e2-7b061d46d5d0","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`### Attaching files\n\nWe offer several convenient ways to attach files.\n\nWhile editing a cell, hit ${keys(\"Cmd-Shift-U\")} to choose a local file or files. This will automatically insert the code to reference these files at the caret, and if you own the notebook, the files will immediately start uploading.\n\nOpen the **Data** pane by clicking the <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"\" stroke-width=\"2\"><path d=\"M7.19855 2.52175L7.88131 1.79111L7.19855 2.52175ZM12.6 11.7764L13.2581 11.0234L12.6 11.7764ZM5.34191 6.76078L11.9419 12.5293L13.2581 11.0234L6.65809 5.2549L5.34191 6.76078ZM10.8958 13.6864L3.35462 6.63385L1.98852 8.09459L9.52965 15.1472L10.8958 13.6864ZM6.51578 3.25238L13.8172 10.0755L15.1828 8.61419L7.88131 1.79111L6.51578 3.25238ZM3.08395 3.55474C3.91017 2.45311 5.50967 2.31219 6.51578 3.25238L7.88131 1.79111C6.0058 0.0384695 3.02413 0.301162 1.48395 2.35474L3.08395 3.55474ZM3.35462 6.63385C2.49183 5.82695 2.37516 4.49978 3.08395 3.55474L1.48395 2.35474C0.162683 4.11642 0.380169 6.59044 1.98852 8.09459L3.35462 6.63385ZM11.993 13.6551C11.6977 13.9647 11.2082 13.9786 10.8958 13.6864L9.52965 15.1472C10.6432 16.1886 12.3878 16.1388 13.4402 15.0356L11.993 13.6551ZM11.9419 12.5293C12.2764 12.8216 12.2996 13.3337 11.993 13.6551L13.4402 15.0356C14.5328 13.8903 14.4499 12.0651 13.2581 11.0234L11.9419 12.5293Z\"></path></svg> icon, in the top-right corner of the browser window. From there, click the plus sign next to **File attachments** to select a file from your desktop to attach it.`","pinCode":false,"dname":"6a74cbbe-5773-443c-9857-06546f691a92","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"using = (md`### Using files\n\nTo use a file, first pass the file’s name to the built-in FileAttachment function from the ${Link(\"stdlib/stdlib\",\"Grove standard library\")}.`)","pinCode":false,"dname":"b6456708-92d4-4fde-bbf1-beb1408983ba","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"attachment = (FileAttachment(\"example.json\"))","pinCode":false,"dname":"6d753c5d-cafd-4fe2-92d1-ae290f50c828","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`*In these examples, all of the files are attached to this notebook. You can open the File Attachments pane and download them to inspect them and follow along, or replace them with example files of your own.*`","pinCode":false,"dname":"d883e062-5eac-4aec-aa6d-bc83ef1b1ebd","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Calling FileAttachment doesn’t immediately load the file—the contents are only loaded when you request them. It’s a bit like the [Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch): there are async methods that return the file’s contents in different forms, such as JSON, CSV, or ArrayBuffer. You choose the appropriate method based on how you want to consume the file.\n\nHere are a few examples. First, bog standard JSON.`","pinCode":false,"dname":"051b6b7e-3d1a-4305-ae91-e4f58cacef5d","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"json = (FileAttachment(\"example.json\").json())","pinCode":false,"dname":"31b521fd-8755-46e4-a521-a96fb8c9b734","codeMode":"javascript2","vimEnabled":false,"insertMode":false}}},{"type":"codeTool","data":{"codeData":{"value":"json.hello.world","pinCode":false,"dname":"f9ae304d-894e-4518-9103-beed41735220","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`How about comma-separated values (CSV)? We can do that. (If you want more control over parsing, load the file as text instead, and pass it to your parser of choice. Grove uses [d3-dsv](https://github.com/d3/d3-dsv).)`","pinCode":false,"dname":"fc59af77-2f64-490d-a763-6afc17254ca4","codeMode":"javascript2","vimEnabled":false,"insertMode":false}}},{"type":"codeTool","data":{"codeData":{"value":"data = (FileAttachment(\"example.csv\").csv())","pinCode":false,"dname":"3f11f118-b786-4bf8-8c5e-31da76be5ac8","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"data.columns","pinCode":false,"dname":"d68f6e51-1a1e-413d-bcf2-574beea85857","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`If our CSV is well-typed, we can use [automatic type inference](/@d3/d3-autotype) to convert strings into more specific types such as numbers and dates.`","pinCode":false,"dname":"32b5f38a-f08e-46c8-a9d7-239b2bb4bd47","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"typed = (FileAttachment(\"example.csv\").csv({typed: true}))","pinCode":false,"dname":"ad0bb8f1-2d3c-4fe9-aaac-3e73b7ba18a6","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`If you’d rather have an array of arrays and not treat the first row as the header, use the *array* option. (This can be combined with the *typed* option, too.)`","pinCode":false,"dname":"c527495b-1bf3-4426-9f45-d318e54a8ad7","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"array = (FileAttachment(\"example.csv\").csv({array: true}))","pinCode":false,"dname":"b8539d57-5a0f-4fac-88c8-9e9694940041","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`How about an image? The promise resolves after the image has loaded, making this convenient for manipulating images with Canvas, or loading WebGL textures.`","pinCode":false,"dname":"66abc054-139f-4608-8379-02928ef91e24","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"image = (FileAttachment(\"example.png\").image())","pinCode":false,"dname":"2c6a8193-fb9d-41ff-bbbd-125d0537e8dd","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`To embed the image in Markdown or HTML literals, await it.`","pinCode":false,"dname":"3ca6c4e1-3294-4b03-983f-a59969734f2f","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"html`<figure>\n  ${await FileAttachment(\"the-persistence-of-memory.jpg\").image()}\n  <figcaption>Image: <a href=\"https://en.wikipedia.org/wiki/The_Persistence_of_Memory\">Salvador Dali</a></figcaption>\n</figure>`","pinCode":false,"dname":"d077c678-ac13-46d2-890e-0fdff0e2d387","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`You might want to work with binary data, such as a shapefile or a SQLite database. In these cases, the natural representation is typically an [ArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer).`","pinCode":false,"dname":"0d04bbd1-f54c-4fb9-b9f7-308ab6889b42","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"shapefile = (require(\"shapefile@0.6\"))","pinCode":false,"dname":"d1c1600b-c59b-4d92-8687-c6455604da22","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"collection = (shapefile.read(await FileAttachment(\"example.shp\").arrayBuffer()))","pinCode":false,"dname":"daae9b44-6b39-4e2c-8b16-a0aec4cbf1b0","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`You can also get a [ReadableStream](https://streams.spec.whatwg.org/#rs) if you want to read a file incrementally.`","pinCode":false,"dname":"98622c92-305d-4c00-8d87-6d946dad613e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"chunk = {\n  const stream = await FileAttachment(\"example.shp\").stream();\n  const reader = stream.getReader();\n  let done, value;\n  while (({done, value} = await reader.read()), !done) {\n    yield value;\n  }\n}","pinCode":false,"dname":"987d0c1d-3876-4846-9543-94fbc4ea3435","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`In rare cases (for example, passing a file reference to web worker), you might want a Blob or the URL directly. For example, here’s a link to download a PDF attached to this notebook.`","pinCode":false,"dname":"b9e586de-1209-4cdb-95e3-bbce43d18171","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"html`<a href=\"${await FileAttachment(\"example.pdf\").url()}\" download>Click here to download a PDF.</a>`","pinCode":false,"dname":"04fa37ae-d3d7-45b6-888c-a5d4592ad9ed","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`And here’s a Blob that you might pass to a web worker.`","pinCode":false,"dname":"8f30f428-f45f-480b-b11b-db6dca043977","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"blob = (FileAttachment(\"example.csv\").blob())","pinCode":false,"dname":"46645a3b-2243-4c43-91bb-c33451cd8afc","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Lastly, if you pass an unknown file name to FileAttachment, it throws an error. This is true even if you don’t load the file’s contents because Grove tracks the set of known files using static analysis.`","pinCode":false,"dname":"1395d84b-cd08-425e-a6de-d41ff11f6b2b","codeMode":"javascript2","vimEnabled":false,"insertMode":false}}},{"type":"codeTool","data":{"codeData":{"value":"FileAttachment(\"exemple.txt\")","pinCode":false,"dname":"d93f8e0e-eadb-4ffd-88ea-8535fedcf0c7","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`### How files work\n\nHere are a few more details about files you might want to know.`","pinCode":false,"dname":"5caa6781-ad0d-462c-bd85-5aa7e4bf17bb","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`**Files are local to the notebook.** Files can’t be referenced across notebooks—a given file can be directly accessed only by its notebook. You can, however, import cells that use files across notebooks. Likewise, when you fork a notebook, you’ll get your own copy of any attached files.`","pinCode":false,"dname":"1f68ca17-72a8-42bb-809e-7447d9ddf32b","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`**Files are immutable.** The contents associated with a given file name never change. Instead of replacing a file’s contents, you replace a file, which automatically generates a new name and updates all code references to point to the new file. This preserves [notebook history](/@observablehq/history): you can view any version of your notebook and see the original data, and compare different versions of files.`","pinCode":false,"dname":"14f07a38-44b7-4228-86a4-00ff66d5af9e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`**But, files can be deleted.** While file immutability ensures that you can go back in time to see earlier versions of a notebook, we recognize that there are times when you simply want a file taken down for good. In this case, delete the file from the files pane. This will cause references to the deleted file to error (and break old versions of the notebook).`","pinCode":false,"dname":"740dcfe1-7262-4ba6-b222-2eb3b7b7bb56","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`**File sizes are limited.** Files up to 50 megabytes can be uploaded. There’s also a rolling quota of 1 Gb per user over a 28-day period on uploads. For Teams, the quota is pooled for all editors on the team, so a team with 10 editors has a 10GB quota. There is no cap on the total file size usage per user.`","pinCode":false,"dname":"26fe88a5-5c26-485c-ab68-ff022b6a733e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`**Files are private by default,** just like notebooks. When you publish (or share) a notebook, only the files _currently used_ by the notebook will become public. A file you replaced or stopped using—as long as you no longer reference it—will remain private. See below.`","pinCode":false,"dname":"bb8cecbe-b78e-4976-b3b3-ce548025b8e4","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`**References to files are parsed statically.** We use static analysis to determine which files a notebook uses so that we can automatically publish referenced files when a notebook is published (and *only* referenced files), and similarly copy only referenced files when forking a notebook. The FileAttachment function thus accepts only literal strings; code such as\n\n~~~js\nFileAttachment(\"my\" + \"file.csv\")\n~~~\n\nor similar dynamic invocation is invalid syntax. For details on how this is implemented, see [our parser](https://github.com/observablehq/parser).`","pinCode":false,"dname":"811f357d-fdc1-4ff5-a4d1-528ea91afdb6","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`---\n\n## Appendix`","pinCode":false,"dname":"f6480b6d-6102-46a6-a05b-cc1909a5e0a1","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"keys = (s => html`<span style=\"font-family:var(--sans-serif);font-size:90%;\">${keysText(s)}`)","pinCode":false,"dname":"660aede5-424f-47a9-8d22-11d7cf737b5a","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"import { keys as keysText,mac }  from 'file-attachments/keys'","pinCode":false,"dname":"b369ca54-6c54-4005-b6fc-c9902c6487d5","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"import { classicVsNextFiles }  from 'file-attachments/classic-vs-next-infobox'","pinCode":false,"dname":"1feb6954-8acf-421f-a2cf-52394353121e","codeMode":"javascript2"}}}],"version":"2.19.1"}