{"blocks":[{"type":"codeTool","data":{"codeData":{"value":"md`# How to create a PacMan game with Vega\nThis tutorial details the creation of a PacMan game. A great opportunity to work on responsivity, interactions, and triggers.\n`","pinCode":false,"dname":"22c82254-1f28-41b1-97bc-210d1c388a24","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed = (require(\"vega-embed@6\"))","pinCode":false,"dname":"ced4ea4e-da9a-4f60-86bf-1bb674e8e792","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md `*Ensure the visualization has the focus clicking on it then use Ctrl and the Arrows to move PacMan*`","pinCode":false,"dname":"64e73964-3f55-42ae-a802-9a5f4a37287a","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed({\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 600,\n  \"height\":600,\n  \"background\":\"black\",\n  \"signals\":[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t{\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    },\n    {\n      \"name\":\"score\",\n      \"init\":\"0\",\n      \"on\": [\n        {\"events\":{\"signal\":\"testEaten\"},\"update\":\"testEaten ? score + 10 : score\"},\n        {\"events\":{\"signal\":\"testPowerEaten\"},\"update\":\"testPowerEaten ? score + 50 : score\"},\n        {\"events\":{\"signal\":\"testEatenGhost\"},\"update\":\"testEatenGhost ? score + 100 : score\"},\n        {\"events\":{\"signal\":\"loose\"}, \"force\":true ,\"update\":\"restart ? 0 : score\"}\n      ]\n    },\n    {\n      \"name\":\"highScore\",\n      \"init\":\"0\",\n      \"on\":[\n        {\"events\":{\"signal\":\"score\"}, \"update\":\"max(score,highScore)\"}\n      ]\n    },\n    {\n      \"name\":\"key\",\n      \"on\":[\n        {\n          \"events\":\"window:keydown\", \"update\":\"event.code\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"null\"\n        }\n      ]\n    },\n    {\n      \"name\":\"pacManXOffset\",\n      \"update\":\"key === 'ArrowRight' ? 1 : key === 'ArrowLeft' ? -1 : 0\"\n    },\n    {\n      \"name\":\"pacManYOffset\",\n      \"update\":\"key === 'ArrowUp' ? -1 : key === 'ArrowDown' ? 1 : 0\"\n    },\n    {\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"(!restart && pacManCanMoveX) ?((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset))) : pacManX\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!restart && pacManCanMoveY ?((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset) : pacManY\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManIsOpen\",\n      \"init\":\"true\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!pacManIsOpen\"}\n      ]\n    },\n    {\n      \"name\":\"pacManHasWallX\",\n      \"update\":\"(pacManXOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-true')) || (pacManXOffset>=0 && indata('walls', 'key', (pacManX + 1) + '-' + pacManY + '-true')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManHasWallY\",\n      \"update\":\"(pacManYOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-false')) || (pacManYOffset>=0 && indata('walls', 'key', pacManX + '-' + (pacManY+1) + '-false')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManCanMoveX\",\n      \"update\":\"!pacManHasWallX && !pacManHasGhost\"\n    },\n    {\n      \"name\":\"pacManCanMoveY\",\n      \"update\":\"!pacManHasWallY  && !pacManHasGhost\"\n    },\n    {\n      \"name\":\"pacManHasGhost\",\n      \"update\":\"!superPower && (((pacManX + pacManXOffset === gRedX) && (pacManY + pacManYOffset === gRedY)) || ((pacManX + pacManXOffset === gBlueX) && (pacManY + pacManYOffset === gBlueY)) || ((pacManX + pacManXOffset === gGreenX) && (pacManY + pacManYOffset === gGreenY)) || ((pacManX + pacManXOffset === gOrangeX) && (pacManY + pacManYOffset === gOrangeY)))\"\n    },\n    {\n      \"name\":\"win\",\n      \"update\":\"length(data('gums')) + length(data('powerGums')) === length(data('eatenGums'))\"\n    },\n    {\n      \"name\":\"loose\",\n      \"on\":[{\"events\":{\"type\":\"timer\", \"throttle\": 400 }, \"update\":\"!superPower && ((gRedX === pacManX && gRedY === pacManY) || (gBlueX === pacManX && gBlueY === pacManY) || (gGreenX === pacManX && gGreenY === pacManY) || (gOrangeX === pacManX && gOrangeY === pacManY))\"}]\n    },\n    {\n      \"name\":\"restart\",\n      \"update\":\"win === true || loose === true\"\n    },\n    {\n      \"name\":\"testEaten\",\n      \"update\":\"!restart && (indata('gums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n      \"name\":\"testPowerEaten\",\n      \"update\":\"!restart && (indata('powerGums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n        \"name\":\"superPower\",\n        \"init\":\"0\",\n        \"on\": [{\"events\":{\"type\":\"timer\", \"throttle\": 10000}, \"force\": true, \"update\":\"superPower > 0 ? superPower - 1 : 0\"},\n        {\"events\":{\"signal\":\"testPowerEaten\"}, \"update\":\"testPowerEaten? 15 : superPower\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"0\"}]\n    }\n    ,\n    {\n      \"name\":\"testEatenGhost\",\n      \"update\":\"superPower ? ((gRedX === pacManX && gRedY === pacManY) ? gRed : (gBlueX === pacManX && gBlueY === pacManY) ? gBlue : (gGreenX === pacManX && gGreenY === pacManY) ? gGreen : (gOrangeX === pacManX && gOrangeY === pacManY) ? gOrange : null) : null\"\n    },\n\n    {\n      \"name\":\"gRed\",\n      \"init\":\"data('ghosts')[0]\"\n    },\n    {\n      \"name\":\"gRedDelta\",\n      \"update\":\"{dx:pacManX-gRedX, dy: pacManY-gRedY}\"\n    },\n    {\n      \"name\":\"gRedLastDir\",\n      \"update\":\"gRedDirection\"\n    },\n    {\n      \"name\":\"gRedPreferences\",\n      \"update\":\"setdata('gRedDecisions',[{d:'up', i: (gRedLastDir === 'down' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gRedLastDir === 'up' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gRedLastDir === 'right' ? 4 : (abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gRedLastDir === 'left' ? 4 : abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gRedHasWallX\",\n      \"update\":\"(gRedOffsetX<0 && !gRedCanLeft) || (gRedOffsetX>0 && !gRedCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gRedHasWallY\",\n      \"update\":\"(gRedOffsetY<0 && !gRedCanUp) || (gRedOffsetY>0 && !gRedCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gRedCanLeft\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanUp\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedCanRight\",\n      \"update\":\"indata('walls', 'key', (gRedX + 1) + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanDown\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + (gRedY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedHasPacMan\",\n      \"update\":\"superPower && ((gRedX + gRedOffsetX === pacManX) && (gRedY + gRedOffsetY === pacManY))\"\n    },\n    {\n      \"name\":\"gRedBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gRedProposedDirection\"}, \"force\": true, \"update\":\"!gRedProposedDirection ||(gRedProposedDirection === 'up' && !gRedCanUp) || (gRedProposedDirection === 'down' && !gRedCanDown) || (gRedProposedDirection === 'left' && !gRedCanLeft) || (gRedProposedDirection === 'right' && !gRedCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedTry\",\n       \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 3500}, \"update\":\"gRedBlocked && gRedTry <3 ? gRedTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedDecision\",\n      \"update\":\"data('gRedDecisions')[gRedTry]\"\n    },\n    {\n      \"name\":\"gRedProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gRedDecision\"}, \"force\": true, \"update\":\"gRedDecision ? gRedDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gRedDirection\",\n      \"update\":\"gRedProposedDirection && !gRedBlocked ? gRedProposedDirection : gRedDirection\"\n    },\n    {\n      \"name\":\"gRedOffsetX\",\n      \"update\":\"gRedDirection === 'left'? - 1 : gRedDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gRedOffsetY\",\n      \"update\":\"gRedDirection === 'up'? -1 : gRedDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gRedX\",\n      \"init\":\"gRed.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 5000}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 6 : (!restart && !gRedHasWallX && !gRedHasPacMan ? ((gRedOffsetX <0 && gRedX <= 0) ? grid.width - 1 : ((gRedOffsetX > 0 && gRedX >= grid.width -1) ? 0 : (gRedX + gRedOffsetX))) : gRedX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gRed.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedY\",\n      \"init\":\"gRed.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 5000}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 7 : (!restart && !gRedHasWallY && !gRedHasPacMan ? ((gRedOffsetY <0 && gRedY <= 0) ? grid.height-1 : (gRedOffsetY > 0 && gRedY >= grid.height - 1)? 0 : gRedY + gRedOffsetY) : gRedY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gRed.y\"\n        }\n      ]\n    },\n\n    {\n      \"name\":\"gBlue\",\n      \"init\":\"data('ghosts')[1]\"\n    },\n    {\n      \"name\":\"gBlueDelta\",\n      \"update\":\"{dx:pacManX-gBlueX, dy: pacManY-gBlueY}\"\n    },\n    {\n      \"name\":\"gBlueLastDir\",\n      \"update\":\"gBlueDirection\"\n    },\n    {\n      \"name\":\"gBluePreferences\",\n      \"update\":\"setdata('gBlueDecisions',[{d:'up', i: (gBlueLastDir === 'down' ? 4 : (abs(gBlueDelta.dy) > abs(gBlueDelta.dx) ? (gBlueDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gBlueDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gBlueLastDir === 'up' ? 4 : (abs(gBlueDelta.dy) > abs(gBlueDelta.dx) ? (gBlueDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gBlueDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gBlueLastDir === 'right' ? 4 : (abs(gBlueDelta.dy) < abs(gBlueDelta.dx) ? (gBlueDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gBlueDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gBlueLastDir === 'left' ? 4 : abs(gBlueDelta.dy) < abs(gBlueDelta.dx) ? (gBlueDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gBlueDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gBlueHasWallX\",\n      \"update\":\"(gBlueOffsetX<0 && !gBlueCanLeft) || (gBlueOffsetX>0 && !gBlueCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gBlueHasWallY\",\n      \"update\":\"(gBlueOffsetY<0 && !gBlueCanUp) || (gBlueOffsetY>0 && !gBlueCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gBlueHasGhost\",\n      \"update\":\"(gBlueX == gRedX && gBlueY === gRedY)\"\n    },\n    {\n      \"name\":\"gBlueHasPacMan\",\n      \"update\":\"superPower && ((gBlueX + gBlueOffsetX === pacManX) && (gBlueY + gBlueOffsetY === pacManY)) \"\n    },\n    {\n      \"name\":\"gBlueCanLeft\",\n      \"update\":\"indata('walls', 'key', gBlueX + '-' + gBlueY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gBlueCanUp\",\n      \"update\":\"indata('walls', 'key', gBlueX + '-' + gBlueY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gBlueCanRight\",\n      \"update\":\"indata('walls', 'key', (gBlueX + 1) + '-' + gBlueY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gBlueCanDown\",\n      \"update\":\"indata('walls', 'key', gBlueX + '-' + (gBlueY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gBlueBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gBlueProposedDirection\"}, \"force\": true, \"update\":\"!gBlueProposedDirection || (gBlueProposedDirection === 'up' && !gBlueCanUp) || (gBlueProposedDirection === 'down' && !gBlueCanDown) || (gBlueProposedDirection === 'left' && !gBlueCanLeft) || (gBlueProposedDirection === 'right' && !gBlueCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueTry\",\n      \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 4000}, \"update\":\"gBlueBlocked && gBlueTry <=3 ? gBlueTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueDecision\",\n      \"update\":\"data('gBlueDecisions')[gBlueTry]\"\n    },\n    {\n      \"name\":\"gBlueProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gBlueDecision\"}, \"force\": true, \"update\":\"gBlueDecision ? gBlueDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gBlueDirection\",\n      \"update\":\"gBlueProposedDirection && !gBlueBlocked ? gBlueProposedDirection : gBlueDirection\"\n    },\n    {\n      \"name\":\"gBlueOffsetX\",\n      \"update\":\"gBlueDirection === 'left'? - 1 : gBlueDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gBlueOffsetY\",\n      \"update\":\"gBlueDirection === 'up' ? -1 : gBlueDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gBlueX\",\n      \"init\":\"gBlue.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 5000}, \"update\":\"indata('eatenGhosts', 'color', 'steelblue') ? 7 : (!restart && !gBlueHasWallX && !gBlueHasGhost && !gBlueHasPacMan ? ((gBlueOffsetX <0 && gBlueX <= 0) ? grid.width - 1 : ((gBlueOffsetX > 0 && gBlueX >= grid.width -1) ? 0 : (gBlueX + gBlueOffsetX))) : gBlueX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gBlue.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueY\",\n      \"init\":\"gBlue.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 5000}, \"update\":\"indata('eatenGhosts', 'color', 'steelblue') ? 7 : (!restart && !gBlueHasWallY && !gBlueHasGhost && !gBlueHasPacMan ? ((gBlueOffsetY <0 && gBlueY <= 0) ? grid.height-1 : (gBlueOffsetY > 0 && gBlueY >= grid.height - 1)? 0 : gBlueY + gBlueOffsetY) : gBlueY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gBlue.y\"\n        }\n      ]\n    },\n\n    {\n      \"name\":\"gGreen\",\n      \"init\":\"data('ghosts')[2]\"\n    },\n    {\n      \"name\":\"gGreenDelta\",\n      \"update\":\"{dx:pacManX-gGreenX, dy: pacManY-gGreenY}\"\n    },\n    {\n      \"name\":\"gGreenLastDir\",\n      \"update\":\"gGreenDirection\"\n    },\n    {\n      \"name\":\"gGreenPreferences\",\n      \"update\":\"setdata('gGreenDecisions',[{d:'up', i: (gGreenLastDir === 'down' ? 4 : (abs(gGreenDelta.dy) > abs(gGreenDelta.dx) ? (gGreenDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gGreenDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gGreenLastDir === 'up' ? 4 : (abs(gGreenDelta.dy) > abs(gGreenDelta.dx) ? (gGreenDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gGreenDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gGreenLastDir === 'right' ? 4 : (abs(gGreenDelta.dy) < abs(gGreenDelta.dx) ? (gGreenDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gGreenDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gGreenLastDir === 'left' ? 4 : abs(gGreenDelta.dy) < abs(gGreenDelta.dx) ? (gGreenDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gGreenDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gGreenHasWallX\",\n      \"update\":\"(gGreenOffsetX<0 && !gGreenCanLeft) || (gGreenOffsetX>0 && !gGreenCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gGreenHasWallY\",\n      \"update\":\"(gGreenOffsetY<0 && !gGreenCanUp) || (gGreenOffsetY>0 && !gGreenCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gGreenHasGhost\",\n      \"update\":\"(gGreenX === gRedX && gGreenY === gRedY) || (gGreenX === gBlueX && gGreenY+gGreenOffsetY === gBlueY)\"\n    },\n    {\n      \"name\":\"gGreenHasPacMan\",\n      \"update\":\"superPower && ((gGreenX + gGreenOffsetX === pacManX) && (gGreenY + gGreenOffsetY === pacManY)) \"\n    },\n    {\n      \"name\":\"gGreenCanLeft\",\n      \"update\":\"indata('walls', 'key', gGreenX + '-' + gGreenY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gGreenCanUp\",\n      \"update\":\"indata('walls', 'key', gGreenX + '-' + gGreenY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gGreenCanRight\",\n      \"update\":\"indata('walls', 'key', (gGreenX + 1) + '-' + gGreenY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gGreenCanDown\",\n      \"update\":\"indata('walls', 'key', gGreenX + '-' + (gGreenY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gGreenBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gGreenProposedDirection\"}, \"force\": true, \"update\":\"!gGreenProposedDirection || (gGreenProposedDirection === 'up' && !gGreenCanUp) || (gGreenProposedDirection === 'down' && !gGreenCanDown) || (gGreenProposedDirection === 'left' && !gGreenCanLeft) || (gGreenProposedDirection === 'right' && !gGreenCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenTry\",\n      \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 4000}, \"update\":\"gGreenBlocked && gGreenTry <=3 ? gGreenTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenDecision\",\n      \"update\":\"data('gGreenDecisions')[gGreenTry]\"\n    },\n    {\n      \"name\":\"gGreenProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gGreenDecision\"}, \"force\": true, \"update\":\"gGreenDecision ? gGreenDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gGreenDirection\",\n      \"update\":\"gGreenProposedDirection && !gGreenBlocked ? gGreenProposedDirection : gGreenDirection\"\n    },\n    {\n      \"name\":\"gGreenOffsetX\",\n      \"update\":\"gGreenDirection === 'left'? - 1 : gGreenDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gGreenOffsetY\",\n      \"update\":\"gGreenDirection === 'up' ? -1 : gGreenDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gGreenX\",\n      \"init\":\"gGreen.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'green') ? 8 : (!restart && !gGreenHasWallX && !gGreenHasGhost && !gGreenHasPacMan ? ((gGreenOffsetX <0 && gGreenX <= 0) ? grid.width - 1 : ((gGreenOffsetX > 0 && gGreenX >= grid.width -1) ? 0 : (gGreenX + gGreenOffsetX))) : gGreenX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gGreen.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenY\",\n      \"init\":\"gGreen.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'green') ? 7 : (!restart && !gGreenHasWallY && !gGreenHasGhost && !gGreenHasPacMan ? ((gGreenOffsetY <0 && gGreenY <= 0) ? grid.height-1 : (gGreenOffsetY > 0 && gGreenY >= grid.height - 1)? 0 : gGreenY + gGreenOffsetY) : gGreenY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gGreen.y\"\n        }\n      ]\n    },\n\n    {\n      \"name\":\"gOrange\",\n      \"init\":\"data('ghosts')[3]\"\n    },\n    {\n      \"name\":\"gOrangeDelta\",\n      \"update\":\"{dx:pacManX-gOrangeX, dy: pacManY-gOrangeY}\"\n    },\n    {\n      \"name\":\"gOrangeLastDir\",\n      \"update\":\"gOrangeDirection\"\n    },\n    {\n      \"name\":\"gOrangePreferences\",\n      \"update\":\"setdata('gOrangeDecisions',[{d:'up', i: (gOrangeLastDir === 'down' ? 4 : (abs(gOrangeDelta.dy) > abs(gOrangeDelta.dx) ? (gOrangeDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gOrangeDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gOrangeLastDir === 'up' ? 4 : (abs(gOrangeDelta.dy) > abs(gOrangeDelta.dx) ? (gOrangeDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gOrangeDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gOrangeLastDir === 'right' ? 4 : (abs(gOrangeDelta.dy) < abs(gOrangeDelta.dx) ? (gOrangeDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gOrangeDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gOrangeLastDir === 'left' ? 4 : abs(gOrangeDelta.dy) < abs(gOrangeDelta.dx) ? (gOrangeDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gOrangeDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gOrangeHasWallX\",\n      \"update\":\"(gOrangeOffsetX<0 && !gOrangeCanLeft) || (gOrangeOffsetX>0 && !gOrangeCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gOrangeHasWallY\",\n      \"update\":\"(gOrangeOffsetY<0 && !gOrangeCanUp) || (gOrangeOffsetY>0 && !gOrangeCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gOrangeHasGhost\",\n      \"update\":\"(gOrangeX === gRedX && gOrangeY === gRedY) || (gOrangeX === gBlueX && gOrangeY === gBlueY) || (gOrangeX === gGreenX && gOrangeY === gGreenY)\"\n    },\n    {\n      \"name\":\"gOrangeCanLeft\",\n      \"update\":\"indata('walls', 'key', gOrangeX + '-' + gOrangeY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gOrangeCanUp\",\n      \"update\":\"indata('walls', 'key', gOrangeX + '-' + gOrangeY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gOrangeCanRight\",\n      \"update\":\"indata('walls', 'key', (gOrangeX + 1) + '-' + gOrangeY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gOrangeCanDown\",\n      \"update\":\"indata('walls', 'key', gOrangeX + '-' + (gOrangeY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gOrangeBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gOrangeProposedDirection\"}, \"force\": true, \"update\":\"!gOrangeProposedDirection || (gOrangeProposedDirection === 'up' && !gOrangeCanUp) || (gOrangeProposedDirection === 'down' && !gOrangeCanDown) || (gOrangeProposedDirection === 'left' && !gOrangeCanLeft) || (gOrangeProposedDirection === 'right' && !gOrangeCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeTry\",\n      \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 400}, \"update\":\"gOrangeBlocked && gOrangeTry <=3 ? gOrangeTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeHasPacMan\",\n      \"update\":\"superPower && ((gOrangeX + gOrangeOffsetX === pacManX) && (gOrangeY + gOrangeOffsetY === pacManY)) \"\n    },\n    {\n      \"name\":\"gOrangeDecision\",\n      \"update\":\"data('gOrangeDecisions')[gOrangeTry]\"\n    },\n    {\n      \"name\":\"gOrangeProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gOrangeDecision\"}, \"force\": true, \"update\":\"gOrangeDecision ? gOrangeDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gOrangeDirection\",\n      \"update\":\"gOrangeProposedDirection && !gOrangeBlocked ? gOrangeProposedDirection : gOrangeDirection\"\n    },\n    {\n      \"name\":\"gOrangeOffsetX\",\n      \"update\":\"gOrangeDirection === 'left'? - 1 : gOrangeDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gOrangeOffsetY\",\n      \"update\":\"gOrangeDirection === 'up' ? -1 : gOrangeDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gOrangeX\",\n      \"init\":\"gOrange.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'orange') ? 7 : (!restart && !gOrangeHasWallX && !gOrangeHasGhost && !gOrangeHasPacMan ? ((gOrangeOffsetX <0 && gOrangeX <= 0) ? grid.width - 1 : ((gOrangeOffsetX > 0 && gOrangeX >= grid.width -1) ? 0 : (gOrangeX + gOrangeOffsetX))) : gOrangeX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gOrange.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeY\",\n      \"init\":\"gOrange.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'orange') ? 7 : (!restart && !gOrangeHasWallY && !gOrangeHasGhost && !gOrangeHasPacMan  ? ((gOrangeOffsetY <0 && gOrangeY <= 0) ? grid.height-1 : (gOrangeOffsetY > 0 && gOrangeY >= grid.height - 1)? 0 : gOrangeY + gOrangeOffsetY) : gOrangeY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gOrange.y\"\n        }\n      ]\n    }\n\n  ],\n  \"scales\":[\n    {\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }\n  ],\n  \"marks\":[\n     {\n      \"type\":\"rect\",\n      \"from\":{\"data\":\"walls\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"signal\":\"datum.x < grid.width ? datum.x : grid.width-1\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"datum.vertical? (datum.x < grid.width ? datum.x === 0 ? 0 : -1 : blockSize - blockSize/10):0\"}},\n          \"y\":{\"signal\":\"datum.y < grid.height ? datum.y : grid.height-1\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"datum.vertical? 0: datum.y < grid.height? datum.y === 0 ? 0 : -1 : blockSize -blockSize/10\"}},\n          \"fill\":{\"value\":\"blue\"},\n          \"width\":{\"signal\":\"datum.vertical?blockSize/10:blockSize\"},\n          \"height\":{\"signal\":\"datum.vertical?blockSize:blockSize/10\"} \n\n        }\n      }\n    },\n    {\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":7, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":3, \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"yellow\"},\n          \"align\":{\"value\":\"center\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"14*sizeFactor\"}\n        },\n        \"update\":{\n          \"text\":{\"value\":\"score\"}\n        }\n      }\n    },\n    {\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":7, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":4, \"scale\":\"scaleY\"},\n          \"fill\":{\"value\":\"yellow\"},\n          \"align\":{\"value\":\"center\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"25*sizeFactor\"}\n        },\n        \"update\":{\n          \"text\":{\"signal\":\"score\"}\n        }\n      }\n    },\n    {\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":5, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":11, \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"lightblue\"},\n          \"align\":{\"value\":\"left\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"14*sizeFactor\"}\n        },\n        \"update\":{\n          \"opacity\":{\"signal\":\"highScore?1:0\"},\n          \"text\":{\"value\":\"high score\"}\n        }\n      }\n    },\n    {\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":8, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":11, \"scale\":\"scaleY\",\"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"lightblue\"},\n          \"align\":{\"value\":\"center\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"20*sizeFactor\"}\n        },\n        \"update\":{\n          \"opacity\":{\"signal\":\"highScore?1:0\"},\n          \"text\":{\"signal\":\"highScore\"}\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"gums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"grey\"},\n          \"size\":{\"signal\":\"pow(10*sizeFactor, 2)\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"powerGums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"size\":{\"signal\":\"pow(18*sizeFactor, 2)\"},\n          \"fill\":{\"value\":\"white\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"group\",\n      \"name\":\"pacMan\",\n      \"encode\":{\n        \"update\":{\n          \"x\":{\"signal\":\"pacManX\", \"scale\":\"scaleX\"},\n          \"y\":{\"signal\":\"pacManY\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\":\"arc\",\n          \"encode\":{\n            \"enter\":{\n              \"outerRadius\":{\"signal\":\"(blockSize/2)*0.8\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"x\":{\"signal\":\"blockSize/2\"},\n              \"y\":{\"signal\":\"blockSize/2\"}\n\n            },\n            \"update\":{\n              \"fill\":{\"signal\":\"superPower ? 'red' : 'yellow'\"},\n              \"endAngle\":{\"signal\":\"(pacManIsOpen? 5*PI/2-PI/6:5*PI/2-0.001) * (pacManXOffset ? pacManXOffset : 1)\"},\n              \"startAngle\":{\"signal\":\"(pacManIsOpen? PI/2+PI/6:PI/2) * (pacManXOffset ? pacManXOffset : 1)\"}\n            }\n          }\n        },\n        {\n          \"type\":\"symbol\",\n          \"encode\":{\n            \"enter\":{\n              \"y\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"-blockSize/5\"}},\n              \"size\":{\"signal\":\"pow(blockSize/10, 2)\"},\n              \"fill\":{\"value\":\"black\"}          \n              },\n            \"update\":{\n              \"x\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"2 * (pacManXOffset ? pacManXOffset : 1)\"}}\n            }\n          }\n        }\n      ]\n     },\n     {\n          \"type\":\"symbol\",\n          \"from\":{\"data\":\"ghosts\"},\n          \"encode\":{\n            \"enter\":{\n              \"size\":{\"signal\":\"pow(blockSize/20,2)\"}\n            },\n            \"update\":{\n              \"x\":{\"signal\":\"datum.color === 'red' ? gRedX : datum.color === 'steelblue'? gBlueX : datum.color === 'green'? gGreenX : gOrangeX\", \"offset\":{\"signal\":\"blockSize/8\"}, \"scale\":\"scaleX\"},\n              \"y\":{\"signal\":\"datum.color === 'red' ? gRedY : datum.color === 'steelblue'? gBlueY : datum.color === 'green'? gGreenY : gOrangeY\", \"offset\":{\"signal\":\"blockSize/9\"}, \"scale\":\"scaleY\"},\n              \"shape\":{\"signal\":\"indata('eatenGhosts', 'color', datum.color) ? 'M16.459004,11.555034C15.659003,11.555034 15.009003,12.205034 15.009003,13.005036 15.009003,13.804038 15.659003,14.454039 16.459004,14.454039 17.258005,14.454039 17.909006,13.804038 17.909006,13.005036 17.909006,12.205034 17.258005,11.555034 16.459004,11.555034z M7.5419962,11.555034C6.7429954,11.555034 6.0919949,12.205034 6.0919949,13.005036 6.0919949,13.804038 6.7429954,14.454039 7.5419962,14.454039 8.3419973,14.454039 8.9919979,13.804038 8.9919979,13.005036 8.9919979,12.205034 8.3419973,11.555034 7.5419962,11.555034z M16.459004,9.5550298C18.361006,9.5550298 19.909006,11.103033 19.909006,13.005036 19.909006,14.90804 18.361006,16.454042 16.459004,16.454042 14.557002,16.454042 13.009001,14.90804 13.009001,13.005036 13.009001,11.103033 14.557002,9.5550298 16.459004,9.5550298z M7.5419962,9.5550298C9.4439976,9.5550298 10.991999,11.103033 10.991999,13.005036 10.991999,14.90804 9.4439976,16.454042 7.5419962,16.454042 5.6399948,16.454042 4.091993,14.90804 4.091993,13.005036 4.091993,11.103033 5.6399948,9.5550298 7.5419962,9.5550298z M12,1.9999994C6.4860079,1.9999995,2.0000002,6.3300156,2.0000004,11.650998L2.0000004,28.669975 5.102997,27.200983 8.9929964,29.12896 12.742996,27.202997 16.98201,29.106987 19.895004,27.116999 22,28.439995 22,11.650998C22,6.3300156,17.515,1.9999995,12,1.9999994z M12,0C18.617005,0,24,5.2260117,24,11.650998L24,32.056999 19.940003,29.507988 17.184998,31.390007 12.80101,29.421989 9.0080111,31.369011 5.0820009,29.424004 0,31.827995 0,11.650998C1.8747701E-07,5.2260117,5.3840029,0,12,0z' : 'M13.952596,15.068143C13.767538,15.066144 13.583578,15.095151 13.403586,15.157148 12.252587,15.553147 11.725549,17.163162 12.224572,18.753189 12.725547,20.342192 14.062582,21.309212 15.211566,20.914204 16.362564,20.518204 16.889541,18.908188 16.390579,17.318163 15.968584,15.977162 14.95058,15.077146 13.952596,15.068143z M7.7945876,6.1100698C7.2026091,6.0760732 6.4365583,6.7850791 5.9736071,7.8550807 5.4445558,9.0761004 5.5105953,10.302109 6.1215563,10.590106 6.7316013,10.881108 7.65555,10.126112 8.1855779,8.9070922 8.7145686,7.6860881 8.6485896,6.4610711 8.036592,6.1710754 7.9606028,6.1350642 7.8795486,6.1150752 7.7945876,6.1100698z M15.404559,5.9590679C15.383563,5.9580608 15.362566,5.9580608 15.34157,5.960075 14.674579,6.0020671 14.194539,7.1220723 14.275593,8.4590903 14.354573,9.7981063 14.962543,10.848119 15.631547,10.802114 16.300554,10.759113 16.778579,9.6401005 16.700576,8.3020907 16.622573,7.006074 16.049577,5.980064 15.404559,5.9590679z M12.317589,1.4699259E-05C15.527545,0.0050196948 18.757579,1.2870288 21.236579,3.8010436 24.038576,6.6430793 25.533567,12.005127 25.825559,15.861164 26.09155,19.371191 27.844537,19.518194 30.765552,22.228211 31.592515,22.995216 33.904521,25.825243 28.733512,26.053242 26.619564,26.146244 25.60156,25.739243 21.732549,22.850226 21.235542,22.545214 20.664558,22.733219 20.373542,22.885214 20.017526,23.07122 19.741586,23.925232 19.851572,24.215227 20.16456,25.583237 22.25855,25.135235 23.427553,26.313253 24.41156,27.305252 22.795536,29.807287 18.926586,29.29027 18.926586,29.29027 16.343582,28.587277 13.853597,25.258236 11.910547,25.242245 9.6305823,25.258236 9.6305823,25.258236 9.6305823,25.258236 9.6025672,26.705256 9.6425452,27.10626 10.271573,27.256254 10.777553,27.021252 13.298544,27.736271 14.150593,27.978262 16.663589,31.170292 8.7236018,30.424282 7.0135832,30.263287 7.1875944,30.721283 5.2576051,26.025242 4.2626119,23.604229 2.0076115,22.396212 0.6345674,17.082169 -0.27241354,14.207143 -0.21040192,11.068107 0.84159805,8.2280856 0.97556992,7.8450862 1.1235799,7.5130826 1.2786091,7.1980773 1.8406196,6.0020671 2.5815849,4.8720523 3.5156043,3.863056 5.9166007,1.2680314 9.107573,-0.0049901602 12.317589,1.4699259E-05z'\"},\n              \"fill\":{\"signal\":\"superPower? 'white' :datum.color\"},\n              \"opacity\":[{\"test\":\"restart\", \"value\": 0},{\"signal\":\"superPower?0.8:1\"}]\n            }\n          }\n        }\n  ],\n  \"data\":[\n        {\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    },\n        {\n      \"name\":\"ghosts\",\n      \"values\":[\n      {\n        \"x\":0,\n        \"y\":0,\n        \"color\":\"red\"\n      },\n      {\n        \"x\":14,\n        \"y\":0,\n        \"color\":\"steelblue\"\n      },\n       {\n        \"x\":0,\n        \"y\":14,\n        \"color\":\"green\"\n      },\n      {\n        \"x\":14,\n        \"y\":14,\n        \"color\":\"orange\"\n      }\n      ]\n    },\n    {\n      \"name\":\"eatenGhosts\",\n      \"on\": [{\n        \"trigger\":\"testEatenGhost\",\n        \"insert\":\"testEatenGhost\"\n      },\n      {\n        \"trigger\":\"!superPower\",\n        \"remove\":\"!superPower\"\n      }]\n    },\n    {\n      \"name\":\"gRedDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gums\",\n      \"values\":[\n        {\"x\":0, \"y\":1},\n        {\"x\":0, \"y\":2},\n        {\"x\":0, \"y\":3},\n        {\"x\":0, \"y\":4},\n        {\"x\":0, \"y\":7},\n        {\"x\":0, \"y\":10},\n        {\"x\":0, \"y\":11},\n        {\"x\":0, \"y\":12},\n        {\"x\":0, \"y\":14},\n\n        {\"x\":1, \"y\":0},\n        {\"x\":1, \"y\":2},\n        {\"x\":1, \"y\":4},\n        {\"x\":1, \"y\":7},\n        {\"x\":1, \"y\":10},\n        {\"x\":1, \"y\":12},\n        {\"x\":1, \"y\":13},\n        {\"x\":1, \"y\":14},\n\n        {\"x\":2, \"y\":0},\n        {\"x\":2, \"y\":2},\n        {\"x\":2, \"y\":3},\n        {\"x\":2, \"y\":4},\n        {\"x\":2, \"y\":7},\n        {\"x\":2, \"y\":10},\n        {\"x\":2, \"y\":13},\n        {\"x\":2, \"y\":14},\n\n        {\"x\":3, \"y\":0},\n        {\"x\":3, \"y\":1},\n        {\"x\":3, \"y\":2},\n        {\"x\":3, \"y\":4},\n        {\"x\":3, \"y\":5},\n        {\"x\":3, \"y\":6},\n        {\"x\":3, \"y\":7},\n        {\"x\":3, \"y\":8},\n        {\"x\":3, \"y\":9},\n        {\"x\":3, \"y\":10},\n        {\"x\":3, \"y\":12},\n        {\"x\":3, \"y\":13},\n        {\"x\":3, \"y\":14},\n\n        {\"x\":4, \"y\":0},\n        {\"x\":4, \"y\":2},\n        {\"x\":4, \"y\":6},\n        {\"x\":4, \"y\":10},\n        {\"x\":4, \"y\":11},\n        {\"x\":4, \"y\":12},\n        {\"x\":4, \"y\":14},\n\n        {\"x\":5, \"y\":0},\n        {\"x\":5, \"y\":2},\n        {\"x\":5, \"y\":3},\n        {\"x\":5, \"y\":4},\n        {\"x\":5, \"y\":5},\n        {\"x\":5, \"y\":6},\n        {\"x\":5, \"y\":7},\n        {\"x\":5, \"y\":8},\n        {\"x\":5, \"y\":10},\n        {\"x\":5, \"y\":12},\n        {\"x\":5, \"y\":14},\n\n        {\"x\":6, \"y\":0},\n        {\"x\":6, \"y\":2},\n        {\"x\":6, \"y\":5},\n        {\"x\":6, \"y\":6},\n        {\"x\":6, \"y\":7},\n        {\"x\":6, \"y\":8},\n        {\"x\":6, \"y\":10},\n        {\"x\":6, \"y\":12},\n        {\"x\":6, \"y\":13},\n        {\"x\":6, \"y\":14},\n\n        {\"x\":7, \"y\":0},\n        {\"x\":7, \"y\":1},\n        {\"x\":7, \"y\":2},\n        {\"x\":7, \"y\":6},\n        {\"x\":7, \"y\":8},\n        {\"x\":7, \"y\":9},\n        {\"x\":7, \"y\":10},\n        {\"x\":7, \"y\":14},\n\n        {\"x\":14, \"y\":0},\n        {\"x\":14, \"y\":1},\n        {\"x\":14, \"y\":2},\n        {\"x\":14, \"y\":3},\n        {\"x\":14, \"y\":4},\n        {\"x\":14, \"y\":7},\n        {\"x\":14, \"y\":10},\n        {\"x\":14, \"y\":11},\n        {\"x\":14, \"y\":12},\n        {\"x\":14, \"y\":14},\n\n        {\"x\":13, \"y\":0},\n        {\"x\":13, \"y\":2},\n        {\"x\":13, \"y\":4},\n        {\"x\":13, \"y\":7},\n        {\"x\":13, \"y\":10},\n        {\"x\":13, \"y\":12},\n        {\"x\":13, \"y\":13},\n        {\"x\":13, \"y\":14},\n\n        {\"x\":12, \"y\":0},\n        {\"x\":12, \"y\":2},\n        {\"x\":12, \"y\":3},\n        {\"x\":12, \"y\":4},\n        {\"x\":12, \"y\":7},\n        {\"x\":12, \"y\":10},\n        {\"x\":12, \"y\":13},\n        {\"x\":12, \"y\":14},\n\n        {\"x\":11, \"y\":0},\n        {\"x\":11, \"y\":1},\n        {\"x\":11, \"y\":2},\n        {\"x\":11, \"y\":4},\n        {\"x\":11, \"y\":5},\n        {\"x\":11, \"y\":6},\n        {\"x\":11, \"y\":7},\n        {\"x\":11, \"y\":8},\n        {\"x\":11, \"y\":9},\n        {\"x\":11, \"y\":10},\n        {\"x\":11, \"y\":12},\n        {\"x\":11, \"y\":13},\n        {\"x\":11, \"y\":14},\n\n        {\"x\":10, \"y\":0},\n        {\"x\":10, \"y\":2},\n        {\"x\":10, \"y\":6},\n        {\"x\":10, \"y\":10},\n        {\"x\":10, \"y\":11},\n        {\"x\":10, \"y\":12},\n        {\"x\":10, \"y\":14},\n\n        {\"x\":9, \"y\":0},\n        {\"x\":9, \"y\":2},\n        {\"x\":9, \"y\":3},\n        {\"x\":9, \"y\":4},\n        {\"x\":9, \"y\":5},\n        {\"x\":9, \"y\":6},\n        {\"x\":9, \"y\":7},\n        {\"x\":9, \"y\":8},\n        {\"x\":9, \"y\":10},\n        {\"x\":9, \"y\":12},\n        {\"x\":9, \"y\":14},\n\n        {\"x\":8, \"y\":0},\n        {\"x\":8, \"y\":2},\n        {\"x\":8, \"y\":5},\n        {\"x\":8, \"y\":6},\n        {\"x\":8, \"y\":7},\n        {\"x\":8, \"y\":8},\n        {\"x\":8, \"y\":10},\n        {\"x\":8, \"y\":12},\n        {\"x\":8, \"y\":13},\n        {\"x\":8, \"y\":14}\n        \n      ],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"powerGums\",\n      \"values\":[{\"x\":0, \"y\":0},{\"x\":14, \"y\":0}, {\"x\":0, \"y\":14}, {\"x\":14, \"y\":14}],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"eatenGums\",\n      \"on\":[\n        {\n          \"trigger\":\"testEaten\",\n          \"insert\":\"testEaten\"\n        },\n        {\n          \"trigger\":\"testPowerEaten\",\n          \"insert\":\"testPowerEaten\"\n        },\n        {\n          \"trigger\":\"restart\",\n          \"remove\":\"restart\"\n        }\n      ]\n    },\n    { \n      \"name\":\"walls\",\n      \"values\":[\n          {\"x\":0, \"y\":0, \"vertical\":false},\n          {\"x\":1, \"y\":0, \"vertical\":false},\n          {\"x\":2, \"y\":0, \"vertical\":false},\n          {\"x\":3, \"y\":0, \"vertical\":false},\n          {\"x\":4, \"y\":0, \"vertical\":false},\n          {\"x\":5, \"y\":0, \"vertical\":false},\n          {\"x\":6, \"y\":0, \"vertical\":false},\n          {\"x\":7, \"y\":0, \"vertical\":false},\n          {\"x\":8, \"y\":0, \"vertical\":false},\n          {\"x\":9, \"y\":0, \"vertical\":false},\n          {\"x\":10, \"y\":0, \"vertical\":false},\n          {\"x\":11, \"y\":0, \"vertical\":false},\n          {\"x\":12, \"y\":0, \"vertical\":false},\n          {\"x\":13, \"y\":0, \"vertical\":false},\n          {\"x\":14, \"y\":0, \"vertical\":false},\n          {\"x\":0, \"y\":15, \"vertical\":false},\n          {\"x\":1, \"y\":15, \"vertical\":false},\n          {\"x\":2, \"y\":15, \"vertical\":false},\n          {\"x\":3, \"y\":15, \"vertical\":false},\n          {\"x\":4, \"y\":15, \"vertical\":false},\n          {\"x\":5, \"y\":15, \"vertical\":false},\n          {\"x\":6, \"y\":15, \"vertical\":false},\n          {\"x\":7, \"y\":15, \"vertical\":false},\n          {\"x\":8, \"y\":15, \"vertical\":false},\n          {\"x\":9, \"y\":15, \"vertical\":false},\n          {\"x\":10, \"y\":15, \"vertical\":false},\n          {\"x\":11, \"y\":15, \"vertical\":false},\n          {\"x\":12, \"y\":15, \"vertical\":false},\n          {\"x\":13, \"y\":15, \"vertical\":false},\n          {\"x\":14, \"y\":15, \"vertical\":false}, \n\n          {\"x\":0, \"y\":0, \"vertical\":true},\n          {\"x\":0, \"y\":1, \"vertical\":true},\n          {\"x\":0, \"y\":2, \"vertical\":true},\n          {\"x\":0, \"y\":3, \"vertical\":true},\n          {\"x\":0, \"y\":4, \"vertical\":true},\n          {\"x\":0, \"y\":5, \"vertical\":false},\n          {\"x\":1, \"y\":5, \"vertical\":false},\n          {\"x\":2, \"y\":5, \"vertical\":false},\n          {\"x\":0, \"y\":7, \"vertical\":false},\n          {\"x\":1, \"y\":7, \"vertical\":false},\n          {\"x\":2, \"y\":7, \"vertical\":false},\n          {\"x\":0, \"y\":8, \"vertical\":false},\n          {\"x\":1, \"y\":8, \"vertical\":false},\n          {\"x\":0, \"y\":10, \"vertical\":false},\n          {\"x\":1, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":8, \"vertical\":false},\n          {\"x\":3, \"y\":5, \"vertical\":true},\n          {\"x\":3, \"y\":6, \"vertical\":true},\n          {\"x\":3, \"y\":8, \"vertical\":true},\n          {\"x\":3, \"y\":9, \"vertical\":true},\n          {\"x\":0, \"y\":10, \"vertical\":true},\n          {\"x\":0, \"y\":11, \"vertical\":true},\n          {\"x\":0, \"y\":12, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":14, \"vertical\":true},\n\n          {\"x\":15, \"y\":0, \"vertical\":true},\n          {\"x\":15, \"y\":1, \"vertical\":true},\n          {\"x\":15, \"y\":2, \"vertical\":true},\n          {\"x\":15, \"y\":3, \"vertical\":true},\n          {\"x\":15, \"y\":4, \"vertical\":true},\n          {\"x\":12, \"y\":5, \"vertical\":true},\n          {\"x\":14, \"y\":5, \"vertical\":false},\n          {\"x\":13, \"y\":5, \"vertical\":false},\n          {\"x\":14, \"y\":7, \"vertical\":false},\n          {\"x\":13, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":5, \"vertical\":false},\n          {\"x\":12, \"y\":6, \"vertical\":true},\n          {\"x\":14, \"y\":8, \"vertical\":false},\n          {\"x\":13, \"y\":8, \"vertical\":false},\n          {\"x\":14, \"y\":10, \"vertical\":false},\n          {\"x\":13, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":true},\n          {\"x\":12, \"y\":9, \"vertical\":true},\n          {\"x\":15, \"y\":10, \"vertical\":true},\n          {\"x\":15, \"y\":11, \"vertical\":true},\n          {\"x\":15, \"y\":12, \"vertical\":true},\n          {\"x\":15, \"y\":13, \"vertical\":true},\n          {\"x\":15, \"y\":14, \"vertical\":true},\n\n          {\"x\":6, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":6, \"vertical\":false},\n          {\"x\":8, \"y\":5, \"vertical\":true},\n          {\"x\":8, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":3, \"vertical\":false},\n          {\"x\":8, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":4, \"vertical\":true},\n          {\"x\":9, \"y\":3, \"vertical\":true},\n          {\"x\":9, \"y\":4, \"vertical\":true},\n          {\"x\":6, \"y\":3, \"vertical\":true},\n\n          {\"x\":3, \"y\":3, \"vertical\":false},\n          {\"x\":4, \"y\":3, \"vertical\":false},\n          {\"x\":3, \"y\":3, \"vertical\":true},\n          {\"x\":5, \"y\":3, \"vertical\":true},\n          {\"x\":3, \"y\":4, \"vertical\":false},\n          {\"x\":4, \"y\":4, \"vertical\":true},\n          {\"x\":5, \"y\":4, \"vertical\":true},\n          {\"x\":4, \"y\":5, \"vertical\":true},\n          {\"x\":5, \"y\":5, \"vertical\":true},\n          {\"x\":4, \"y\":6, \"vertical\":false},\n\n          {\"x\":10, \"y\":3, \"vertical\":false},\n          {\"x\":11, \"y\":3, \"vertical\":false},\n          {\"x\":10, \"y\":3, \"vertical\":true},\n          {\"x\":12, \"y\":3, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":false},\n          {\"x\":10, \"y\":4, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":true},\n          {\"x\":10, \"y\":5, \"vertical\":true},\n          {\"x\":11, \"y\":5, \"vertical\":true},\n          {\"x\":10, \"y\":6, \"vertical\":false},\n\n          {\"x\":1, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":1, \"vertical\":false},\n          {\"x\":2, \"y\":1, \"vertical\":false},\n          {\"x\":1, \"y\":2, \"vertical\":false},\n          {\"x\":2, \"y\":2, \"vertical\":false},\n          {\"x\":3, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":false},\n          {\"x\":4, \"y\":2, \"vertical\":false},\n          {\"x\":5, \"y\":1, \"vertical\":false},\n          {\"x\":6, \"y\":1, \"vertical\":false},\n          {\"x\":5, \"y\":2, \"vertical\":false},\n          {\"x\":6, \"y\":2, \"vertical\":false},\n          {\"x\":7, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":false},\n          {\"x\":9, \"y\":1, \"vertical\":false},\n          {\"x\":8, \"y\":2, \"vertical\":false},\n          {\"x\":9, \"y\":2, \"vertical\":false},\n          {\"x\":11, \"y\":1, \"vertical\":true},\n          {\"x\":10, \"y\":1, \"vertical\":false},\n          {\"x\":10, \"y\":2, \"vertical\":false},\n          {\"x\":12, \"y\":1, \"vertical\":true},\n          {\"x\":12, \"y\":1, \"vertical\":false},\n          {\"x\":13, \"y\":1, \"vertical\":false},\n          {\"x\":12, \"y\":2, \"vertical\":false},\n          {\"x\":13, \"y\":2, \"vertical\":false},\n          {\"x\":14, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":3, \"vertical\":true},\n          {\"x\":2, \"y\":3, \"vertical\":true}, \n          {\"x\":1, \"y\":3, \"vertical\":false},\n          {\"x\":13, \"y\":4, \"vertical\":false},\n          {\"x\":13, \"y\":3, \"vertical\":true},\n          {\"x\":14, \"y\":3, \"vertical\":true}, \n          {\"x\":13, \"y\":3, \"vertical\":false},\n          {\"x\":1, \"y\":4, \"vertical\":false},\n\n          {\"x\":6, \"y\":7, \"vertical\":true},\n          {\"x\":9, \"y\":7, \"vertical\":true}, \n          {\"x\":7, \"y\":8, \"vertical\":false},\n          {\"x\":6, \"y\":8, \"vertical\":false},\n          {\"x\":8, \"y\":8, \"vertical\":false},\n\n          {\"x\":4, \"y\":7, \"vertical\":false},\n          {\"x\":4, \"y\":10, \"vertical\":false},\n          {\"x\":5, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":4, \"y\":7, \"vertical\":true},\n          {\"x\":4, \"y\":8, \"vertical\":true},\n          {\"x\":4, \"y\":9, \"vertical\":true},\n          {\"x\":5, \"y\":7, \"vertical\":true},\n          {\"x\":5, \"y\":8, \"vertical\":true},\n          {\"x\":7, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":9, \"vertical\":false},\n          {\"x\":5, \"y\":9, \"vertical\":false},\n\n          {\"x\":10, \"y\":7, \"vertical\":false},\n          {\"x\":10, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":10, \"vertical\":false},\n          {\"x\":8, \"y\":10, \"vertical\":false},\n          {\"x\":10, \"y\":7, \"vertical\":true},\n          {\"x\":10, \"y\":8, \"vertical\":true},\n          {\"x\":11, \"y\":9, \"vertical\":true},\n          {\"x\":11, \"y\":7, \"vertical\":true},\n          {\"x\":11, \"y\":8, \"vertical\":true},\n          {\"x\":8, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":9, \"vertical\":false},\n          {\"x\":8, \"y\":9, \"vertical\":false},\n\n          {\"x\":5, \"y\":11, \"vertical\":false},\n          {\"x\":6, \"y\":11, \"vertical\":false},\n          {\"x\":7, \"y\":11, \"vertical\":false},\n          {\"x\":8, \"y\":11, \"vertical\":false},\n          {\"x\":9, \"y\":11, \"vertical\":false},\n          {\"x\":10, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":12, \"vertical\":false},\n          {\"x\":6, \"y\":12, \"vertical\":false},\n          {\"x\":8, \"y\":12, \"vertical\":false},\n          {\"x\":9, \"y\":12, \"vertical\":false},\n          {\"x\":7, \"y\":12, \"vertical\":true},\n          {\"x\":8, \"y\":12, \"vertical\":true},\n          {\"x\":7, \"y\":13, \"vertical\":true},\n          {\"x\":8, \"y\":13, \"vertical\":true},\n          {\"x\":7, \"y\":14, \"vertical\":false},\n\n          {\"x\":1, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":false},\n          {\"x\":0, \"y\":14, \"vertical\":false},\n\n          {\"x\":2, \"y\":11, \"vertical\":false},\n          {\"x\":3, \"y\":11, \"vertical\":false},\n          {\"x\":1, \"y\":12, \"vertical\":false},\n          {\"x\":1, \"y\":11, \"vertical\":false},\n          {\"x\":2, \"y\":13, \"vertical\":false},\n          {\"x\":3, \"y\":12, \"vertical\":false},\n          {\"x\":4, \"y\":11, \"vertical\":true},\n          {\"x\":2, \"y\":12, \"vertical\":true},\n          {\"x\":1, \"y\":11, \"vertical\":true},\n          {\"x\":3, \"y\":12, \"vertical\":true},\n\n          {\"x\":4, \"y\":13, \"vertical\":false},\n          {\"x\":5, \"y\":13, \"vertical\":false},\n          {\"x\":4, \"y\":14, \"vertical\":false},\n          {\"x\":5, \"y\":14, \"vertical\":false},\n          {\"x\":4, \"y\":13, \"vertical\":true},\n          {\"x\":6, \"y\":13, \"vertical\":true},\n\n          {\"x\":9, \"y\":13, \"vertical\":false},\n          {\"x\":10, \"y\":13, \"vertical\":false},\n          {\"x\":9, \"y\":14, \"vertical\":false},\n          {\"x\":10, \"y\":14, \"vertical\":false},\n          {\"x\":9, \"y\":13, \"vertical\":true},\n          {\"x\":11, \"y\":13, \"vertical\":true},\n\n          {\"x\":14, \"y\":13, \"vertical\":true},\n          {\"x\":14, \"y\":13, \"vertical\":false},\n          {\"x\":14, \"y\":14, \"vertical\":false},\n\n          {\"x\":11, \"y\":11, \"vertical\":false},\n          {\"x\":13, \"y\":11, \"vertical\":false},\n          {\"x\":11, \"y\":12, \"vertical\":false},\n          {\"x\":12, \"y\":11, \"vertical\":false},\n          {\"x\":12, \"y\":13, \"vertical\":false},\n          {\"x\":13, \"y\":12, \"vertical\":false},\n          {\"x\":14, \"y\":11, \"vertical\":true},\n          {\"x\":12, \"y\":12, \"vertical\":true},\n          {\"x\":11, \"y\":11, \"vertical\":true},\n          {\"x\":13, \"y\":12, \"vertical\":true}\n          \n          \n      ],\n      \"transform\":[\n        {\n          \"type\":\"formula\",\n          \"expr\":\"datum.x+'-'+datum.y+'-'+datum.vertical\",\n          \"as\":\"key\"\n        }\n      ]\n    }\n  ]\n})","pinCode":false,"dname":"af92e4d6-c5d9-4f4f-a19c-9567657ede33","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`\n1. [Responsive Game Area](#game-area)\n2. [PacMan](#pacman)\n3. [Walls](#walls)\n4. [Gums](#gums)\n5. [Ghosts](#ghosts)\n6. [Score](#score)\n7. [Possible Improvments](#improvments)\n\n## <a name=\"game-area\"></a>Responsive Game Area\n\nThe area game will be a grid made of blocks. Each block will represent a possible position for Pacman, a ghost, a gum or a wall.`","pinCode":false,"dname":"a8da6af0-96bd-4545-a195-bad2e2f08c87","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed({\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 600,\n  \"height\":600,\n  \"background\":\"black\",\n  \"signals\":[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t{\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    }\n  ],\n  \"scales\":[\n    {\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }\n  ],\n  \"marks\":[\n    {\n      \"type\":\"group\",\n      \"from\":{\"data\":\"rows\"},\n      \"encode\":{\n        \"enter\":{\n        \"y\":{\"field\":\"data\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\": \"rect\",\n          \"from\":{\"data\":\"columns\"},\n          \"encode\":{\n            \"enter\":{\n              \"x\":{\"field\":\"data\", \"scale\":\"scaleX\"},\n              \"width\":{\"band\":true, \"scale\":\"scaleX\"},\n              \"height\":{\"band\":true, \"scale\":\"scaleY\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"fill\":{\"value\":\"steelblue\"}\n            }\n          }\n        },\n        {\n          \"type\":\"text\",\n          \"from\":{\"data\":\"columns\"},\n          \"encode\":{\n            \"enter\":{\n              \"x\":{\"field\":\"data\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n              \"y\":{\"signal\":\"blockSize/2\"},\n              \"align\":{\"value\":\"center\"},\n              \"baseline\":{\"value\":\"middle\"},\n              \"text\":{\"signal\":\"datum.data + '-' + parent.data\"},\n              \"fontSize\":{\"signal\":\"14*sizeFactor\"}\n            }\n          }\n        }\n      ]\n    }\n  ],\n  \"data\":[\n        {\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    }\n  ]\n})","pinCode":false,"dname":"5e57d8f0-7f86-4ce4-ad17-345d16f2f850","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`It requires the following signals:\n\n`","pinCode":false,"dname":"1be96315-3924-4f43-8572-81d3b8f698d3","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t  {\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    }\n  ]","pinCode":false,"dname":"d9acd9ea-4500-4c24-8bce-8d1ee2e0152a","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md `- \"grid\" contains the grid size (the number of blocks horizontally and vertically)\n\n- \"blockSize\" will represent the size of a block proportionally to the width and height and of the visualization and the size of the grid. As we want the grid to fit the visualization, we divide the minimum size between the width and height of the visualization by the maximum size of the grid.\n\n- \"rangeWidthDelta\" and \"rangeHeightDelta\" will represent the half of unoccupied space in the grid when \"width\" and \"height\" of the visualization or \"width\" and \"height\" of the grid are not the same. This will ensure that our gaming area is always centered in the visualization\n\n- \"sizeFactor\" is very useful to create responsive labels or symbols. Using the \"blockSize\" as reference in a proportion with numbers that will set the factor to 1 when developing your visualization. You will then multiply properties related to size (such as \"fontSize\", or \"symbolSize\") by that factor to keep them in the same proportions as the designing time. Sometimes it’s also useful to use a min and or a max value for that factor, to ensure to avoid objects becoming too big or too small.\n\nIt also requires the following data:\n`","pinCode":false,"dname":"f7a4467b-4c0d-4bd7-99f4-87c9eef36411","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[\n{\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    }]","pinCode":false,"dname":"624d6b36-c83d-4da4-98f8-e5e8dbe1b79c","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`These sequences from 0 to \"grid\" width and height will be used as the domain of the location scales of the game.\n\nFinally we create the location scales:\n`","pinCode":false,"dname":"faaf4e1c-4f88-4157-b6e7-aabcf6dc3f8b","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }]","pinCode":false,"dname":"b48f8e72-868d-4e2a-90a3-c083e32a472c","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`With these scale we can now locate any object in the grid using a column and row index.\n\nThe gaming area will not be represented but to check that everything is working fine, let’s create some marks:\n`","pinCode":false,"dname":"90a35242-3827-46c4-8292-68f42238ca22","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"type\":\"group\",\n      \"from\":{\"data\":\"rows\"},\n      \"encode\":{\n        \"enter\":{\n        \"y\":{\"field\":\"data\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\": \"rect\",\n          \"from\":{\"data\":\"columns\"},\n          \"encode\":{\n            \"enter\":{\n              \"x\":{\"field\":\"data\", \"scale\":\"scaleX\"},\n              \"width\":{\"band\":true, \"scale\":\"scaleX\"},\n              \"height\":{\"band\":true, \"scale\":\"scaleY\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"fill\":{\"value\":\"steelblue\"}\n            }\n          }\n        },\n        {\n          \"type\":\"text\",\n          \"from\":{\"data\":\"columns\"},\n          \"encode\":{\n            \"enter\":{\n              \"x\":{\"field\":\"data\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n              \"y\":{\"signal\":\"blockSize/2\"},\n              \"align\":{\"value\":\"center\"},\n              \"baseline\":{\"value\":\"middle\"},\n              \"text\":{\"signal\":\"datum.data + '-' + parent.data\"},\n              \"fontSize\":{\"signal\":\"14*sizeFactor\"}\n            }\n          }\n        }\n      ]\n    }]","pinCode":false,"dname":"d719a992-ef21-4591-a4de-861787dc3cff","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Once this is done, we can change the \"width\", \"height\" of the visualization and of the grid to check that whatever the values you are using, you always have a grid centered in the visualization, the text never overflowing. You will use the \"blockSize\" and the \"sizeFactor\" signal in the other marks to ensure that the entire visualization will always be responsive.\n\n This is of course optional: you might prefer to use a fixed width and height for the visuzalization, but users are used to responsiveness and it's not a lot of work to achieve it.\n\n ## <a name=\"pacman\"></a>PacMan\n\n Now that we have the game area, let’s create the PacMan.`","pinCode":false,"dname":"7700a5c4-4b81-4d37-8775-a9ada0f00413","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed({\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 600,\n  \"height\":600,\n  \"background\":\"black\",\n  \"signals\":[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t{\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    },\n    {\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset)))\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset)\"}\n      ]\n    },\n    {\n      \"name\":\"pacManIsOpen\",\n      \"init\":\"true\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!pacManIsOpen\"}\n      ]\n    },\n    {\n      \"name\":\"pacManXOffset\",\n      \"update\":\"key === 'ArrowRight' ? 1 : key === 'ArrowLeft' ? -1 : 0\"\n    },\n    {\n      \"name\":\"pacManYOffset\",\n      \"update\":\"key === 'ArrowUp' ? -1 : key === 'ArrowDown' ? 1 : 0\"\n    },\n    {\n      \"name\":\"key\",\n      \"on\":[\n        {\n          \"events\":\"window:keydown\", \"update\":\"event.code\"\n        }\n      ]\n    }\n\n  ],\n  \"scales\":[\n    {\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }\n  ],\n  \"marks\":[\n    {\n      \"type\":\"group\",\n      \"from\":{\"data\":\"rows\"},\n      \"encode\":{\n        \"enter\":{\n        \"y\":{\"field\":\"data\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\": \"rect\",\n          \"from\":{\"data\":\"columns\"},\n          \"encode\":{\n            \"enter\":{\n              \"x\":{\"field\":\"data\", \"scale\":\"scaleX\"},\n              \"width\":{\"band\":true, \"scale\":\"scaleX\"},\n              \"height\":{\"band\":true, \"scale\":\"scaleY\"},\n              \"stroke\":{\"value\":\"blue\"},\n              \"fill\":{\"value\":\"black\"}\n            }\n          }\n        }\n      ]\n    },\n    {\n      \"type\":\"group\",\n      \"name\":\"pacMan\",\n      \"encode\":{\n        \"update\":{\n          \"x\":{\"signal\":\"pacManX\", \"scale\":\"scaleX\"},\n          \"y\":{\"signal\":\"pacManY\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\":\"arc\",\n          \"encode\":{\n            \"enter\":{\n              \"outerRadius\":{\"signal\":\"(blockSize/2)*0.8\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"x\":{\"signal\":\"blockSize/2\"},\n              \"y\":{\"signal\":\"blockSize/2\"}\n\n            },\n            \"update\":{\n              \"fill\":{\"signal\":\"'yellow'\"},\n              \"endAngle\":{\"signal\":\"(pacManIsOpen? 5*PI/2-PI/6:5*PI/2-0.001) * (pacManXOffset ? pacManXOffset : 1)\"},\n              \"startAngle\":{\"signal\":\"(pacManIsOpen? PI/2+PI/6:PI/2) * (pacManXOffset ? pacManXOffset : 1)\"}\n            }\n          }\n        },\n        {\n          \"type\":\"symbol\",\n          \"encode\":{\n            \"enter\":{\n              \"y\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"-blockSize/5\"}},\n              \"size\":{\"signal\":\"pow(blockSize/10, 2)\"},\n              \"fill\":{\"value\":\"black\"}          \n              },\n            \"update\":{\n              \"x\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"2 * (pacManXOffset ? pacManXOffset : 1)\"}}\n            }\n          }\n        }\n      ]\n     }\n  ],\n  \"data\":[\n        {\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    }\n  ]\n})","pinCode":false,"dname":"3780a9ce-396e-4854-9199-5b350fd18505","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Here are the PacMan signals:\n`","pinCode":false,"dname":"99755f4b-5759-4620-ad17-ce32125825c7","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset)))\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset)\"}\n      ]\n    },\n    {\n      \"name\":\"pacManIsOpen\",\n      \"init\":\"true\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!pacManIsOpen\"}\n      ]\n    },\n    {\n      \"name\":\"pacManXOffset\",\n      \"update\":\"key === 'ArrowRight' ? 1 : key === 'ArrowLeft' ? -1 : 0\"\n    },\n    {\n      \"name\":\"pacManYOffset\",\n      \"update\":\"key === 'ArrowUp' ? -1 : key === 'ArrowDown' ? 1 : 0\"\n    },\n    {\n      \"name\":\"key\",\n      \"on\":[\n        {\n          \"events\":\"window:keydown\", \"update\":\"event.code\"\n        }\n      ]\n    }]","pinCode":false,"dname":"5b388744-7a8e-4db5-9e58-3d5328be9523","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- \"key\" will capture the keyboard inputs\n- \"pacManXOffset\" and \"pacManYOffset\" will contain the horizontal and vertical offset to apply to PacMan coordinates according to the arrows of the keyboard\n- \"pacManIsOpen\" is the PacMan mouth animation based on a timer\n- \"pacManX\" and \"pacManY\" represent the location of the PacMan in the grid. There is a test ensuring that PacMan always remains inside the grid.\n\nThis is the mark to create PacMan:\n`","pinCode":false,"dname":"4e09b828-b450-43eb-8e9d-26b9884082a4","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"type\":\"group\",\n      \"name\":\"pacMan\",\n      \"encode\":{\n        \"update\":{\n          \"x\":{\"signal\":\"pacManX\", \"scale\":\"scaleX\"},\n          \"y\":{\"signal\":\"pacManY\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\":\"arc\",\n          \"encode\":{\n            \"enter\":{\n              \"outerRadius\":{\"signal\":\"(blockSize/2)*0.8\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"x\":{\"signal\":\"blockSize/2\"},\n              \"y\":{\"signal\":\"blockSize/2\"}\n\n            },\n            \"update\":{\n              \"fill\":{\"signal\":\"'yellow'\"},\n              \"endAngle\":{\"signal\":\"(pacManIsOpen? 5*PI/2-PI/6:5*PI/2-0.001) * (pacManXOffset ? pacManXOffset : 1)\"},\n              \"startAngle\":{\"signal\":\"(pacManIsOpen? PI/2+PI/6:PI/2) * (pacManXOffset ? pacManXOffset : 1)\"}\n            }\n          }\n        },\n        {\n          \"type\":\"symbol\",\n          \"encode\":{\n            \"enter\":{\n              \"y\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"-blockSize/5\"}},\n              \"size\":{\"signal\":\"pow(blockSize/10, 2)\"},\n              \"fill\":{\"value\":\"black\"}          \n              },\n            \"update\":{\n              \"x\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"2 * (pacManXOffset ? pacManXOffset : 1)\"}}\n            }\n          }\n        }\n      ]\n     }]","pinCode":false,"dname":"cccafbfb-2400-4afa-9316-c24773043922","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Pac man is a group containing one arc for the body and one symbol for the eye. Location is based on \"pacManX\" and \"pacManY\" using the location scales. The size of the arc and symbol are based on \"blockSize\" and \"sizeFactor\". the \"startAngle\" and \"endAngle\" are related to \"pacManIsOpen\" for the angle and \"pacManXoffset\" for the direction.\n\nPacMan is now alive and ready to discover the world!\n\n## <a name=\"walls\"></a>Walls\n\nThe walls are defining the maze and should block the PacMan.`","pinCode":false,"dname":"fb90c411-b2db-4c27-8b63-49f385b14e9b","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed({\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 600,\n  \"height\":600,\n  \"background\":\"black\",\n  \"signals\":[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t{\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    },\n    {\n      \"name\":\"key\",\n      \"on\":[\n        {\n          \"events\":\"window:keydown\", \"update\":\"event.code\"\n        }\n      ]\n    },\n    {\n      \"name\":\"pacManXOffset\",\n      \"update\":\"key === 'ArrowRight' ? 1 : key === 'ArrowLeft' ? -1 : 0\"\n    },\n    {\n      \"name\":\"pacManYOffset\",\n      \"update\":\"key === 'ArrowUp' ? -1 : key === 'ArrowDown' ? 1 : 0\"\n    },\n    {\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"pacManCanMoveX ?((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset))) : pacManX\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"pacManCanMoveY ?((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset) : pacManY\"}\n      ]\n    },\n    {\n      \"name\":\"pacManIsOpen\",\n      \"init\":\"true\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!pacManIsOpen\"}\n      ]\n    },\n    {\n      \"name\":\"pacManHasWallX\",\n      \"update\":\"(pacManXOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-true')) || (pacManXOffset>=0 && indata('walls', 'key', (pacManX + 1) + '-' + pacManY + '-true')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManHasWallY\",\n      \"update\":\"(pacManYOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-false')) || (pacManYOffset>=0 && indata('walls', 'key', pacManX + '-' + (pacManY+1) + '-false')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManCanMoveX\",\n      \"update\":\"!pacManHasWallX\"\n    },\n    {\n      \"name\":\"pacManCanMoveY\",\n      \"update\":\"!pacManHasWallY\"\n    }\n\n  ],\n  \"scales\":[\n    {\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }\n  ],\n  \"marks\":[\n    {\n      \"type\":\"group\",\n      \"name\":\"pacMan\",\n      \"encode\":{\n        \"update\":{\n          \"x\":{\"signal\":\"pacManX\", \"scale\":\"scaleX\"},\n          \"y\":{\"signal\":\"pacManY\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\":\"arc\",\n          \"encode\":{\n            \"enter\":{\n              \"outerRadius\":{\"signal\":\"(blockSize/2)*0.8\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"x\":{\"signal\":\"blockSize/2\"},\n              \"y\":{\"signal\":\"blockSize/2\"}\n\n            },\n            \"update\":{\n              \"fill\":{\"signal\":\"'yellow'\"},\n              \"endAngle\":{\"signal\":\"(pacManIsOpen? 5*PI/2-PI/6:5*PI/2-0.001) * (pacManXOffset ? pacManXOffset : 1)\"},\n              \"startAngle\":{\"signal\":\"(pacManIsOpen? PI/2+PI/6:PI/2) * (pacManXOffset ? pacManXOffset : 1)\"}\n            }\n          }\n        },\n        {\n          \"type\":\"symbol\",\n          \"encode\":{\n            \"enter\":{\n              \"y\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"-blockSize/5\"}},\n              \"size\":{\"signal\":\"pow(blockSize/10, 2)\"},\n              \"fill\":{\"value\":\"black\"}          \n              },\n            \"update\":{\n              \"x\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"2 * (pacManXOffset ? pacManXOffset : 1)\"}}\n            }\n          }\n        }\n      ]\n     },\n     {\n      \"type\":\"rect\",\n      \"from\":{\"data\":\"walls\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"signal\":\"datum.x < grid.width ? datum.x : grid.width-1\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"datum.vertical? (datum.x < grid.width ? datum.x === 0 ? 0 : -1 : blockSize - blockSize/10):0\"}},\n          \"y\":{\"signal\":\"datum.y < grid.height ? datum.y : grid.height-1\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"datum.vertical? 0: datum.y < grid.height? datum.y === 0 ? 0 : -1 : blockSize -blockSize/10\"}},\n          \"fill\":{\"value\":\"blue\"},\n          \"width\":{\"signal\":\"datum.vertical?blockSize/10:blockSize\"},\n          \"height\":{\"signal\":\"datum.vertical?blockSize:blockSize/10\"} \n\n        }\n      }\n    }\n  ],\n  \"data\":[\n        {\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    },\n    { \n      \"name\":\"walls\",\n      \"values\":[\n          {\"x\":0, \"y\":0, \"vertical\":false},\n          {\"x\":1, \"y\":0, \"vertical\":false},\n          {\"x\":2, \"y\":0, \"vertical\":false},\n          {\"x\":3, \"y\":0, \"vertical\":false},\n          {\"x\":4, \"y\":0, \"vertical\":false},\n          {\"x\":5, \"y\":0, \"vertical\":false},\n          {\"x\":6, \"y\":0, \"vertical\":false},\n          {\"x\":7, \"y\":0, \"vertical\":false},\n          {\"x\":8, \"y\":0, \"vertical\":false},\n          {\"x\":9, \"y\":0, \"vertical\":false},\n          {\"x\":10, \"y\":0, \"vertical\":false},\n          {\"x\":11, \"y\":0, \"vertical\":false},\n          {\"x\":12, \"y\":0, \"vertical\":false},\n          {\"x\":13, \"y\":0, \"vertical\":false},\n          {\"x\":14, \"y\":0, \"vertical\":false},\n          {\"x\":0, \"y\":15, \"vertical\":false},\n          {\"x\":1, \"y\":15, \"vertical\":false},\n          {\"x\":2, \"y\":15, \"vertical\":false},\n          {\"x\":3, \"y\":15, \"vertical\":false},\n          {\"x\":4, \"y\":15, \"vertical\":false},\n          {\"x\":5, \"y\":15, \"vertical\":false},\n          {\"x\":6, \"y\":15, \"vertical\":false},\n          {\"x\":7, \"y\":15, \"vertical\":false},\n          {\"x\":8, \"y\":15, \"vertical\":false},\n          {\"x\":9, \"y\":15, \"vertical\":false},\n          {\"x\":10, \"y\":15, \"vertical\":false},\n          {\"x\":11, \"y\":15, \"vertical\":false},\n          {\"x\":12, \"y\":15, \"vertical\":false},\n          {\"x\":13, \"y\":15, \"vertical\":false},\n          {\"x\":14, \"y\":15, \"vertical\":false}, \n\n          {\"x\":0, \"y\":0, \"vertical\":true},\n          {\"x\":0, \"y\":1, \"vertical\":true},\n          {\"x\":0, \"y\":2, \"vertical\":true},\n          {\"x\":0, \"y\":3, \"vertical\":true},\n          {\"x\":0, \"y\":4, \"vertical\":true},\n          {\"x\":0, \"y\":5, \"vertical\":false},\n          {\"x\":1, \"y\":5, \"vertical\":false},\n          {\"x\":2, \"y\":5, \"vertical\":false},\n          {\"x\":0, \"y\":7, \"vertical\":false},\n          {\"x\":1, \"y\":7, \"vertical\":false},\n          {\"x\":2, \"y\":7, \"vertical\":false},\n          {\"x\":0, \"y\":8, \"vertical\":false},\n          {\"x\":1, \"y\":8, \"vertical\":false},\n          {\"x\":0, \"y\":10, \"vertical\":false},\n          {\"x\":1, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":8, \"vertical\":false},\n          {\"x\":3, \"y\":5, \"vertical\":true},\n          {\"x\":3, \"y\":6, \"vertical\":true},\n          {\"x\":3, \"y\":8, \"vertical\":true},\n          {\"x\":3, \"y\":9, \"vertical\":true},\n          {\"x\":0, \"y\":10, \"vertical\":true},\n          {\"x\":0, \"y\":11, \"vertical\":true},\n          {\"x\":0, \"y\":12, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":14, \"vertical\":true},\n\n          {\"x\":15, \"y\":0, \"vertical\":true},\n          {\"x\":15, \"y\":1, \"vertical\":true},\n          {\"x\":15, \"y\":2, \"vertical\":true},\n          {\"x\":15, \"y\":3, \"vertical\":true},\n          {\"x\":15, \"y\":4, \"vertical\":true},\n          {\"x\":12, \"y\":5, \"vertical\":true},\n          {\"x\":14, \"y\":5, \"vertical\":false},\n          {\"x\":13, \"y\":5, \"vertical\":false},\n          {\"x\":14, \"y\":7, \"vertical\":false},\n          {\"x\":13, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":5, \"vertical\":false},\n          {\"x\":12, \"y\":6, \"vertical\":true},\n          {\"x\":14, \"y\":8, \"vertical\":false},\n          {\"x\":13, \"y\":8, \"vertical\":false},\n          {\"x\":14, \"y\":10, \"vertical\":false},\n          {\"x\":13, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":true},\n          {\"x\":12, \"y\":9, \"vertical\":true},\n          {\"x\":15, \"y\":10, \"vertical\":true},\n          {\"x\":15, \"y\":11, \"vertical\":true},\n          {\"x\":15, \"y\":12, \"vertical\":true},\n          {\"x\":15, \"y\":13, \"vertical\":true},\n          {\"x\":15, \"y\":14, \"vertical\":true},\n\n          {\"x\":6, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":6, \"vertical\":false},\n          {\"x\":8, \"y\":5, \"vertical\":true},\n          {\"x\":8, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":3, \"vertical\":false},\n          {\"x\":8, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":4, \"vertical\":true},\n          {\"x\":9, \"y\":3, \"vertical\":true},\n          {\"x\":9, \"y\":4, \"vertical\":true},\n          {\"x\":6, \"y\":3, \"vertical\":true},\n\n          {\"x\":3, \"y\":3, \"vertical\":false},\n          {\"x\":4, \"y\":3, \"vertical\":false},\n          {\"x\":3, \"y\":3, \"vertical\":true},\n          {\"x\":5, \"y\":3, \"vertical\":true},\n          {\"x\":3, \"y\":4, \"vertical\":false},\n          {\"x\":4, \"y\":4, \"vertical\":true},\n          {\"x\":5, \"y\":4, \"vertical\":true},\n          {\"x\":4, \"y\":5, \"vertical\":true},\n          {\"x\":5, \"y\":5, \"vertical\":true},\n          {\"x\":4, \"y\":6, \"vertical\":false},\n\n          {\"x\":10, \"y\":3, \"vertical\":false},\n          {\"x\":11, \"y\":3, \"vertical\":false},\n          {\"x\":10, \"y\":3, \"vertical\":true},\n          {\"x\":12, \"y\":3, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":false},\n          {\"x\":10, \"y\":4, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":true},\n          {\"x\":10, \"y\":5, \"vertical\":true},\n          {\"x\":11, \"y\":5, \"vertical\":true},\n          {\"x\":10, \"y\":6, \"vertical\":false},\n\n          {\"x\":1, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":1, \"vertical\":false},\n          {\"x\":2, \"y\":1, \"vertical\":false},\n          {\"x\":1, \"y\":2, \"vertical\":false},\n          {\"x\":2, \"y\":2, \"vertical\":false},\n          {\"x\":3, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":false},\n          {\"x\":4, \"y\":2, \"vertical\":false},\n          {\"x\":5, \"y\":1, \"vertical\":false},\n          {\"x\":6, \"y\":1, \"vertical\":false},\n          {\"x\":5, \"y\":2, \"vertical\":false},\n          {\"x\":6, \"y\":2, \"vertical\":false},\n          {\"x\":7, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":false},\n          {\"x\":9, \"y\":1, \"vertical\":false},\n          {\"x\":8, \"y\":2, \"vertical\":false},\n          {\"x\":9, \"y\":2, \"vertical\":false},\n          {\"x\":11, \"y\":1, \"vertical\":true},\n          {\"x\":10, \"y\":1, \"vertical\":false},\n          {\"x\":10, \"y\":2, \"vertical\":false},\n          {\"x\":12, \"y\":1, \"vertical\":true},\n          {\"x\":12, \"y\":1, \"vertical\":false},\n          {\"x\":13, \"y\":1, \"vertical\":false},\n          {\"x\":12, \"y\":2, \"vertical\":false},\n          {\"x\":13, \"y\":2, \"vertical\":false},\n          {\"x\":14, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":3, \"vertical\":true},\n          {\"x\":2, \"y\":3, \"vertical\":true}, \n          {\"x\":1, \"y\":3, \"vertical\":false},\n          {\"x\":13, \"y\":4, \"vertical\":false},\n          {\"x\":13, \"y\":3, \"vertical\":true},\n          {\"x\":14, \"y\":3, \"vertical\":true}, \n          {\"x\":13, \"y\":3, \"vertical\":false},\n          {\"x\":1, \"y\":4, \"vertical\":false},\n\n          {\"x\":6, \"y\":7, \"vertical\":true},\n          {\"x\":9, \"y\":7, \"vertical\":true}, \n          {\"x\":7, \"y\":8, \"vertical\":false},\n          {\"x\":6, \"y\":8, \"vertical\":false},\n          {\"x\":8, \"y\":8, \"vertical\":false},\n\n          {\"x\":4, \"y\":7, \"vertical\":false},\n          {\"x\":4, \"y\":10, \"vertical\":false},\n          {\"x\":5, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":4, \"y\":7, \"vertical\":true},\n          {\"x\":4, \"y\":8, \"vertical\":true},\n          {\"x\":4, \"y\":9, \"vertical\":true},\n          {\"x\":5, \"y\":7, \"vertical\":true},\n          {\"x\":5, \"y\":8, \"vertical\":true},\n          {\"x\":7, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":9, \"vertical\":false},\n          {\"x\":5, \"y\":9, \"vertical\":false},\n\n          {\"x\":10, \"y\":7, \"vertical\":false},\n          {\"x\":10, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":10, \"vertical\":false},\n          {\"x\":8, \"y\":10, \"vertical\":false},\n          {\"x\":10, \"y\":7, \"vertical\":true},\n          {\"x\":10, \"y\":8, \"vertical\":true},\n          {\"x\":11, \"y\":9, \"vertical\":true},\n          {\"x\":11, \"y\":7, \"vertical\":true},\n          {\"x\":11, \"y\":8, \"vertical\":true},\n          {\"x\":8, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":9, \"vertical\":false},\n          {\"x\":8, \"y\":9, \"vertical\":false},\n\n          {\"x\":5, \"y\":11, \"vertical\":false},\n          {\"x\":6, \"y\":11, \"vertical\":false},\n          {\"x\":7, \"y\":11, \"vertical\":false},\n          {\"x\":8, \"y\":11, \"vertical\":false},\n          {\"x\":9, \"y\":11, \"vertical\":false},\n          {\"x\":10, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":12, \"vertical\":false},\n          {\"x\":6, \"y\":12, \"vertical\":false},\n          {\"x\":8, \"y\":12, \"vertical\":false},\n          {\"x\":9, \"y\":12, \"vertical\":false},\n          {\"x\":7, \"y\":12, \"vertical\":true},\n          {\"x\":8, \"y\":12, \"vertical\":true},\n          {\"x\":7, \"y\":13, \"vertical\":true},\n          {\"x\":8, \"y\":13, \"vertical\":true},\n          {\"x\":7, \"y\":14, \"vertical\":false},\n\n          {\"x\":1, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":false},\n          {\"x\":0, \"y\":14, \"vertical\":false},\n\n          {\"x\":2, \"y\":11, \"vertical\":false},\n          {\"x\":3, \"y\":11, \"vertical\":false},\n          {\"x\":1, \"y\":12, \"vertical\":false},\n          {\"x\":1, \"y\":11, \"vertical\":false},\n          {\"x\":2, \"y\":13, \"vertical\":false},\n          {\"x\":3, \"y\":12, \"vertical\":false},\n          {\"x\":4, \"y\":11, \"vertical\":true},\n          {\"x\":2, \"y\":12, \"vertical\":true},\n          {\"x\":1, \"y\":11, \"vertical\":true},\n          {\"x\":3, \"y\":12, \"vertical\":true},\n\n          {\"x\":4, \"y\":13, \"vertical\":false},\n          {\"x\":5, \"y\":13, \"vertical\":false},\n          {\"x\":4, \"y\":14, \"vertical\":false},\n          {\"x\":5, \"y\":14, \"vertical\":false},\n          {\"x\":4, \"y\":13, \"vertical\":true},\n          {\"x\":6, \"y\":13, \"vertical\":true},\n\n          {\"x\":9, \"y\":13, \"vertical\":false},\n          {\"x\":10, \"y\":13, \"vertical\":false},\n          {\"x\":9, \"y\":14, \"vertical\":false},\n          {\"x\":10, \"y\":14, \"vertical\":false},\n          {\"x\":9, \"y\":13, \"vertical\":true},\n          {\"x\":11, \"y\":13, \"vertical\":true},\n\n          {\"x\":14, \"y\":13, \"vertical\":true},\n          {\"x\":14, \"y\":13, \"vertical\":false},\n          {\"x\":14, \"y\":14, \"vertical\":false},\n\n          {\"x\":11, \"y\":11, \"vertical\":false},\n          {\"x\":13, \"y\":11, \"vertical\":false},\n          {\"x\":11, \"y\":12, \"vertical\":false},\n          {\"x\":12, \"y\":11, \"vertical\":false},\n          {\"x\":12, \"y\":13, \"vertical\":false},\n          {\"x\":13, \"y\":12, \"vertical\":false},\n          {\"x\":14, \"y\":11, \"vertical\":true},\n          {\"x\":12, \"y\":12, \"vertical\":true},\n          {\"x\":11, \"y\":11, \"vertical\":true},\n          {\"x\":13, \"y\":12, \"vertical\":true}\n          \n          \n      ],\n      \"transform\":[\n        {\n          \"type\":\"formula\",\n          \"expr\":\"datum.x+'-'+datum.y+'-'+datum.vertical\",\n          \"as\":\"key\"\n        }\n      ]\n    }\n  ]\n})","pinCode":false,"dname":"552f237f-b1d1-432e-afaa-762fdbce7c90","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Walls are defined in a data source:\n`","pinCode":false,"dname":"104387f7-36aa-4600-9432-d8758e417f21","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{ \n      \"name\":\"walls\",\n      \"values\":[\n          {\"x\":13, \"y\":15, \"vertical\":false},\n          {\"x\":14, \"y\":15, \"vertical\":false}, \n\n          {\"x\":0, \"y\":0, \"vertical\":true},\n          {\"x\":0, \"y\":1, \"vertical\":true}\n      ],\n      \"transform\":[\n        {\n          \"type\":\"formula\",\n          \"expr\":\"datum.x+'-'+datum.y+'-'+datum.vertical\",\n          \"as\":\"key\"\n        }\n      ]\n}]","pinCode":false,"dname":"8ca437cd-87e5-4284-83e4-b8058e1fad00","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`\n - \"x\" and \"y\" properties are defining the location of the wall\n - \"vertical\" defines the orientation\n\n They are represented using a rect mark:\n`","pinCode":false,"dname":"303eca57-6d73-4be8-aa6a-fb432e194e09","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"type\":\"rect\",\n      \"from\":{\"data\":\"walls\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"signal\":\"datum.x < grid.width ? datum.x : grid.width-1\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"datum.vertical? (datum.x < grid.width ? datum.x === 0 ? 0 : -1 : blockSize - blockSize/10):0\"}},\n          \"y\":{\"signal\":\"datum.y < grid.height ? datum.y : grid.height-1\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"datum.vertical? 0: datum.y < grid.height? datum.y === 0 ? 0 : -1 : blockSize -blockSize/10\"}},\n          \"fill\":{\"value\":\"blue\"},\n          \"width\":{\"signal\":\"datum.vertical?blockSize/10:blockSize\"},\n          \"height\":{\"signal\":\"datum.vertical?blockSize:blockSize/10\"} \n\n        }\n      }\n}]","pinCode":false,"dname":"c49cbe22-189e-4d4b-9c65-141e149fa7dc","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`It will display horizontal or vertical rectangle adjusting the offsets to fit into the grid and to join 2 perpendicular walls.\n\nAs PacMan should not be able to pass trough a wall, we need to add or update some signals:\n`","pinCode":false,"dname":"7aa5489b-e8a1-4a96-83f7-1db4bc50c191","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"pacManCanMoveX ?((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset))) : pacManX\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"pacManCanMoveY ?((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset) : pacManY\"}\n      ]\n    },\n    {\n      \"name\":\"pacManHasWallX\",\n      \"update\":\"(pacManXOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-true')) || (pacManXOffset>=0 && indata('walls', 'key', (pacManX + 1) + '-' + pacManY + '-true')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManHasWallY\",\n      \"update\":\"(pacManYOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-false')) || (pacManYOffset>=0 && indata('walls', 'key', pacManX + '-' + (pacManY+1) + '-false')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManCanMoveX\",\n      \"update\":\"!pacManHasWallX\"\n    },\n    {\n      \"name\":\"pacManCanMoveY\",\n      \"update\":\"!pacManHasWallY\"\n    }]","pinCode":false,"dname":"bd5f584d-d399-4c1b-bc8c-2194e9d5c206","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- \"pacManHasWallX\" and \"pacManHasWally\" are testing if the next coordinates of the pacMan will meet a wall using indata function\n- \"pacManCanMoveX\" and \"pacManCanMoveY\" will check if a move is possible. For the moment it only check for wall but later we will also need to check for ghosts\n-  \"pacManX\" and \"pacManY\" have been update to apply the offset only if the move is allowed\n\nThis system allows us to change or maze without affecting the wall detection. We can also imagine adding a level property in the \"walls\" data source and filter by level, allowing the game to support multiple levels.\n\n## <a name=\"gums\"></a>Gums\n\nThe gums are elements that can be eaten. Some of them are giving the PacMan a big power.`","pinCode":false,"dname":"336db1e1-ed85-443f-8358-7973f2009cb2","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed({\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 600,\n  \"height\":600,\n  \"background\":\"black\",\n  \"signals\":[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t{\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    },\n    {\n      \"name\":\"key\",\n      \"on\":[\n        {\n          \"events\":\"window:keydown\", \"update\":\"event.code\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"null\"\n        }\n      ]\n    },\n    {\n      \"name\":\"pacManXOffset\",\n      \"update\":\"key === 'ArrowRight' ? 1 : key === 'ArrowLeft' ? -1 : 0\"\n    },\n    {\n      \"name\":\"pacManYOffset\",\n      \"update\":\"key === 'ArrowUp' ? -1 : key === 'ArrowDown' ? 1 : 0\"\n    },\n    {\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!restart && pacManCanMoveX ?((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset))) : pacManX\"},\n        {\"events\":{\"signal\":\"restart\"}, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!restart && pacManCanMoveY ?((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset) : pacManY\"},\n        {\"events\":{\"signal\":\"restart\"}, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManIsOpen\",\n      \"init\":\"true\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!pacManIsOpen\"}\n      ]\n    },\n    {\n      \"name\":\"pacManHasWallX\",\n      \"update\":\"(pacManXOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-true')) || (pacManXOffset>=0 && indata('walls', 'key', (pacManX + 1) + '-' + pacManY + '-true')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManHasWallY\",\n      \"update\":\"(pacManYOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-false')) || (pacManYOffset>=0 && indata('walls', 'key', pacManX + '-' + (pacManY+1) + '-false')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManCanMoveX\",\n      \"update\":\"!pacManHasWallX\"\n    },\n    {\n      \"name\":\"pacManCanMoveY\",\n      \"update\":\"!pacManHasWallY\"\n    },\n    {\n      \"name\":\"win\",\n      \"update\":\"length(data('gums')) + length(data('powerGums')) === length(data('eatenGums'))\"\n    },\n    {\n      \"name\":\"restart\",\n      \"update\":\"win === true\"\n    },\n    {\n      \"name\":\"testEaten\",\n      \"update\":\"!restart && (indata('gums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n      \"name\":\"testPowerEaten\",\n      \"update\":\"!restart && (indata('powerGums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n        \"name\":\"superPower\",\n        \"init\":\"0\",\n        \"on\": [{\"events\":{\"type\":\"timer\", \"throttle\": 1000}, \"force\": true, \"update\":\"superPower > 0 ? superPower - 1 : 0\"},\n        {\"events\":{\"signal\":\"testPowerEaten\"}, \"update\":\"testPowerEaten? 15 : superPower\"},\n        {\"events\":{\"signal\":\"restart\"}, \"update\":\"0\"}]\n    }\n\n  ],\n  \"scales\":[\n    {\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }\n  ],\n  \"marks\":[\n     {\n      \"type\":\"rect\",\n      \"from\":{\"data\":\"walls\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"signal\":\"datum.x < grid.width ? datum.x : grid.width-1\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"datum.vertical? (datum.x < grid.width ? datum.x === 0 ? 0 : -1 : blockSize - blockSize/10):0\"}},\n          \"y\":{\"signal\":\"datum.y < grid.height ? datum.y : grid.height-1\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"datum.vertical? 0: datum.y < grid.height? datum.y === 0 ? 0 : -1 : blockSize -blockSize/10\"}},\n          \"fill\":{\"value\":\"blue\"},\n          \"width\":{\"signal\":\"datum.vertical?blockSize/10:blockSize\"},\n          \"height\":{\"signal\":\"datum.vertical?blockSize:blockSize/10\"} \n\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"gums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"grey\"},\n          \"size\":{\"signal\":\"pow(10*sizeFactor, 2)\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"powerGums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"size\":{\"signal\":\"pow(18*sizeFactor, 2)\"},\n          \"fill\":{\"value\":\"white\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"group\",\n      \"name\":\"pacMan\",\n      \"encode\":{\n        \"update\":{\n          \"x\":{\"signal\":\"pacManX\", \"scale\":\"scaleX\"},\n          \"y\":{\"signal\":\"pacManY\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\":\"arc\",\n          \"encode\":{\n            \"enter\":{\n              \"outerRadius\":{\"signal\":\"(blockSize/2)*0.8\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"x\":{\"signal\":\"blockSize/2\"},\n              \"y\":{\"signal\":\"blockSize/2\"}\n\n            },\n            \"update\":{\n              \"fill\":{\"signal\":\"superPower ? 'red' : 'yellow'\"},\n              \"endAngle\":{\"signal\":\"(pacManIsOpen? 5*PI/2-PI/6:5*PI/2-0.001) * (pacManXOffset ? pacManXOffset : 1)\"},\n              \"startAngle\":{\"signal\":\"(pacManIsOpen? PI/2+PI/6:PI/2) * (pacManXOffset ? pacManXOffset : 1)\"}\n            }\n          }\n        },\n        {\n          \"type\":\"symbol\",\n          \"encode\":{\n            \"enter\":{\n              \"y\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"-blockSize/5\"}},\n              \"size\":{\"signal\":\"pow(blockSize/10, 2)\"},\n              \"fill\":{\"value\":\"black\"}          \n              },\n            \"update\":{\n              \"x\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"2 * (pacManXOffset ? pacManXOffset : 1)\"}}\n            }\n          }\n        }\n      ]\n     }\n  ],\n  \"data\":[\n        {\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\":\"gums\",\n      \"values\":[\n{\"x\":0, \"y\":1},\n        {\"x\":0, \"y\":2},\n        {\"x\":0, \"y\":3},\n        {\"x\":0, \"y\":4},\n        {\"x\":0, \"y\":7},\n        {\"x\":0, \"y\":10},\n        {\"x\":0, \"y\":11},\n        {\"x\":0, \"y\":12},\n        {\"x\":0, \"y\":14},\n\n        {\"x\":1, \"y\":0},\n        {\"x\":1, \"y\":2},\n        {\"x\":1, \"y\":4},\n        {\"x\":1, \"y\":7},\n        {\"x\":1, \"y\":10},\n        {\"x\":1, \"y\":12},\n        {\"x\":1, \"y\":13},\n        {\"x\":1, \"y\":14},\n\n        {\"x\":2, \"y\":0},\n        {\"x\":2, \"y\":2},\n        {\"x\":2, \"y\":3},\n        {\"x\":2, \"y\":4},\n        {\"x\":2, \"y\":7},\n        {\"x\":2, \"y\":10},\n        {\"x\":2, \"y\":13},\n        {\"x\":2, \"y\":14},\n\n        {\"x\":3, \"y\":0},\n        {\"x\":3, \"y\":1},\n        {\"x\":3, \"y\":2},\n        {\"x\":3, \"y\":4},\n        {\"x\":3, \"y\":5},\n        {\"x\":3, \"y\":6},\n        {\"x\":3, \"y\":7},\n        {\"x\":3, \"y\":8},\n        {\"x\":3, \"y\":9},\n        {\"x\":3, \"y\":10},\n        {\"x\":3, \"y\":12},\n        {\"x\":3, \"y\":13},\n        {\"x\":3, \"y\":14},\n\n        {\"x\":4, \"y\":0},\n        {\"x\":4, \"y\":2},\n        {\"x\":4, \"y\":6},\n        {\"x\":4, \"y\":10},\n        {\"x\":4, \"y\":11},\n        {\"x\":4, \"y\":12},\n        {\"x\":4, \"y\":14},\n\n        {\"x\":5, \"y\":0},\n        {\"x\":5, \"y\":2},\n        {\"x\":5, \"y\":3},\n        {\"x\":5, \"y\":4},\n        {\"x\":5, \"y\":5},\n        {\"x\":5, \"y\":6},\n        {\"x\":5, \"y\":7},\n        {\"x\":5, \"y\":8},\n        {\"x\":5, \"y\":10},\n        {\"x\":5, \"y\":12},\n        {\"x\":5, \"y\":14},\n\n        {\"x\":6, \"y\":0},\n        {\"x\":6, \"y\":2},\n        {\"x\":6, \"y\":5},\n        {\"x\":6, \"y\":6},\n        {\"x\":6, \"y\":7},\n        {\"x\":6, \"y\":8},\n        {\"x\":6, \"y\":10},\n        {\"x\":6, \"y\":12},\n        {\"x\":6, \"y\":13},\n        {\"x\":6, \"y\":14},\n\n        {\"x\":7, \"y\":0},\n        {\"x\":7, \"y\":1},\n        {\"x\":7, \"y\":2},\n        {\"x\":7, \"y\":6},\n        {\"x\":7, \"y\":8},\n        {\"x\":7, \"y\":9},\n        {\"x\":7, \"y\":10},\n        {\"x\":7, \"y\":14},\n\n        {\"x\":14, \"y\":0},\n        {\"x\":14, \"y\":1},\n        {\"x\":14, \"y\":2},\n        {\"x\":14, \"y\":3},\n        {\"x\":14, \"y\":4},\n        {\"x\":14, \"y\":7},\n        {\"x\":14, \"y\":10},\n        {\"x\":14, \"y\":11},\n        {\"x\":14, \"y\":12},\n        {\"x\":14, \"y\":14},\n\n        {\"x\":13, \"y\":0},\n        {\"x\":13, \"y\":2},\n        {\"x\":13, \"y\":4},\n        {\"x\":13, \"y\":7},\n        {\"x\":13, \"y\":10},\n        {\"x\":13, \"y\":12},\n        {\"x\":13, \"y\":13},\n        {\"x\":13, \"y\":14},\n\n        {\"x\":12, \"y\":0},\n        {\"x\":12, \"y\":2},\n        {\"x\":12, \"y\":3},\n        {\"x\":12, \"y\":4},\n        {\"x\":12, \"y\":7},\n        {\"x\":12, \"y\":10},\n        {\"x\":12, \"y\":13},\n        {\"x\":12, \"y\":14},\n\n        {\"x\":11, \"y\":0},\n        {\"x\":11, \"y\":1},\n        {\"x\":11, \"y\":2},\n        {\"x\":11, \"y\":4},\n        {\"x\":11, \"y\":5},\n        {\"x\":11, \"y\":6},\n        {\"x\":11, \"y\":7},\n        {\"x\":11, \"y\":8},\n        {\"x\":11, \"y\":9},\n        {\"x\":11, \"y\":10},\n        {\"x\":11, \"y\":12},\n        {\"x\":11, \"y\":13},\n        {\"x\":11, \"y\":14},\n\n        {\"x\":10, \"y\":0},\n        {\"x\":10, \"y\":2},\n        {\"x\":10, \"y\":6},\n        {\"x\":10, \"y\":10},\n        {\"x\":10, \"y\":11},\n        {\"x\":10, \"y\":12},\n        {\"x\":10, \"y\":14},\n\n        {\"x\":9, \"y\":0},\n        {\"x\":9, \"y\":2},\n        {\"x\":9, \"y\":3},\n        {\"x\":9, \"y\":4},\n        {\"x\":9, \"y\":5},\n        {\"x\":9, \"y\":6},\n        {\"x\":9, \"y\":7},\n        {\"x\":9, \"y\":8},\n        {\"x\":9, \"y\":10},\n        {\"x\":9, \"y\":12},\n        {\"x\":9, \"y\":14},\n\n        {\"x\":8, \"y\":0},\n        {\"x\":8, \"y\":2},\n        {\"x\":8, \"y\":5},\n        {\"x\":8, \"y\":6},\n        {\"x\":8, \"y\":7},\n        {\"x\":8, \"y\":8},\n        {\"x\":8, \"y\":10},\n        {\"x\":8, \"y\":12},\n        {\"x\":8, \"y\":13},\n        {\"x\":8, \"y\":14}\n        \n      ],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"powerGums\",\n      \"values\":[{\"x\":0, \"y\":0},{\"x\":14, \"y\":0}, {\"x\":0, \"y\":14}, {\"x\":14, \"y\":14}],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"eatenGums\",\n      \"on\":[\n        {\n          \"trigger\":\"testEaten\",\n          \"insert\":\"testEaten\"\n        },\n        {\n          \"trigger\":\"testPowerEaten\",\n          \"insert\":\"testPowerEaten\"\n        },\n        {\n          \"trigger\":\"restart\",\n          \"remove\":\"restart\"\n        }\n      ]\n    },\n    { \n      \"name\":\"walls\",\n      \"values\":[\n          {\"x\":0, \"y\":0, \"vertical\":false},\n          {\"x\":1, \"y\":0, \"vertical\":false},\n          {\"x\":2, \"y\":0, \"vertical\":false},\n          {\"x\":3, \"y\":0, \"vertical\":false},\n          {\"x\":4, \"y\":0, \"vertical\":false},\n          {\"x\":5, \"y\":0, \"vertical\":false},\n          {\"x\":6, \"y\":0, \"vertical\":false},\n          {\"x\":7, \"y\":0, \"vertical\":false},\n          {\"x\":8, \"y\":0, \"vertical\":false},\n          {\"x\":9, \"y\":0, \"vertical\":false},\n          {\"x\":10, \"y\":0, \"vertical\":false},\n          {\"x\":11, \"y\":0, \"vertical\":false},\n          {\"x\":12, \"y\":0, \"vertical\":false},\n          {\"x\":13, \"y\":0, \"vertical\":false},\n          {\"x\":14, \"y\":0, \"vertical\":false},\n          {\"x\":0, \"y\":15, \"vertical\":false},\n          {\"x\":1, \"y\":15, \"vertical\":false},\n          {\"x\":2, \"y\":15, \"vertical\":false},\n          {\"x\":3, \"y\":15, \"vertical\":false},\n          {\"x\":4, \"y\":15, \"vertical\":false},\n          {\"x\":5, \"y\":15, \"vertical\":false},\n          {\"x\":6, \"y\":15, \"vertical\":false},\n          {\"x\":7, \"y\":15, \"vertical\":false},\n          {\"x\":8, \"y\":15, \"vertical\":false},\n          {\"x\":9, \"y\":15, \"vertical\":false},\n          {\"x\":10, \"y\":15, \"vertical\":false},\n          {\"x\":11, \"y\":15, \"vertical\":false},\n          {\"x\":12, \"y\":15, \"vertical\":false},\n          {\"x\":13, \"y\":15, \"vertical\":false},\n          {\"x\":14, \"y\":15, \"vertical\":false}, \n\n          {\"x\":0, \"y\":0, \"vertical\":true},\n          {\"x\":0, \"y\":1, \"vertical\":true},\n          {\"x\":0, \"y\":2, \"vertical\":true},\n          {\"x\":0, \"y\":3, \"vertical\":true},\n          {\"x\":0, \"y\":4, \"vertical\":true},\n          {\"x\":0, \"y\":5, \"vertical\":false},\n          {\"x\":1, \"y\":5, \"vertical\":false},\n          {\"x\":2, \"y\":5, \"vertical\":false},\n          {\"x\":0, \"y\":7, \"vertical\":false},\n          {\"x\":1, \"y\":7, \"vertical\":false},\n          {\"x\":2, \"y\":7, \"vertical\":false},\n          {\"x\":0, \"y\":8, \"vertical\":false},\n          {\"x\":1, \"y\":8, \"vertical\":false},\n          {\"x\":0, \"y\":10, \"vertical\":false},\n          {\"x\":1, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":8, \"vertical\":false},\n          {\"x\":3, \"y\":5, \"vertical\":true},\n          {\"x\":3, \"y\":6, \"vertical\":true},\n          {\"x\":3, \"y\":8, \"vertical\":true},\n          {\"x\":3, \"y\":9, \"vertical\":true},\n          {\"x\":0, \"y\":10, \"vertical\":true},\n          {\"x\":0, \"y\":11, \"vertical\":true},\n          {\"x\":0, \"y\":12, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":14, \"vertical\":true},\n\n          {\"x\":15, \"y\":0, \"vertical\":true},\n          {\"x\":15, \"y\":1, \"vertical\":true},\n          {\"x\":15, \"y\":2, \"vertical\":true},\n          {\"x\":15, \"y\":3, \"vertical\":true},\n          {\"x\":15, \"y\":4, \"vertical\":true},\n          {\"x\":12, \"y\":5, \"vertical\":true},\n          {\"x\":14, \"y\":5, \"vertical\":false},\n          {\"x\":13, \"y\":5, \"vertical\":false},\n          {\"x\":14, \"y\":7, \"vertical\":false},\n          {\"x\":13, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":5, \"vertical\":false},\n          {\"x\":12, \"y\":6, \"vertical\":true},\n          {\"x\":14, \"y\":8, \"vertical\":false},\n          {\"x\":13, \"y\":8, \"vertical\":false},\n          {\"x\":14, \"y\":10, \"vertical\":false},\n          {\"x\":13, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":true},\n          {\"x\":12, \"y\":9, \"vertical\":true},\n          {\"x\":15, \"y\":10, \"vertical\":true},\n          {\"x\":15, \"y\":11, \"vertical\":true},\n          {\"x\":15, \"y\":12, \"vertical\":true},\n          {\"x\":15, \"y\":13, \"vertical\":true},\n          {\"x\":15, \"y\":14, \"vertical\":true},\n\n          {\"x\":6, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":6, \"vertical\":false},\n          {\"x\":8, \"y\":5, \"vertical\":true},\n          {\"x\":8, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":3, \"vertical\":false},\n          {\"x\":8, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":4, \"vertical\":true},\n          {\"x\":9, \"y\":3, \"vertical\":true},\n          {\"x\":9, \"y\":4, \"vertical\":true},\n          {\"x\":6, \"y\":3, \"vertical\":true},\n\n          {\"x\":3, \"y\":3, \"vertical\":false},\n          {\"x\":4, \"y\":3, \"vertical\":false},\n          {\"x\":3, \"y\":3, \"vertical\":true},\n          {\"x\":5, \"y\":3, \"vertical\":true},\n          {\"x\":3, \"y\":4, \"vertical\":false},\n          {\"x\":4, \"y\":4, \"vertical\":true},\n          {\"x\":5, \"y\":4, \"vertical\":true},\n          {\"x\":4, \"y\":5, \"vertical\":true},\n          {\"x\":5, \"y\":5, \"vertical\":true},\n          {\"x\":4, \"y\":6, \"vertical\":false},\n\n          {\"x\":10, \"y\":3, \"vertical\":false},\n          {\"x\":11, \"y\":3, \"vertical\":false},\n          {\"x\":10, \"y\":3, \"vertical\":true},\n          {\"x\":12, \"y\":3, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":false},\n          {\"x\":10, \"y\":4, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":true},\n          {\"x\":10, \"y\":5, \"vertical\":true},\n          {\"x\":11, \"y\":5, \"vertical\":true},\n          {\"x\":10, \"y\":6, \"vertical\":false},\n\n          {\"x\":1, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":1, \"vertical\":false},\n          {\"x\":2, \"y\":1, \"vertical\":false},\n          {\"x\":1, \"y\":2, \"vertical\":false},\n          {\"x\":2, \"y\":2, \"vertical\":false},\n          {\"x\":3, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":false},\n          {\"x\":4, \"y\":2, \"vertical\":false},\n          {\"x\":5, \"y\":1, \"vertical\":false},\n          {\"x\":6, \"y\":1, \"vertical\":false},\n          {\"x\":5, \"y\":2, \"vertical\":false},\n          {\"x\":6, \"y\":2, \"vertical\":false},\n          {\"x\":7, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":false},\n          {\"x\":9, \"y\":1, \"vertical\":false},\n          {\"x\":8, \"y\":2, \"vertical\":false},\n          {\"x\":9, \"y\":2, \"vertical\":false},\n          {\"x\":11, \"y\":1, \"vertical\":true},\n          {\"x\":10, \"y\":1, \"vertical\":false},\n          {\"x\":10, \"y\":2, \"vertical\":false},\n          {\"x\":12, \"y\":1, \"vertical\":true},\n          {\"x\":12, \"y\":1, \"vertical\":false},\n          {\"x\":13, \"y\":1, \"vertical\":false},\n          {\"x\":12, \"y\":2, \"vertical\":false},\n          {\"x\":13, \"y\":2, \"vertical\":false},\n          {\"x\":14, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":3, \"vertical\":true},\n          {\"x\":2, \"y\":3, \"vertical\":true}, \n          {\"x\":1, \"y\":3, \"vertical\":false},\n          {\"x\":13, \"y\":4, \"vertical\":false},\n          {\"x\":13, \"y\":3, \"vertical\":true},\n          {\"x\":14, \"y\":3, \"vertical\":true}, \n          {\"x\":13, \"y\":3, \"vertical\":false},\n          {\"x\":1, \"y\":4, \"vertical\":false},\n\n          {\"x\":6, \"y\":7, \"vertical\":true},\n          {\"x\":9, \"y\":7, \"vertical\":true}, \n          {\"x\":7, \"y\":8, \"vertical\":false},\n          {\"x\":6, \"y\":8, \"vertical\":false},\n          {\"x\":8, \"y\":8, \"vertical\":false},\n\n          {\"x\":4, \"y\":7, \"vertical\":false},\n          {\"x\":4, \"y\":10, \"vertical\":false},\n          {\"x\":5, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":4, \"y\":7, \"vertical\":true},\n          {\"x\":4, \"y\":8, \"vertical\":true},\n          {\"x\":4, \"y\":9, \"vertical\":true},\n          {\"x\":5, \"y\":7, \"vertical\":true},\n          {\"x\":5, \"y\":8, \"vertical\":true},\n          {\"x\":7, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":9, \"vertical\":false},\n          {\"x\":5, \"y\":9, \"vertical\":false},\n\n          {\"x\":10, \"y\":7, \"vertical\":false},\n          {\"x\":10, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":10, \"vertical\":false},\n          {\"x\":8, \"y\":10, \"vertical\":false},\n          {\"x\":10, \"y\":7, \"vertical\":true},\n          {\"x\":10, \"y\":8, \"vertical\":true},\n          {\"x\":11, \"y\":9, \"vertical\":true},\n          {\"x\":11, \"y\":7, \"vertical\":true},\n          {\"x\":11, \"y\":8, \"vertical\":true},\n          {\"x\":8, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":9, \"vertical\":false},\n          {\"x\":8, \"y\":9, \"vertical\":false},\n\n          {\"x\":5, \"y\":11, \"vertical\":false},\n          {\"x\":6, \"y\":11, \"vertical\":false},\n          {\"x\":7, \"y\":11, \"vertical\":false},\n          {\"x\":8, \"y\":11, \"vertical\":false},\n          {\"x\":9, \"y\":11, \"vertical\":false},\n          {\"x\":10, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":12, \"vertical\":false},\n          {\"x\":6, \"y\":12, \"vertical\":false},\n          {\"x\":8, \"y\":12, \"vertical\":false},\n          {\"x\":9, \"y\":12, \"vertical\":false},\n          {\"x\":7, \"y\":12, \"vertical\":true},\n          {\"x\":8, \"y\":12, \"vertical\":true},\n          {\"x\":7, \"y\":13, \"vertical\":true},\n          {\"x\":8, \"y\":13, \"vertical\":true},\n          {\"x\":7, \"y\":14, \"vertical\":false},\n\n          {\"x\":1, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":false},\n          {\"x\":0, \"y\":14, \"vertical\":false},\n\n          {\"x\":2, \"y\":11, \"vertical\":false},\n          {\"x\":3, \"y\":11, \"vertical\":false},\n          {\"x\":1, \"y\":12, \"vertical\":false},\n          {\"x\":1, \"y\":11, \"vertical\":false},\n          {\"x\":2, \"y\":13, \"vertical\":false},\n          {\"x\":3, \"y\":12, \"vertical\":false},\n          {\"x\":4, \"y\":11, \"vertical\":true},\n          {\"x\":2, \"y\":12, \"vertical\":true},\n          {\"x\":1, \"y\":11, \"vertical\":true},\n          {\"x\":3, \"y\":12, \"vertical\":true},\n\n          {\"x\":4, \"y\":13, \"vertical\":false},\n          {\"x\":5, \"y\":13, \"vertical\":false},\n          {\"x\":4, \"y\":14, \"vertical\":false},\n          {\"x\":5, \"y\":14, \"vertical\":false},\n          {\"x\":4, \"y\":13, \"vertical\":true},\n          {\"x\":6, \"y\":13, \"vertical\":true},\n\n          {\"x\":9, \"y\":13, \"vertical\":false},\n          {\"x\":10, \"y\":13, \"vertical\":false},\n          {\"x\":9, \"y\":14, \"vertical\":false},\n          {\"x\":10, \"y\":14, \"vertical\":false},\n          {\"x\":9, \"y\":13, \"vertical\":true},\n          {\"x\":11, \"y\":13, \"vertical\":true},\n\n          {\"x\":14, \"y\":13, \"vertical\":true},\n          {\"x\":14, \"y\":13, \"vertical\":false},\n          {\"x\":14, \"y\":14, \"vertical\":false},\n\n          {\"x\":11, \"y\":11, \"vertical\":false},\n          {\"x\":13, \"y\":11, \"vertical\":false},\n          {\"x\":11, \"y\":12, \"vertical\":false},\n          {\"x\":12, \"y\":11, \"vertical\":false},\n          {\"x\":12, \"y\":13, \"vertical\":false},\n          {\"x\":13, \"y\":12, \"vertical\":false},\n          {\"x\":14, \"y\":11, \"vertical\":true},\n          {\"x\":12, \"y\":12, \"vertical\":true},\n          {\"x\":11, \"y\":11, \"vertical\":true},\n          {\"x\":13, \"y\":12, \"vertical\":true}\n          \n          \n      ],\n      \"transform\":[\n        {\n          \"type\":\"formula\",\n          \"expr\":\"datum.x+'-'+datum.y+'-'+datum.vertical\",\n          \"as\":\"key\"\n        }\n      ]\n    }\n  ]\n})","pinCode":false,"dname":"480a10e5-89e8-4291-9d0a-c21cbdc00970","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`The gums require 3 data sources:\n`","pinCode":false,"dname":"66ff8a90-28e2-4197-acbe-091156a211fc","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"gums\",\n      \"values\":[\n        {\"x\":0, \"y\":1},\n        {\"x\":0, \"y\":2},\n        {\"x\":0, \"y\":3},\n        {\"x\":0, \"y\":4},\n       \n      ],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"powerGums\",\n      \"values\":[{\"x\":0, \"y\":0},{\"x\":14, \"y\":0}, {\"x\":0, \"y\":14}, {\"x\":14, \"y\":14}],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"eatenGums\",\n      \"on\":[\n        {\n          \"trigger\":\"testEaten\",\n          \"insert\":\"testEaten\"\n        },\n        {\n          \"trigger\":\"testPowerEaten\",\n          \"insert\":\"testPowerEaten\"\n        },\n        {\n          \"trigger\":\"restart\",\n          \"remove\":\"restart\"\n        }\n      ]\n    }]","pinCode":false,"dname":"731deb05-45f7-4966-819b-3f0bebb3dab0","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- \"gums\" will contain the location of normal gums\n - \"powerGums\" will contain the location of power gums\n - \"eatenGums\" will contain all the gums eaten by the PacMan\n\n To update the eaten gums and check if PacMan suceed to finish a level we will use the following signals:\n`","pinCode":false,"dname":"4cb0c5f5-707f-4f1c-bb86-ac291f83ae1f","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"win\",\n      \"update\":\"length(data('gums')) + length(data('powerGums')) === length(data('eatenGums'))\"\n    },\n    {\n      \"name\":\"restart\",\n      \"update\":\"win === true\"\n    },\n    {\n      \"name\":\"testEaten\",\n      \"update\":\"!restart && (indata('gums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n      \"name\":\"testPowerEaten\",\n      \"update\":\"!restart && (indata('powerGums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n        \"name\":\"superPower\",\n        \"init\":\"0\",\n        \"on\": [{\"events\":{\"type\":\"timer\", \"throttle\": 1000}, \"force\": true, \"update\":\"superPower > 0 ? superPower - 1 : 0\"},\n        {\"events\":{\"signal\":\"testPowerEaten\"}, \"update\":\"testPowerEaten? 15 : superPower\"},\n        {\"events\":{\"signal\":\"restart\"}, \"update\":\"0\"}]\n    }]","pinCode":false,"dname":"580c5b10-6ead-42c9-9e9b-a58b009161a0","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- \"win\" will evaluate if all the gums have been eaten comparing the size of all gums data sources\n- \"restart\" will be triggered when win is true. It will clear the \"eatenGums\" table and reset PacMan location\n- \"testEaten\" and \"testPowerEaten\" evaluate if the PacMan location meet a gum. They will trigger inserts into the \"eatenGums\" table\n- \"superPower\" is triggered when a powerGum has been eaten. It will set the power mode to 15 seconds\n\nTo render the gums we will use the symbols:\n`","pinCode":false,"dname":"3494ff24-17c7-45ff-a2aa-36fb0ff061fa","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"gums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"grey\"},\n          \"size\":{\"signal\":\"pow(10*sizeFactor, 2)\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"powerGums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"size\":{\"signal\":\"pow(18*sizeFactor, 2)\"},\n          \"fill\":{\"value\":\"white\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    }]","pinCode":false,"dname":"c13177cc-41fb-497b-868b-a498e0118c26","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- the \"opacity\" of the gums will depend of an indata test\n- the location is related to the \"blockSize\" and the size to the \"sizeFactor\" to ensure responsivity\n\n## <a name=\"ghosts\"></a>Ghosts\n\nThe ghost is certainly the most complicated part: because they are not moved by a human we need to create an algorithm that will make them trying to catch PacMan or escape from him trying to avoid:\n-\tfreeze against a wall maze\n-\tOverlapping another ghost\n-\tNot pass through the walls\n-\tBe blocked in a loop\nAnd the challenge is that for the algorithm you can’t rely on custom methods, iteration, or local variable declaration. You will have to rely on signal, data sources and the ternary operator “?:” which is great but not so easy to read or debug.\nTo achieve that we must first simplify the ghosts to one unique ghost and once its algorithm has been approved create the other with the same logic.`","pinCode":false,"dname":"68d9b994-b329-494e-90bf-e0d25eb418c6","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed({\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 600,\n  \"height\":600,\n  \"background\":\"black\",\n  \"signals\":[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t{\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    },\n    {\n      \"name\":\"key\",\n      \"on\":[\n        {\n          \"events\":\"window:keydown\", \"update\":\"event.code\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"null\"\n        }\n      ]\n    },\n    {\n      \"name\":\"pacManXOffset\",\n      \"update\":\"key === 'ArrowRight' ? 1 : key === 'ArrowLeft' ? -1 : 0\"\n    },\n    {\n      \"name\":\"pacManYOffset\",\n      \"update\":\"key === 'ArrowUp' ? -1 : key === 'ArrowDown' ? 1 : 0\"\n    },\n    {\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"(!restart && pacManCanMoveX) ?((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset))) : pacManX\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!restart && pacManCanMoveY ?((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset) : pacManY\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManIsOpen\",\n      \"init\":\"true\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!pacManIsOpen\"}\n      ]\n    },\n    {\n      \"name\":\"pacManHasWallX\",\n      \"update\":\"(pacManXOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-true')) || (pacManXOffset>=0 && indata('walls', 'key', (pacManX + 1) + '-' + pacManY + '-true')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManHasWallY\",\n      \"update\":\"(pacManYOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-false')) || (pacManYOffset>=0 && indata('walls', 'key', pacManX + '-' + (pacManY+1) + '-false')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManCanMoveX\",\n      \"update\":\"!pacManHasWallX && !pacManHasGhost\"\n    },\n    {\n      \"name\":\"pacManCanMoveY\",\n      \"update\":\"!pacManHasWallY  && !pacManHasGhost\"\n    },\n    {\n      \"name\":\"pacManHasGhost\",\n      \"update\":\"!superPower && ((pacManX + pacManXOffset === gRedX) && (pacManY + pacManYOffset === gRedY))\"\n    },\n    {\n      \"name\":\"win\",\n      \"update\":\"length(data('gums')) + length(data('powerGums')) === length(data('eatenGums'))\"\n    },\n    {\n      \"name\":\"loose\",\n      \"on\":[{\"events\":{\"type\":\"timer\", \"throttle\": 400 }, \"update\":\"!superPower && (pacManX === gRedX && pacManY === gRedY)\"}]\n    },\n    {\n      \"name\":\"restart\",\n      \"update\":\"win === true || loose === true\"\n    },\n    {\n      \"name\":\"testEaten\",\n      \"update\":\"!restart && (indata('gums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n      \"name\":\"testPowerEaten\",\n      \"update\":\"!restart && (indata('powerGums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n        \"name\":\"superPower\",\n        \"init\":\"0\",\n        \"on\": [{\"events\":{\"type\":\"timer\", \"throttle\": 1000}, \"force\": true, \"update\":\"superPower > 0 ? superPower - 1 : 0\"},\n        {\"events\":{\"signal\":\"testPowerEaten\"}, \"update\":\"testPowerEaten? 15 : superPower\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"0\"}]\n    }\n    ,\n    {\n      \"name\":\"testEatenGhost\",\n      \"update\":\"superPower ? ((gRedX === pacManX && gRedY === pacManY) ? gRed : null) : null\"\n    },\n\n    {\n      \"name\":\"gRed\",\n      \"init\":\"data('ghosts')[0]\"\n    },\n    {\n      \"name\":\"gRedDelta\",\n      \"update\":\"{dx:pacManX-gRedX, dy: pacManY-gRedY}\"\n    },\n    {\n      \"name\":\"gRedLastDir\",\n      \"update\":\"gRedDirection\"\n    },\n    {\n      \"name\":\"gRedPreferences\",\n      \"update\":\"setdata('gRedDecisions',[{d:'up', i: (gRedLastDir === 'down' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gRedLastDir === 'up' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gRedLastDir === 'right' ? 4 : (abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gRedLastDir === 'left' ? 4 : abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gRedHasWallX\",\n      \"update\":\"(gRedOffsetX<0 && !gRedCanLeft) || (gRedOffsetX>0 && !gRedCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gRedHasWallY\",\n      \"update\":\"(gRedOffsetY<0 && !gRedCanUp) || (gRedOffsetY>0 && !gRedCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gRedCanLeft\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanUp\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedCanRight\",\n      \"update\":\"indata('walls', 'key', (gRedX + 1) + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanDown\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + (gRedY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedHasPacMan\",\n      \"update\":\"superPower && ((gRedX + gRedOffsetX === pacManX) && (gRedY + gRedOffsetY === pacManY))\"\n    },\n    {\n      \"name\":\"gRedBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gRedProposedDirection\"}, \"force\": true, \"update\":\"!gRedProposedDirection ||(gRedProposedDirection === 'up' && !gRedCanUp) || (gRedProposedDirection === 'down' && !gRedCanDown) || (gRedProposedDirection === 'left' && !gRedCanLeft) || (gRedProposedDirection === 'right' && !gRedCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedTry\",\n       \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 350}, \"update\":\"gRedBlocked && gRedTry <3 ? gRedTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedDecision\",\n      \"update\":\"data('gRedDecisions')[gRedTry]\"\n    },\n    {\n      \"name\":\"gRedProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gRedDecision\"}, \"force\": true, \"update\":\"gRedDecision ? gRedDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gRedDirection\",\n      \"update\":\"gRedProposedDirection && !gRedBlocked ? gRedProposedDirection : gRedDirection\"\n    },\n    {\n      \"name\":\"gRedOffsetX\",\n      \"update\":\"gRedDirection === 'left'? - 1 : gRedDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gRedOffsetY\",\n      \"update\":\"gRedDirection === 'up'? -1 : gRedDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gRedX\",\n      \"init\":\"gRed.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 6 : (!restart && !gRedHasWallX && !gRedHasPacMan ? ((gRedOffsetX <0 && gRedX <= 0) ? grid.width - 1 : ((gRedOffsetX > 0 && gRedX >= grid.width -1) ? 0 : (gRedX + gRedOffsetX))) : gRedX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gRed.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedY\",\n      \"init\":\"gRed.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 7 : (!restart && !gRedHasWallY && !gRedHasPacMan ? ((gRedOffsetY <0 && gRedY <= 0) ? grid.height-1 : (gRedOffsetY > 0 && gRedY >= grid.height - 1)? 0 : gRedY + gRedOffsetY) : gRedY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gRed.y\"\n        }\n      ]\n    }\n\n  ],\n  \"scales\":[\n    {\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }\n  ],\n  \"marks\":[\n     {\n      \"type\":\"rect\",\n      \"from\":{\"data\":\"walls\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"signal\":\"datum.x < grid.width ? datum.x : grid.width-1\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"datum.vertical? (datum.x < grid.width ? datum.x === 0 ? 0 : -1 : blockSize - blockSize/10):0\"}},\n          \"y\":{\"signal\":\"datum.y < grid.height ? datum.y : grid.height-1\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"datum.vertical? 0: datum.y < grid.height? datum.y === 0 ? 0 : -1 : blockSize -blockSize/10\"}},\n          \"fill\":{\"value\":\"blue\"},\n          \"width\":{\"signal\":\"datum.vertical?blockSize/10:blockSize\"},\n          \"height\":{\"signal\":\"datum.vertical?blockSize:blockSize/10\"} \n\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"gums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"grey\"},\n          \"size\":{\"signal\":\"pow(10*sizeFactor, 2)\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"powerGums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"size\":{\"signal\":\"pow(18*sizeFactor, 2)\"},\n          \"fill\":{\"value\":\"white\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"group\",\n      \"name\":\"pacMan\",\n      \"encode\":{\n        \"update\":{\n          \"x\":{\"signal\":\"pacManX\", \"scale\":\"scaleX\"},\n          \"y\":{\"signal\":\"pacManY\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\":\"arc\",\n          \"encode\":{\n            \"enter\":{\n              \"outerRadius\":{\"signal\":\"(blockSize/2)*0.8\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"x\":{\"signal\":\"blockSize/2\"},\n              \"y\":{\"signal\":\"blockSize/2\"}\n\n            },\n            \"update\":{\n              \"fill\":{\"signal\":\"superPower ? 'red' : 'yellow'\"},\n              \"endAngle\":{\"signal\":\"(pacManIsOpen? 5*PI/2-PI/6:5*PI/2-0.001) * (pacManXOffset ? pacManXOffset : 1)\"},\n              \"startAngle\":{\"signal\":\"(pacManIsOpen? PI/2+PI/6:PI/2) * (pacManXOffset ? pacManXOffset : 1)\"}\n            }\n          }\n        },\n        {\n          \"type\":\"symbol\",\n          \"encode\":{\n            \"enter\":{\n              \"y\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"-blockSize/5\"}},\n              \"size\":{\"signal\":\"pow(blockSize/10, 2)\"},\n              \"fill\":{\"value\":\"black\"}          \n              },\n            \"update\":{\n              \"x\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"2 * (pacManXOffset ? pacManXOffset : 1)\"}}\n            }\n          }\n        }\n      ]\n     },\n     {\n          \"type\":\"symbol\",\n          \"from\":{\"data\":\"ghosts\"},\n          \"encode\":{\n            \"enter\":{\n              \"size\":{\"signal\":\"pow(blockSize/20,2)\"}\n            },\n            \"update\":{\n              \"x\":{\"signal\":\"gRedX\", \"offset\":{\"signal\":\"blockSize/8\"}, \"scale\":\"scaleX\"},\n              \"y\":{\"signal\":\"gRedY\", \"offset\":{\"signal\":\"blockSize/9\"}, \"scale\":\"scaleY\"},\n              \"shape\":{\"signal\":\"indata('eatenGhosts', 'color', datum.color) ? 'M16.459004,11.555034C15.659003,11.555034 15.009003,12.205034 15.009003,13.005036 15.009003,13.804038 15.659003,14.454039 16.459004,14.454039 17.258005,14.454039 17.909006,13.804038 17.909006,13.005036 17.909006,12.205034 17.258005,11.555034 16.459004,11.555034z M7.5419962,11.555034C6.7429954,11.555034 6.0919949,12.205034 6.0919949,13.005036 6.0919949,13.804038 6.7429954,14.454039 7.5419962,14.454039 8.3419973,14.454039 8.9919979,13.804038 8.9919979,13.005036 8.9919979,12.205034 8.3419973,11.555034 7.5419962,11.555034z M16.459004,9.5550298C18.361006,9.5550298 19.909006,11.103033 19.909006,13.005036 19.909006,14.90804 18.361006,16.454042 16.459004,16.454042 14.557002,16.454042 13.009001,14.90804 13.009001,13.005036 13.009001,11.103033 14.557002,9.5550298 16.459004,9.5550298z M7.5419962,9.5550298C9.4439976,9.5550298 10.991999,11.103033 10.991999,13.005036 10.991999,14.90804 9.4439976,16.454042 7.5419962,16.454042 5.6399948,16.454042 4.091993,14.90804 4.091993,13.005036 4.091993,11.103033 5.6399948,9.5550298 7.5419962,9.5550298z M12,1.9999994C6.4860079,1.9999995,2.0000002,6.3300156,2.0000004,11.650998L2.0000004,28.669975 5.102997,27.200983 8.9929964,29.12896 12.742996,27.202997 16.98201,29.106987 19.895004,27.116999 22,28.439995 22,11.650998C22,6.3300156,17.515,1.9999995,12,1.9999994z M12,0C18.617005,0,24,5.2260117,24,11.650998L24,32.056999 19.940003,29.507988 17.184998,31.390007 12.80101,29.421989 9.0080111,31.369011 5.0820009,29.424004 0,31.827995 0,11.650998C1.8747701E-07,5.2260117,5.3840029,0,12,0z' : 'M13.952596,15.068143C13.767538,15.066144 13.583578,15.095151 13.403586,15.157148 12.252587,15.553147 11.725549,17.163162 12.224572,18.753189 12.725547,20.342192 14.062582,21.309212 15.211566,20.914204 16.362564,20.518204 16.889541,18.908188 16.390579,17.318163 15.968584,15.977162 14.95058,15.077146 13.952596,15.068143z M7.7945876,6.1100698C7.2026091,6.0760732 6.4365583,6.7850791 5.9736071,7.8550807 5.4445558,9.0761004 5.5105953,10.302109 6.1215563,10.590106 6.7316013,10.881108 7.65555,10.126112 8.1855779,8.9070922 8.7145686,7.6860881 8.6485896,6.4610711 8.036592,6.1710754 7.9606028,6.1350642 7.8795486,6.1150752 7.7945876,6.1100698z M15.404559,5.9590679C15.383563,5.9580608 15.362566,5.9580608 15.34157,5.960075 14.674579,6.0020671 14.194539,7.1220723 14.275593,8.4590903 14.354573,9.7981063 14.962543,10.848119 15.631547,10.802114 16.300554,10.759113 16.778579,9.6401005 16.700576,8.3020907 16.622573,7.006074 16.049577,5.980064 15.404559,5.9590679z M12.317589,1.4699259E-05C15.527545,0.0050196948 18.757579,1.2870288 21.236579,3.8010436 24.038576,6.6430793 25.533567,12.005127 25.825559,15.861164 26.09155,19.371191 27.844537,19.518194 30.765552,22.228211 31.592515,22.995216 33.904521,25.825243 28.733512,26.053242 26.619564,26.146244 25.60156,25.739243 21.732549,22.850226 21.235542,22.545214 20.664558,22.733219 20.373542,22.885214 20.017526,23.07122 19.741586,23.925232 19.851572,24.215227 20.16456,25.583237 22.25855,25.135235 23.427553,26.313253 24.41156,27.305252 22.795536,29.807287 18.926586,29.29027 18.926586,29.29027 16.343582,28.587277 13.853597,25.258236 11.910547,25.242245 9.6305823,25.258236 9.6305823,25.258236 9.6305823,25.258236 9.6025672,26.705256 9.6425452,27.10626 10.271573,27.256254 10.777553,27.021252 13.298544,27.736271 14.150593,27.978262 16.663589,31.170292 8.7236018,30.424282 7.0135832,30.263287 7.1875944,30.721283 5.2576051,26.025242 4.2626119,23.604229 2.0076115,22.396212 0.6345674,17.082169 -0.27241354,14.207143 -0.21040192,11.068107 0.84159805,8.2280856 0.97556992,7.8450862 1.1235799,7.5130826 1.2786091,7.1980773 1.8406196,6.0020671 2.5815849,4.8720523 3.5156043,3.863056 5.9166007,1.2680314 9.107573,-0.0049901602 12.317589,1.4699259E-05z'\"},\n              \"fill\":{\"signal\":\"superPower? 'white' :datum.color\"},\n              \"opacity\":[{\"test\":\"restart\", \"value\": 0},{\"signal\":\"superPower?0.8:1\"}]\n            }\n          }\n        }\n  ],\n  \"data\":[\n        {\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    },\n        {\n      \"name\":\"ghosts\",\n      \"values\":[\n      {\n        \"x\":0,\n        \"y\":0,\n        \"color\":\"red\"\n      }\n      ]\n    },\n    {\n      \"name\":\"eatenGhosts\",\n      \"on\": [{\n        \"trigger\":\"testEatenGhost\",\n        \"insert\":\"testEatenGhost\"\n      },\n      {\n        \"trigger\":\"!superPower\",\n        \"remove\":\"!superPower\"\n      }]\n    },\n    {\n      \"name\":\"gRedDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gums\",\n      \"values\":[\n        {\"x\":0, \"y\":1},\n        {\"x\":0, \"y\":2},\n        {\"x\":0, \"y\":3},\n        {\"x\":0, \"y\":4},\n        {\"x\":0, \"y\":7},\n        {\"x\":0, \"y\":10},\n        {\"x\":0, \"y\":11},\n        {\"x\":0, \"y\":12},\n        {\"x\":0, \"y\":14},\n\n        {\"x\":1, \"y\":0},\n        {\"x\":1, \"y\":2},\n        {\"x\":1, \"y\":4},\n        {\"x\":1, \"y\":7},\n        {\"x\":1, \"y\":10},\n        {\"x\":1, \"y\":12},\n        {\"x\":1, \"y\":13},\n        {\"x\":1, \"y\":14},\n\n        {\"x\":2, \"y\":0},\n        {\"x\":2, \"y\":2},\n        {\"x\":2, \"y\":3},\n        {\"x\":2, \"y\":4},\n        {\"x\":2, \"y\":7},\n        {\"x\":2, \"y\":10},\n        {\"x\":2, \"y\":13},\n        {\"x\":2, \"y\":14},\n\n        {\"x\":3, \"y\":0},\n        {\"x\":3, \"y\":1},\n        {\"x\":3, \"y\":2},\n        {\"x\":3, \"y\":4},\n        {\"x\":3, \"y\":5},\n        {\"x\":3, \"y\":6},\n        {\"x\":3, \"y\":7},\n        {\"x\":3, \"y\":8},\n        {\"x\":3, \"y\":9},\n        {\"x\":3, \"y\":10},\n        {\"x\":3, \"y\":12},\n        {\"x\":3, \"y\":13},\n        {\"x\":3, \"y\":14},\n\n        {\"x\":4, \"y\":0},\n        {\"x\":4, \"y\":2},\n        {\"x\":4, \"y\":6},\n        {\"x\":4, \"y\":10},\n        {\"x\":4, \"y\":11},\n        {\"x\":4, \"y\":12},\n        {\"x\":4, \"y\":14},\n\n        {\"x\":5, \"y\":0},\n        {\"x\":5, \"y\":2},\n        {\"x\":5, \"y\":3},\n        {\"x\":5, \"y\":4},\n        {\"x\":5, \"y\":5},\n        {\"x\":5, \"y\":6},\n        {\"x\":5, \"y\":7},\n        {\"x\":5, \"y\":8},\n        {\"x\":5, \"y\":10},\n        {\"x\":5, \"y\":12},\n        {\"x\":5, \"y\":14},\n\n        {\"x\":6, \"y\":0},\n        {\"x\":6, \"y\":2},\n        {\"x\":6, \"y\":5},\n        {\"x\":6, \"y\":6},\n        {\"x\":6, \"y\":7},\n        {\"x\":6, \"y\":8},\n        {\"x\":6, \"y\":10},\n        {\"x\":6, \"y\":12},\n        {\"x\":6, \"y\":13},\n        {\"x\":6, \"y\":14},\n\n        {\"x\":7, \"y\":0},\n        {\"x\":7, \"y\":1},\n        {\"x\":7, \"y\":2},\n        {\"x\":7, \"y\":6},\n        {\"x\":7, \"y\":8},\n        {\"x\":7, \"y\":9},\n        {\"x\":7, \"y\":10},\n        {\"x\":7, \"y\":14},\n\n        {\"x\":14, \"y\":0},\n        {\"x\":14, \"y\":1},\n        {\"x\":14, \"y\":2},\n        {\"x\":14, \"y\":3},\n        {\"x\":14, \"y\":4},\n        {\"x\":14, \"y\":7},\n        {\"x\":14, \"y\":10},\n        {\"x\":14, \"y\":11},\n        {\"x\":14, \"y\":12},\n        {\"x\":14, \"y\":14},\n\n        {\"x\":13, \"y\":0},\n        {\"x\":13, \"y\":2},\n        {\"x\":13, \"y\":4},\n        {\"x\":13, \"y\":7},\n        {\"x\":13, \"y\":10},\n        {\"x\":13, \"y\":12},\n        {\"x\":13, \"y\":13},\n        {\"x\":13, \"y\":14},\n\n        {\"x\":12, \"y\":0},\n        {\"x\":12, \"y\":2},\n        {\"x\":12, \"y\":3},\n        {\"x\":12, \"y\":4},\n        {\"x\":12, \"y\":7},\n        {\"x\":12, \"y\":10},\n        {\"x\":12, \"y\":13},\n        {\"x\":12, \"y\":14},\n\n        {\"x\":11, \"y\":0},\n        {\"x\":11, \"y\":1},\n        {\"x\":11, \"y\":2},\n        {\"x\":11, \"y\":4},\n        {\"x\":11, \"y\":5},\n        {\"x\":11, \"y\":6},\n        {\"x\":11, \"y\":7},\n        {\"x\":11, \"y\":8},\n        {\"x\":11, \"y\":9},\n        {\"x\":11, \"y\":10},\n        {\"x\":11, \"y\":12},\n        {\"x\":11, \"y\":13},\n        {\"x\":11, \"y\":14},\n\n        {\"x\":10, \"y\":0},\n        {\"x\":10, \"y\":2},\n        {\"x\":10, \"y\":6},\n        {\"x\":10, \"y\":10},\n        {\"x\":10, \"y\":11},\n        {\"x\":10, \"y\":12},\n        {\"x\":10, \"y\":14},\n\n        {\"x\":9, \"y\":0},\n        {\"x\":9, \"y\":2},\n        {\"x\":9, \"y\":3},\n        {\"x\":9, \"y\":4},\n        {\"x\":9, \"y\":5},\n        {\"x\":9, \"y\":6},\n        {\"x\":9, \"y\":7},\n        {\"x\":9, \"y\":8},\n        {\"x\":9, \"y\":10},\n        {\"x\":9, \"y\":12},\n        {\"x\":9, \"y\":14},\n\n        {\"x\":8, \"y\":0},\n        {\"x\":8, \"y\":2},\n        {\"x\":8, \"y\":5},\n        {\"x\":8, \"y\":6},\n        {\"x\":8, \"y\":7},\n        {\"x\":8, \"y\":8},\n        {\"x\":8, \"y\":10},\n        {\"x\":8, \"y\":12},\n        {\"x\":8, \"y\":13},\n        {\"x\":8, \"y\":14}\n        \n      ],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"powerGums\",\n      \"values\":[{\"x\":0, \"y\":0},{\"x\":14, \"y\":0}, {\"x\":0, \"y\":14}, {\"x\":14, \"y\":14}],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"eatenGums\",\n      \"on\":[\n        {\n          \"trigger\":\"testEaten\",\n          \"insert\":\"testEaten\"\n        },\n        {\n          \"trigger\":\"testPowerEaten\",\n          \"insert\":\"testPowerEaten\"\n        },\n        {\n          \"trigger\":\"restart\",\n          \"remove\":\"restart\"\n        }\n      ]\n    },\n    { \n      \"name\":\"walls\",\n      \"values\":[\n          {\"x\":0, \"y\":0, \"vertical\":false},\n          {\"x\":1, \"y\":0, \"vertical\":false},\n          {\"x\":2, \"y\":0, \"vertical\":false},\n          {\"x\":3, \"y\":0, \"vertical\":false},\n          {\"x\":4, \"y\":0, \"vertical\":false},\n          {\"x\":5, \"y\":0, \"vertical\":false},\n          {\"x\":6, \"y\":0, \"vertical\":false},\n          {\"x\":7, \"y\":0, \"vertical\":false},\n          {\"x\":8, \"y\":0, \"vertical\":false},\n          {\"x\":9, \"y\":0, \"vertical\":false},\n          {\"x\":10, \"y\":0, \"vertical\":false},\n          {\"x\":11, \"y\":0, \"vertical\":false},\n          {\"x\":12, \"y\":0, \"vertical\":false},\n          {\"x\":13, \"y\":0, \"vertical\":false},\n          {\"x\":14, \"y\":0, \"vertical\":false},\n          {\"x\":0, \"y\":15, \"vertical\":false},\n          {\"x\":1, \"y\":15, \"vertical\":false},\n          {\"x\":2, \"y\":15, \"vertical\":false},\n          {\"x\":3, \"y\":15, \"vertical\":false},\n          {\"x\":4, \"y\":15, \"vertical\":false},\n          {\"x\":5, \"y\":15, \"vertical\":false},\n          {\"x\":6, \"y\":15, \"vertical\":false},\n          {\"x\":7, \"y\":15, \"vertical\":false},\n          {\"x\":8, \"y\":15, \"vertical\":false},\n          {\"x\":9, \"y\":15, \"vertical\":false},\n          {\"x\":10, \"y\":15, \"vertical\":false},\n          {\"x\":11, \"y\":15, \"vertical\":false},\n          {\"x\":12, \"y\":15, \"vertical\":false},\n          {\"x\":13, \"y\":15, \"vertical\":false},\n          {\"x\":14, \"y\":15, \"vertical\":false}, \n\n          {\"x\":0, \"y\":0, \"vertical\":true},\n          {\"x\":0, \"y\":1, \"vertical\":true},\n          {\"x\":0, \"y\":2, \"vertical\":true},\n          {\"x\":0, \"y\":3, \"vertical\":true},\n          {\"x\":0, \"y\":4, \"vertical\":true},\n          {\"x\":0, \"y\":5, \"vertical\":false},\n          {\"x\":1, \"y\":5, \"vertical\":false},\n          {\"x\":2, \"y\":5, \"vertical\":false},\n          {\"x\":0, \"y\":7, \"vertical\":false},\n          {\"x\":1, \"y\":7, \"vertical\":false},\n          {\"x\":2, \"y\":7, \"vertical\":false},\n          {\"x\":0, \"y\":8, \"vertical\":false},\n          {\"x\":1, \"y\":8, \"vertical\":false},\n          {\"x\":0, \"y\":10, \"vertical\":false},\n          {\"x\":1, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":8, \"vertical\":false},\n          {\"x\":3, \"y\":5, \"vertical\":true},\n          {\"x\":3, \"y\":6, \"vertical\":true},\n          {\"x\":3, \"y\":8, \"vertical\":true},\n          {\"x\":3, \"y\":9, \"vertical\":true},\n          {\"x\":0, \"y\":10, \"vertical\":true},\n          {\"x\":0, \"y\":11, \"vertical\":true},\n          {\"x\":0, \"y\":12, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":14, \"vertical\":true},\n\n          {\"x\":15, \"y\":0, \"vertical\":true},\n          {\"x\":15, \"y\":1, \"vertical\":true},\n          {\"x\":15, \"y\":2, \"vertical\":true},\n          {\"x\":15, \"y\":3, \"vertical\":true},\n          {\"x\":15, \"y\":4, \"vertical\":true},\n          {\"x\":12, \"y\":5, \"vertical\":true},\n          {\"x\":14, \"y\":5, \"vertical\":false},\n          {\"x\":13, \"y\":5, \"vertical\":false},\n          {\"x\":14, \"y\":7, \"vertical\":false},\n          {\"x\":13, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":5, \"vertical\":false},\n          {\"x\":12, \"y\":6, \"vertical\":true},\n          {\"x\":14, \"y\":8, \"vertical\":false},\n          {\"x\":13, \"y\":8, \"vertical\":false},\n          {\"x\":14, \"y\":10, \"vertical\":false},\n          {\"x\":13, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":true},\n          {\"x\":12, \"y\":9, \"vertical\":true},\n          {\"x\":15, \"y\":10, \"vertical\":true},\n          {\"x\":15, \"y\":11, \"vertical\":true},\n          {\"x\":15, \"y\":12, \"vertical\":true},\n          {\"x\":15, \"y\":13, \"vertical\":true},\n          {\"x\":15, \"y\":14, \"vertical\":true},\n\n          {\"x\":6, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":6, \"vertical\":false},\n          {\"x\":8, \"y\":5, \"vertical\":true},\n          {\"x\":8, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":3, \"vertical\":false},\n          {\"x\":8, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":4, \"vertical\":true},\n          {\"x\":9, \"y\":3, \"vertical\":true},\n          {\"x\":9, \"y\":4, \"vertical\":true},\n          {\"x\":6, \"y\":3, \"vertical\":true},\n\n          {\"x\":3, \"y\":3, \"vertical\":false},\n          {\"x\":4, \"y\":3, \"vertical\":false},\n          {\"x\":3, \"y\":3, \"vertical\":true},\n          {\"x\":5, \"y\":3, \"vertical\":true},\n          {\"x\":3, \"y\":4, \"vertical\":false},\n          {\"x\":4, \"y\":4, \"vertical\":true},\n          {\"x\":5, \"y\":4, \"vertical\":true},\n          {\"x\":4, \"y\":5, \"vertical\":true},\n          {\"x\":5, \"y\":5, \"vertical\":true},\n          {\"x\":4, \"y\":6, \"vertical\":false},\n\n          {\"x\":10, \"y\":3, \"vertical\":false},\n          {\"x\":11, \"y\":3, \"vertical\":false},\n          {\"x\":10, \"y\":3, \"vertical\":true},\n          {\"x\":12, \"y\":3, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":false},\n          {\"x\":10, \"y\":4, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":true},\n          {\"x\":10, \"y\":5, \"vertical\":true},\n          {\"x\":11, \"y\":5, \"vertical\":true},\n          {\"x\":10, \"y\":6, \"vertical\":false},\n\n          {\"x\":1, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":1, \"vertical\":false},\n          {\"x\":2, \"y\":1, \"vertical\":false},\n          {\"x\":1, \"y\":2, \"vertical\":false},\n          {\"x\":2, \"y\":2, \"vertical\":false},\n          {\"x\":3, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":false},\n          {\"x\":4, \"y\":2, \"vertical\":false},\n          {\"x\":5, \"y\":1, \"vertical\":false},\n          {\"x\":6, \"y\":1, \"vertical\":false},\n          {\"x\":5, \"y\":2, \"vertical\":false},\n          {\"x\":6, \"y\":2, \"vertical\":false},\n          {\"x\":7, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":false},\n          {\"x\":9, \"y\":1, \"vertical\":false},\n          {\"x\":8, \"y\":2, \"vertical\":false},\n          {\"x\":9, \"y\":2, \"vertical\":false},\n          {\"x\":11, \"y\":1, \"vertical\":true},\n          {\"x\":10, \"y\":1, \"vertical\":false},\n          {\"x\":10, \"y\":2, \"vertical\":false},\n          {\"x\":12, \"y\":1, \"vertical\":true},\n          {\"x\":12, \"y\":1, \"vertical\":false},\n          {\"x\":13, \"y\":1, \"vertical\":false},\n          {\"x\":12, \"y\":2, \"vertical\":false},\n          {\"x\":13, \"y\":2, \"vertical\":false},\n          {\"x\":14, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":3, \"vertical\":true},\n          {\"x\":2, \"y\":3, \"vertical\":true}, \n          {\"x\":1, \"y\":3, \"vertical\":false},\n          {\"x\":13, \"y\":4, \"vertical\":false},\n          {\"x\":13, \"y\":3, \"vertical\":true},\n          {\"x\":14, \"y\":3, \"vertical\":true}, \n          {\"x\":13, \"y\":3, \"vertical\":false},\n          {\"x\":1, \"y\":4, \"vertical\":false},\n\n          {\"x\":6, \"y\":7, \"vertical\":true},\n          {\"x\":9, \"y\":7, \"vertical\":true}, \n          {\"x\":7, \"y\":8, \"vertical\":false},\n          {\"x\":6, \"y\":8, \"vertical\":false},\n          {\"x\":8, \"y\":8, \"vertical\":false},\n\n          {\"x\":4, \"y\":7, \"vertical\":false},\n          {\"x\":4, \"y\":10, \"vertical\":false},\n          {\"x\":5, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":4, \"y\":7, \"vertical\":true},\n          {\"x\":4, \"y\":8, \"vertical\":true},\n          {\"x\":4, \"y\":9, \"vertical\":true},\n          {\"x\":5, \"y\":7, \"vertical\":true},\n          {\"x\":5, \"y\":8, \"vertical\":true},\n          {\"x\":7, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":9, \"vertical\":false},\n          {\"x\":5, \"y\":9, \"vertical\":false},\n\n          {\"x\":10, \"y\":7, \"vertical\":false},\n          {\"x\":10, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":10, \"vertical\":false},\n          {\"x\":8, \"y\":10, \"vertical\":false},\n          {\"x\":10, \"y\":7, \"vertical\":true},\n          {\"x\":10, \"y\":8, \"vertical\":true},\n          {\"x\":11, \"y\":9, \"vertical\":true},\n          {\"x\":11, \"y\":7, \"vertical\":true},\n          {\"x\":11, \"y\":8, \"vertical\":true},\n          {\"x\":8, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":9, \"vertical\":false},\n          {\"x\":8, \"y\":9, \"vertical\":false},\n\n          {\"x\":5, \"y\":11, \"vertical\":false},\n          {\"x\":6, \"y\":11, \"vertical\":false},\n          {\"x\":7, \"y\":11, \"vertical\":false},\n          {\"x\":8, \"y\":11, \"vertical\":false},\n          {\"x\":9, \"y\":11, \"vertical\":false},\n          {\"x\":10, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":12, \"vertical\":false},\n          {\"x\":6, \"y\":12, \"vertical\":false},\n          {\"x\":8, \"y\":12, \"vertical\":false},\n          {\"x\":9, \"y\":12, \"vertical\":false},\n          {\"x\":7, \"y\":12, \"vertical\":true},\n          {\"x\":8, \"y\":12, \"vertical\":true},\n          {\"x\":7, \"y\":13, \"vertical\":true},\n          {\"x\":8, \"y\":13, \"vertical\":true},\n          {\"x\":7, \"y\":14, \"vertical\":false},\n\n          {\"x\":1, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":false},\n          {\"x\":0, \"y\":14, \"vertical\":false},\n\n          {\"x\":2, \"y\":11, \"vertical\":false},\n          {\"x\":3, \"y\":11, \"vertical\":false},\n          {\"x\":1, \"y\":12, \"vertical\":false},\n          {\"x\":1, \"y\":11, \"vertical\":false},\n          {\"x\":2, \"y\":13, \"vertical\":false},\n          {\"x\":3, \"y\":12, \"vertical\":false},\n          {\"x\":4, \"y\":11, \"vertical\":true},\n          {\"x\":2, \"y\":12, \"vertical\":true},\n          {\"x\":1, \"y\":11, \"vertical\":true},\n          {\"x\":3, \"y\":12, \"vertical\":true},\n\n          {\"x\":4, \"y\":13, \"vertical\":false},\n          {\"x\":5, \"y\":13, \"vertical\":false},\n          {\"x\":4, \"y\":14, \"vertical\":false},\n          {\"x\":5, \"y\":14, \"vertical\":false},\n          {\"x\":4, \"y\":13, \"vertical\":true},\n          {\"x\":6, \"y\":13, \"vertical\":true},\n\n          {\"x\":9, \"y\":13, \"vertical\":false},\n          {\"x\":10, \"y\":13, \"vertical\":false},\n          {\"x\":9, \"y\":14, \"vertical\":false},\n          {\"x\":10, \"y\":14, \"vertical\":false},\n          {\"x\":9, \"y\":13, \"vertical\":true},\n          {\"x\":11, \"y\":13, \"vertical\":true},\n\n          {\"x\":14, \"y\":13, \"vertical\":true},\n          {\"x\":14, \"y\":13, \"vertical\":false},\n          {\"x\":14, \"y\":14, \"vertical\":false},\n\n          {\"x\":11, \"y\":11, \"vertical\":false},\n          {\"x\":13, \"y\":11, \"vertical\":false},\n          {\"x\":11, \"y\":12, \"vertical\":false},\n          {\"x\":12, \"y\":11, \"vertical\":false},\n          {\"x\":12, \"y\":13, \"vertical\":false},\n          {\"x\":13, \"y\":12, \"vertical\":false},\n          {\"x\":14, \"y\":11, \"vertical\":true},\n          {\"x\":12, \"y\":12, \"vertical\":true},\n          {\"x\":11, \"y\":11, \"vertical\":true},\n          {\"x\":13, \"y\":12, \"vertical\":true}\n          \n          \n      ],\n      \"transform\":[\n        {\n          \"type\":\"formula\",\n          \"expr\":\"datum.x+'-'+datum.y+'-'+datum.vertical\",\n          \"as\":\"key\"\n        }\n      ]\n    }\n  ]\n})","pinCode":false,"dname":"b98baac5-0b31-4b7d-b46b-a26107ea3f8a","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Here is the approach for the ghost “IA”.\n- First, I tried to use the delta of the ghost position and PacMan position to set the ghost direction. But when the ghost met a wall in is way to PacMan it stays without moving.\n- I then added a condition checking if the ghost was blocked and if it was, to move in the direction transversal. The ghost was not blocked but enter in loops going backward and forward.\n- I finally opted for a table of preferences: according to the delta with PacMan it will ordonate the directions it want to follow, using the opposite of the last chosen direction as the last wish.\nWhen a ghost is blocked a timer change the directions index so that the ghost will always select the path that doesn’t block going backward being always the last option. To avoid circular references, I was forced to use a timer and I had to calibrate experimentally the delay to change the direction index.\n\nEach ghost will require the same set of signal and data.\nThe data sources are:\n`","pinCode":false,"dname":"2e77f08f-924a-4bf4-a37b-4b21bb056512","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"ghosts\",\n      \"values\":[\n      {\n        \"x\":0,\n        \"y\":0,\n        \"color\":\"red\"\n      }\n      ]\n    },\n    {\n      \"name\":\"eatenGhosts\",\n      \"on\": [{\n        \"trigger\":\"testEatenGhost\",\n        \"insert\":\"testEatenGhost\"\n      },\n      {\n        \"trigger\":\"!superPower\",\n        \"remove\":\"!superPower\"\n      }]\n    },\n    {\n      \"name\":\"gRedDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    }]","pinCode":false,"dname":"2f4c54f9-64e9-46b0-89c3-e73a1cc9b59b","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- the \"ghosts\" table will contain the initial location and the color of each ghost\n- the \"eatenGhosts\" table will the ghosts eaten by PacMan when the super mode is activated\n- the \"g(ColorOfTheGhost)Decisions\" table will store and order the desired directions for each ghost\n\nThe signals are:\n`","pinCode":false,"dname":"12f3d22f-b720-4d9c-906c-28089e41f55e","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"gRed\",\n      \"init\":\"data('ghosts')[0]\"\n    },\n    {\n      \"name\":\"gRedDelta\",\n      \"update\":\"{dx:pacManX-gRedX, dy: pacManY-gRedY}\"\n    },\n    {\n      \"name\":\"gRedLastDir\",\n      \"update\":\"gRedDirection\"\n    },\n    {\n      \"name\":\"gRedPreferences\",\n      \"update\":\"setdata('gRedDecisions',[{d:'up', i: (gRedLastDir === 'down' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gRedLastDir === 'up' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gRedLastDir === 'right' ? 4 : (abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gRedLastDir === 'left' ? 4 : abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gRedHasWallX\",\n      \"update\":\"(gRedOffsetX<0 && !gRedCanLeft) || (gRedOffsetX>0 && !gRedCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gRedHasWallY\",\n      \"update\":\"(gRedOffsetY<0 && !gRedCanUp) || (gRedOffsetY>0 && !gRedCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gRedCanLeft\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanUp\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedCanRight\",\n      \"update\":\"indata('walls', 'key', (gRedX + 1) + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanDown\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + (gRedY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedHasPacMan\",\n      \"update\":\"superPower && ((gRedX + gRedOffsetX === pacManX) && (gRedY + gRedOffsetY === pacManY))\"\n    },\n    {\n      \"name\":\"gRedBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gRedProposedDirection\"}, \"force\": true, \"update\":\"!gRedProposedDirection ||(gRedProposedDirection === 'up' && !gRedCanUp) || (gRedProposedDirection === 'down' && !gRedCanDown) || (gRedProposedDirection === 'left' && !gRedCanLeft) || (gRedProposedDirection === 'right' && !gRedCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedTry\",\n       \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 350}, \"update\":\"gRedBlocked && gRedTry <3 ? gRedTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedDecision\",\n      \"update\":\"data('gRedDecisions')[gRedTry]\"\n    },\n    {\n      \"name\":\"gRedProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gRedDecision\"}, \"force\": true, \"update\":\"gRedDecision ? gRedDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gRedDirection\",\n      \"update\":\"gRedProposedDirection && !gRedBlocked ? gRedProposedDirection : gRedDirection\"\n    },\n    {\n      \"name\":\"gRedOffsetX\",\n      \"update\":\"gRedDirection === 'left'? - 1 : gRedDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gRedOffsetY\",\n      \"update\":\"gRedDirection === 'up'? -1 : gRedDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gRedX\",\n      \"init\":\"gRed.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 6 : (!restart && !gRedHasWallX && !gRedHasPacMan ? ((gRedOffsetX <0 && gRedX <= 0) ? grid.width - 1 : ((gRedOffsetX > 0 && gRedX >= grid.width -1) ? 0 : (gRedX + gRedOffsetX))) : gRedX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gRed.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedY\",\n      \"init\":\"gRed.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 7 : (!restart && !gRedHasWallY && !gRedHasPacMan ? ((gRedOffsetY <0 && gRedY <= 0) ? grid.height-1 : (gRedOffsetY > 0 && gRedY >= grid.height - 1)? 0 : gRedY + gRedOffsetY) : gRedY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gRed.y\"\n        }\n      ]\n    }]","pinCode":false,"dname":"48774d4e-68a4-43f2-8a70-c4926f2f2e00","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- \"gColorOfGhost\" is the object from data source ghost representing a specific ghost\n- \"gColorOfGhosX\" and \"gColorOfGhostY\"are the current location of the ghost. They are updated periodically\n-\t\"gColorOfGhostDelta\" is the delta between PacMan and a ghost\n-\t\"gColorOfGhostLastDirection\" stores the last direction took by the ghost\n-\t\"gColorOfGhostPreferences\" is the decision table\n-\t\"gColorOfGhostHasWallX\", \"gColorOfGhostHasWallY\", \"gColorOfGhostCanMoveUp\", \"gColorOfGhostCanMoveDown\", \"gColorOfGhostCanMoveLeft\", \"gColorOfGhostCanMoveRight\", \"gColorOfGhostHasPacMan\" handle of collision detection with walls or pacMan or other ghosts\n-\t\"gColorOfGhostBlocked\" checks if the proposed direction is blocking the ghost\n- \"gColorOfGhostTry\" is the desired direction decision index\n-\t\"gColorOfGhostDecision\" is the current decision from decisions table\n-\t\"gColorOfGhostProposedDirection\": the current desired direction\n-\t\"gColorOfGhostDirection\", \"gColorOfGhostOffsetX\", \"gColorOfGhostOffsetY\": the current validated direction and related ghost offset\n-\t\"gColorOfGhostX\", \"gColorOfGhost\": the current ghost location\n\nPacMan can eat ghosts but can also loose the game when eaten by a ghost.\nOther signals are added or updated:\n`","pinCode":false,"dname":"da870fff-6964-4f3f-9029-e361c59dde54","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"testEatenGhost\",\n      \"update\":\"superPower ? ((gRedX === pacManX && gRedY === pacManY) ? gRed : null) : null\"\n    },\n    {\n      \"name\":\"pacManHasGhost\",\n      \"update\":\"!superPower && ((pacManX + pacManXOffset === gRedX) && (pacManY + pacManYOffset === gRedY))\"\n    },\n    {\n      \"name\":\"loose\",\n      \"on\":[{\"events\":{\"type\":\"timer\", \"throttle\": 400 }, \"update\":\"!superPower && (pacManX === gRedX && pacManY === gRedY)\"}]\n    }]","pinCode":false,"dname":"413cf674-dbd3-473c-a8b1-2fb00e217b63","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`- \"testEatenGhost\" will update the eatenGhosts table when PacMan is in powerMode\n- \"pacManHasGhost\" will test if the next move will meet a Ghost\n- \"loose\" will check if a ghost has eaten PacMan and trigger a game restart\n\nThe ghosts are represented as a symbol mark with a custom shape:`","pinCode":false,"dname":"c005a092-31f2-4176-b3ad-a0db812be6d6","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n          \"type\":\"symbol\",\n          \"from\":{\"data\":\"ghosts\"},\n          \"encode\":{\n            \"enter\":{\n              \"size\":{\"signal\":\"pow(blockSize/20,2)\"}\n            },\n            \"update\":{\n              \"x\":{\"signal\":\"gRedX\", \"offset\":{\"signal\":\"blockSize/8\"}, \"scale\":\"scaleX\"},\n              \"y\":{\"signal\":\"gRedY\", \"offset\":{\"signal\":\"blockSize/9\"}, \"scale\":\"scaleY\"},\n              \"shape\":{\"signal\":\"indata('eatenGhosts', 'color', datum.color) ? 'M16.459004,11.555034C15.659003,11.555034 15.009003,12.205034 15.009003,13.005036 15.009003,13.804038 15.659003,14.454039 16.459004,14.454039 17.258005,14.454039 17.909006,13.804038 17.909006,13.005036 17.909006,12.205034 17.258005,11.555034 16.459004,11.555034z M7.5419962,11.555034C6.7429954,11.555034 6.0919949,12.205034 6.0919949,13.005036 6.0919949,13.804038 6.7429954,14.454039 7.5419962,14.454039 8.3419973,14.454039 8.9919979,13.804038 8.9919979,13.005036 8.9919979,12.205034 8.3419973,11.555034 7.5419962,11.555034z M16.459004,9.5550298C18.361006,9.5550298 19.909006,11.103033 19.909006,13.005036 19.909006,14.90804 18.361006,16.454042 16.459004,16.454042 14.557002,16.454042 13.009001,14.90804 13.009001,13.005036 13.009001,11.103033 14.557002,9.5550298 16.459004,9.5550298z M7.5419962,9.5550298C9.4439976,9.5550298 10.991999,11.103033 10.991999,13.005036 10.991999,14.90804 9.4439976,16.454042 7.5419962,16.454042 5.6399948,16.454042 4.091993,14.90804 4.091993,13.005036 4.091993,11.103033 5.6399948,9.5550298 7.5419962,9.5550298z M12,1.9999994C6.4860079,1.9999995,2.0000002,6.3300156,2.0000004,11.650998L2.0000004,28.669975 5.102997,27.200983 8.9929964,29.12896 12.742996,27.202997 16.98201,29.106987 19.895004,27.116999 22,28.439995 22,11.650998C22,6.3300156,17.515,1.9999995,12,1.9999994z M12,0C18.617005,0,24,5.2260117,24,11.650998L24,32.056999 19.940003,29.507988 17.184998,31.390007 12.80101,29.421989 9.0080111,31.369011 5.0820009,29.424004 0,31.827995 0,11.650998C1.8747701E-07,5.2260117,5.3840029,0,12,0z' : 'M13.952596,15.068143C13.767538,15.066144 13.583578,15.095151 13.403586,15.157148 12.252587,15.553147 11.725549,17.163162 12.224572,18.753189 12.725547,20.342192 14.062582,21.309212 15.211566,20.914204 16.362564,20.518204 16.889541,18.908188 16.390579,17.318163 15.968584,15.977162 14.95058,15.077146 13.952596,15.068143z M7.7945876,6.1100698C7.2026091,6.0760732 6.4365583,6.7850791 5.9736071,7.8550807 5.4445558,9.0761004 5.5105953,10.302109 6.1215563,10.590106 6.7316013,10.881108 7.65555,10.126112 8.1855779,8.9070922 8.7145686,7.6860881 8.6485896,6.4610711 8.036592,6.1710754 7.9606028,6.1350642 7.8795486,6.1150752 7.7945876,6.1100698z M15.404559,5.9590679C15.383563,5.9580608 15.362566,5.9580608 15.34157,5.960075 14.674579,6.0020671 14.194539,7.1220723 14.275593,8.4590903 14.354573,9.7981063 14.962543,10.848119 15.631547,10.802114 16.300554,10.759113 16.778579,9.6401005 16.700576,8.3020907 16.622573,7.006074 16.049577,5.980064 15.404559,5.9590679z M12.317589,1.4699259E-05C15.527545,0.0050196948 18.757579,1.2870288 21.236579,3.8010436 24.038576,6.6430793 25.533567,12.005127 25.825559,15.861164 26.09155,19.371191 27.844537,19.518194 30.765552,22.228211 31.592515,22.995216 33.904521,25.825243 28.733512,26.053242 26.619564,26.146244 25.60156,25.739243 21.732549,22.850226 21.235542,22.545214 20.664558,22.733219 20.373542,22.885214 20.017526,23.07122 19.741586,23.925232 19.851572,24.215227 20.16456,25.583237 22.25855,25.135235 23.427553,26.313253 24.41156,27.305252 22.795536,29.807287 18.926586,29.29027 18.926586,29.29027 16.343582,28.587277 13.853597,25.258236 11.910547,25.242245 9.6305823,25.258236 9.6305823,25.258236 9.6305823,25.258236 9.6025672,26.705256 9.6425452,27.10626 10.271573,27.256254 10.777553,27.021252 13.298544,27.736271 14.150593,27.978262 16.663589,31.170292 8.7236018,30.424282 7.0135832,30.263287 7.1875944,30.721283 5.2576051,26.025242 4.2626119,23.604229 2.0076115,22.396212 0.6345674,17.082169 -0.27241354,14.207143 -0.21040192,11.068107 0.84159805,8.2280856 0.97556992,7.8450862 1.1235799,7.5130826 1.2786091,7.1980773 1.8406196,6.0020671 2.5815849,4.8720523 3.5156043,3.863056 5.9166007,1.2680314 9.107573,-0.0049901602 12.317589,1.4699259E-05z'\"},\n              \"fill\":{\"signal\":\"superPower? 'white' :datum.color\"},\n              \"opacity\":[{\"test\":\"restart\", \"value\": 0},{\"signal\":\"superPower?0.8:1\"}]\n            }\n          }\n        }]","pinCode":false,"dname":"0d733791-79aa-4e37-b5fd-999180ee50dd","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`The size of the ghost will be related to the \"blockSize\" to ensure responsivity.\n\nTo create all the ghost, once the IA has been validated on one ghost, we just have to copy past the signals ghost related and update the pacMan ghost detection.\n\nBecause the ghosts were ending to overlap. I had to add a ghost detection signal on some ghosts:\n`","pinCode":false,"dname":"ad2afc96-74fe-4031-ad9e-075600edb669","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"gBlueHasGhost\",\n      \"update\":\"(gBlueX == gRedX && gBlueY === gRedY)\"\n    },\n    {\n      \"name\":\"gGreenHasGhost\",\n      \"update\":\"(gGreenX === gRedX && gGreenY === gRedY) || (gGreenX === gBlueX && gGreenY+gGreenOffsetY === gBlueY)\"\n    },\n    {\n      \"name\":\"gOrangeHasGhost\",\n      \"update\":\"(gOrangeX === gRedX && gOrangeY === gRedY) || (gOrangeX === gBlueX && gOrangeY === gBlueY) || (gOrangeX === gGreenX && gOrangeY === gGreenY)\"\n    }]","pinCode":false,"dname":"0acd3011-8472-4553-a1bb-deb047b6910d","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`Some ghosts won't move when overlapped.`","pinCode":false,"dname":"f053f2aa-732d-43f2-9e21-032392af694a","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"embed({\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 600,\n  \"height\":600,\n  \"background\":\"black\",\n  \"signals\":[\n    {\n      \"name\":\"grid\",\n      \"value\":{\"width\":15, \"height\":15}\n    },\n\t{\n      \"name\":\"blockSize\",\n      \"init\":\"min(width,height)/max(grid.width,grid.height)\"\n    },\n    {\n      \"name\":\"rangeWidthDelta\",\n      \"update\":\"(width - blockSize*grid.width)/2\"\n    },\n    {\n      \"name\":\"rangeHeightDelta\",\n      \"update\":\"(height - blockSize*grid.height)/2\"\n    },\n    {\n      \"name\":\"sizeFactor\",\n      \"init\":\"blockSize*15/600\"\n    },\n    {\n      \"name\":\"key\",\n      \"on\":[\n        {\n          \"events\":\"window:keydown\", \"update\":\"event.code\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"null\"\n        }\n      ]\n    },\n    {\n      \"name\":\"pacManXOffset\",\n      \"update\":\"key === 'ArrowRight' ? 1 : key === 'ArrowLeft' ? -1 : 0\"\n    },\n    {\n      \"name\":\"pacManYOffset\",\n      \"update\":\"key === 'ArrowUp' ? -1 : key === 'ArrowDown' ? 1 : 0\"\n    },\n    {\n      \"name\":\"pacManX\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"(!restart && pacManCanMoveX) ?((pacManXOffset <0 && pacManX <= 0) ? grid.width - 1 : ((pacManXOffset > 0 && pacManX >= grid.width -1) ? 0 : (pacManX + pacManXOffset))) : pacManX\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManY\",\n      \"init\":\"7\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!restart && pacManCanMoveY ?((pacManYOffset <0 && pacManY <= 0) ? grid.height-1 : (pacManYOffset > 0 && pacManY >= grid.height - 1)? 0 : pacManY + pacManYOffset) : pacManY\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"7\"}\n      ]\n    },\n    {\n      \"name\":\"pacManIsOpen\",\n      \"init\":\"true\",\n      \"on\":[\n        {\"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"!pacManIsOpen\"}\n      ]\n    },\n    {\n      \"name\":\"pacManHasWallX\",\n      \"update\":\"(pacManXOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-true')) || (pacManXOffset>=0 && indata('walls', 'key', (pacManX + 1) + '-' + pacManY + '-true')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManHasWallY\",\n      \"update\":\"(pacManYOffset<=0 && indata('walls', 'key', pacManX + '-' + pacManY + '-false')) || (pacManYOffset>=0 && indata('walls', 'key', pacManX + '-' + (pacManY+1) + '-false')) ? true : false\"\n    },\n    {\n      \"name\":\"pacManCanMoveX\",\n      \"update\":\"!pacManHasWallX && !pacManHasGhost\"\n    },\n    {\n      \"name\":\"pacManCanMoveY\",\n      \"update\":\"!pacManHasWallY  && !pacManHasGhost\"\n    },\n    {\n      \"name\":\"pacManHasGhost\",\n      \"update\":\"!superPower && (((pacManX + pacManXOffset === gRedX) && (pacManY + pacManYOffset === gRedY)) || ((pacManX + pacManXOffset === gBlueX) && (pacManY + pacManYOffset === gBlueY)) || ((pacManX + pacManXOffset === gGreenX) && (pacManY + pacManYOffset === gGreenY)) || ((pacManX + pacManXOffset === gOrangeX) && (pacManY + pacManYOffset === gOrangeY)))\"\n    },\n    {\n      \"name\":\"win\",\n      \"update\":\"length(data('gums')) + length(data('powerGums')) === length(data('eatenGums'))\"\n    },\n    {\n      \"name\":\"loose\",\n      \"on\":[{\"events\":{\"type\":\"timer\", \"throttle\": 400 }, \"update\":\"!superPower && ((gRedX === pacManX && gRedY === pacManY) || (gBlueX === pacManX && gBlueY === pacManY) || (gGreenX === pacManX && gGreenY === pacManY) || (gOrangeX === pacManX && gOrangeY === pacManY))\"}]\n    },\n    {\n      \"name\":\"restart\",\n      \"update\":\"win === true || loose === true\"\n    },\n    {\n      \"name\":\"testEaten\",\n      \"update\":\"!restart && (indata('gums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n      \"name\":\"testPowerEaten\",\n      \"update\":\"!restart && (indata('powerGums', 'key', pacManX+'-'+pacManY) && !indata('eatenGums', 'key', pacManX+'-'+pacManY)) ? {x:pacManX, y:pacManY, key:pacManX+'-'+pacManY} : null\"\n    },\n    {\n        \"name\":\"superPower\",\n        \"init\":\"0\",\n        \"on\": [{\"events\":{\"type\":\"timer\", \"throttle\": 1000}, \"force\": true, \"update\":\"superPower > 0 ? superPower - 1 : 0\"},\n        {\"events\":{\"signal\":\"testPowerEaten\"}, \"update\":\"testPowerEaten? 15 : superPower\"},\n        {\"events\":{\"signal\":\"restart\"}, \"force\": true, \"update\":\"0\"}]\n    }\n    ,\n    {\n      \"name\":\"testEatenGhost\",\n      \"update\":\"superPower ? ((gRedX === pacManX && gRedY === pacManY) ? gRed : (gBlueX === pacManX && gBlueY === pacManY) ? gBlue : (gGreenX === pacManX && gGreenY === pacManY) ? gGreen : (gOrangeX === pacManX && gOrangeY === pacManY) ? gOrange : null) : null\"\n    },\n\n    {\n      \"name\":\"gRed\",\n      \"init\":\"data('ghosts')[0]\"\n    },\n    {\n      \"name\":\"gRedDelta\",\n      \"update\":\"{dx:pacManX-gRedX, dy: pacManY-gRedY}\"\n    },\n    {\n      \"name\":\"gRedLastDir\",\n      \"update\":\"gRedDirection\"\n    },\n    {\n      \"name\":\"gRedPreferences\",\n      \"update\":\"setdata('gRedDecisions',[{d:'up', i: (gRedLastDir === 'down' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gRedLastDir === 'up' ? 4 : (abs(gRedDelta.dy) > abs(gRedDelta.dx) ? (gRedDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gRedLastDir === 'right' ? 4 : (abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gRedDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gRedLastDir === 'left' ? 4 : abs(gRedDelta.dy) < abs(gRedDelta.dx) ? (gRedDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gRedDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gRedHasWallX\",\n      \"update\":\"(gRedOffsetX<0 && !gRedCanLeft) || (gRedOffsetX>0 && !gRedCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gRedHasWallY\",\n      \"update\":\"(gRedOffsetY<0 && !gRedCanUp) || (gRedOffsetY>0 && !gRedCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gRedCanLeft\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanUp\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + gRedY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedCanRight\",\n      \"update\":\"indata('walls', 'key', (gRedX + 1) + '-' + gRedY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gRedCanDown\",\n      \"update\":\"indata('walls', 'key', gRedX + '-' + (gRedY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gRedHasPacMan\",\n      \"update\":\"superPower && ((gRedX + gRedOffsetX === pacManX) && (gRedY + gRedOffsetY === pacManY))\"\n    },\n    {\n      \"name\":\"gRedBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gRedProposedDirection\"}, \"force\": true, \"update\":\"!gRedProposedDirection ||(gRedProposedDirection === 'up' && !gRedCanUp) || (gRedProposedDirection === 'down' && !gRedCanDown) || (gRedProposedDirection === 'left' && !gRedCanLeft) || (gRedProposedDirection === 'right' && !gRedCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedTry\",\n       \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 350}, \"update\":\"gRedBlocked && gRedTry <3 ? gRedTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedDecision\",\n      \"update\":\"data('gRedDecisions')[gRedTry]\"\n    },\n    {\n      \"name\":\"gRedProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gRedDecision\"}, \"force\": true, \"update\":\"gRedDecision ? gRedDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gRedDirection\",\n      \"update\":\"gRedProposedDirection && !gRedBlocked ? gRedProposedDirection : gRedDirection\"\n    },\n    {\n      \"name\":\"gRedOffsetX\",\n      \"update\":\"gRedDirection === 'left'? - 1 : gRedDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gRedOffsetY\",\n      \"update\":\"gRedDirection === 'up'? -1 : gRedDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gRedX\",\n      \"init\":\"gRed.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 6 : (!restart && !gRedHasWallX && !gRedHasPacMan ? ((gRedOffsetX <0 && gRedX <= 0) ? grid.width - 1 : ((gRedOffsetX > 0 && gRedX >= grid.width -1) ? 0 : (gRedX + gRedOffsetX))) : gRedX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gRed.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gRedY\",\n      \"init\":\"gRed.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'red') ? 7 : (!restart && !gRedHasWallY && !gRedHasPacMan ? ((gRedOffsetY <0 && gRedY <= 0) ? grid.height-1 : (gRedOffsetY > 0 && gRedY >= grid.height - 1)? 0 : gRedY + gRedOffsetY) : gRedY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gRed.y\"\n        }\n      ]\n    },\n\n    {\n      \"name\":\"gBlue\",\n      \"init\":\"data('ghosts')[1]\"\n    },\n    {\n      \"name\":\"gBlueDelta\",\n      \"update\":\"{dx:pacManX-gBlueX, dy: pacManY-gBlueY}\"\n    },\n    {\n      \"name\":\"gBlueLastDir\",\n      \"update\":\"gBlueDirection\"\n    },\n    {\n      \"name\":\"gBluePreferences\",\n      \"update\":\"setdata('gBlueDecisions',[{d:'up', i: (gBlueLastDir === 'down' ? 4 : (abs(gBlueDelta.dy) > abs(gBlueDelta.dx) ? (gBlueDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gBlueDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gBlueLastDir === 'up' ? 4 : (abs(gBlueDelta.dy) > abs(gBlueDelta.dx) ? (gBlueDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gBlueDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gBlueLastDir === 'right' ? 4 : (abs(gBlueDelta.dy) < abs(gBlueDelta.dx) ? (gBlueDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gBlueDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gBlueLastDir === 'left' ? 4 : abs(gBlueDelta.dy) < abs(gBlueDelta.dx) ? (gBlueDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gBlueDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gBlueHasWallX\",\n      \"update\":\"(gBlueOffsetX<0 && !gBlueCanLeft) || (gBlueOffsetX>0 && !gBlueCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gBlueHasWallY\",\n      \"update\":\"(gBlueOffsetY<0 && !gBlueCanUp) || (gBlueOffsetY>0 && !gBlueCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gBlueHasGhost\",\n      \"update\":\"(gBlueX == gRedX && gBlueY === gRedY)\"\n    },\n    {\n      \"name\":\"gBlueHasPacMan\",\n      \"update\":\"superPower && ((gBlueX + gBlueOffsetX === pacManX) && (gBlueY + gBlueOffsetY === pacManY)) \"\n    },\n    {\n      \"name\":\"gBlueCanLeft\",\n      \"update\":\"indata('walls', 'key', gBlueX + '-' + gBlueY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gBlueCanUp\",\n      \"update\":\"indata('walls', 'key', gBlueX + '-' + gBlueY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gBlueCanRight\",\n      \"update\":\"indata('walls', 'key', (gBlueX + 1) + '-' + gBlueY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gBlueCanDown\",\n      \"update\":\"indata('walls', 'key', gBlueX + '-' + (gBlueY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gBlueBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gBlueProposedDirection\"}, \"force\": true, \"update\":\"!gBlueProposedDirection || (gBlueProposedDirection === 'up' && !gBlueCanUp) || (gBlueProposedDirection === 'down' && !gBlueCanDown) || (gBlueProposedDirection === 'left' && !gBlueCanLeft) || (gBlueProposedDirection === 'right' && !gBlueCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueTry\",\n      \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 400}, \"update\":\"gBlueBlocked && gBlueTry <=3 ? gBlueTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueDecision\",\n      \"update\":\"data('gBlueDecisions')[gBlueTry]\"\n    },\n    {\n      \"name\":\"gBlueProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gBlueDecision\"}, \"force\": true, \"update\":\"gBlueDecision ? gBlueDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gBlueDirection\",\n      \"update\":\"gBlueProposedDirection && !gBlueBlocked ? gBlueProposedDirection : gBlueDirection\"\n    },\n    {\n      \"name\":\"gBlueOffsetX\",\n      \"update\":\"gBlueDirection === 'left'? - 1 : gBlueDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gBlueOffsetY\",\n      \"update\":\"gBlueDirection === 'up' ? -1 : gBlueDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gBlueX\",\n      \"init\":\"gBlue.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'steelblue') ? 7 : (!restart && !gBlueHasWallX && !gBlueHasGhost && !gBlueHasPacMan ? ((gBlueOffsetX <0 && gBlueX <= 0) ? grid.width - 1 : ((gBlueOffsetX > 0 && gBlueX >= grid.width -1) ? 0 : (gBlueX + gBlueOffsetX))) : gBlueX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gBlue.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueY\",\n      \"init\":\"gBlue.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'steelblue') ? 7 : (!restart && !gBlueHasWallY && !gBlueHasGhost && !gBlueHasPacMan ? ((gBlueOffsetY <0 && gBlueY <= 0) ? grid.height-1 : (gBlueOffsetY > 0 && gBlueY >= grid.height - 1)? 0 : gBlueY + gBlueOffsetY) : gBlueY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gBlue.y\"\n        }\n      ]\n    },\n\n    {\n      \"name\":\"gGreen\",\n      \"init\":\"data('ghosts')[2]\"\n    },\n    {\n      \"name\":\"gGreenDelta\",\n      \"update\":\"{dx:pacManX-gGreenX, dy: pacManY-gGreenY}\"\n    },\n    {\n      \"name\":\"gGreenLastDir\",\n      \"update\":\"gGreenDirection\"\n    },\n    {\n      \"name\":\"gGreenPreferences\",\n      \"update\":\"setdata('gGreenDecisions',[{d:'up', i: (gGreenLastDir === 'down' ? 4 : (abs(gGreenDelta.dy) > abs(gGreenDelta.dx) ? (gGreenDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gGreenDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gGreenLastDir === 'up' ? 4 : (abs(gGreenDelta.dy) > abs(gGreenDelta.dx) ? (gGreenDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gGreenDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gGreenLastDir === 'right' ? 4 : (abs(gGreenDelta.dy) < abs(gGreenDelta.dx) ? (gGreenDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gGreenDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gGreenLastDir === 'left' ? 4 : abs(gGreenDelta.dy) < abs(gGreenDelta.dx) ? (gGreenDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gGreenDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gGreenHasWallX\",\n      \"update\":\"(gGreenOffsetX<0 && !gGreenCanLeft) || (gGreenOffsetX>0 && !gGreenCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gGreenHasWallY\",\n      \"update\":\"(gGreenOffsetY<0 && !gGreenCanUp) || (gGreenOffsetY>0 && !gGreenCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gGreenHasGhost\",\n      \"update\":\"(gGreenX === gRedX && gGreenY === gRedY) || (gGreenX === gBlueX && gGreenY+gGreenOffsetY === gBlueY)\"\n    },\n    {\n      \"name\":\"gGreenHasPacMan\",\n      \"update\":\"superPower && ((gGreenX + gGreenOffsetX === pacManX) && (gGreenY + gGreenOffsetY === pacManY)) \"\n    },\n    {\n      \"name\":\"gGreenCanLeft\",\n      \"update\":\"indata('walls', 'key', gGreenX + '-' + gGreenY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gGreenCanUp\",\n      \"update\":\"indata('walls', 'key', gGreenX + '-' + gGreenY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gGreenCanRight\",\n      \"update\":\"indata('walls', 'key', (gGreenX + 1) + '-' + gGreenY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gGreenCanDown\",\n      \"update\":\"indata('walls', 'key', gGreenX + '-' + (gGreenY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gGreenBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gGreenProposedDirection\"}, \"force\": true, \"update\":\"!gGreenProposedDirection || (gGreenProposedDirection === 'up' && !gGreenCanUp) || (gGreenProposedDirection === 'down' && !gGreenCanDown) || (gGreenProposedDirection === 'left' && !gGreenCanLeft) || (gGreenProposedDirection === 'right' && !gGreenCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenTry\",\n      \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 400}, \"update\":\"gGreenBlocked && gGreenTry <=3 ? gGreenTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenDecision\",\n      \"update\":\"data('gGreenDecisions')[gGreenTry]\"\n    },\n    {\n      \"name\":\"gGreenProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gGreenDecision\"}, \"force\": true, \"update\":\"gGreenDecision ? gGreenDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gGreenDirection\",\n      \"update\":\"gGreenProposedDirection && !gGreenBlocked ? gGreenProposedDirection : gGreenDirection\"\n    },\n    {\n      \"name\":\"gGreenOffsetX\",\n      \"update\":\"gGreenDirection === 'left'? - 1 : gGreenDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gGreenOffsetY\",\n      \"update\":\"gGreenDirection === 'up' ? -1 : gGreenDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gGreenX\",\n      \"init\":\"gGreen.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'green') ? 8 : (!restart && !gGreenHasWallX && !gGreenHasGhost && !gGreenHasPacMan ? ((gGreenOffsetX <0 && gGreenX <= 0) ? grid.width - 1 : ((gGreenOffsetX > 0 && gGreenX >= grid.width -1) ? 0 : (gGreenX + gGreenOffsetX))) : gGreenX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gGreen.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenY\",\n      \"init\":\"gGreen.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'green') ? 7 : (!restart && !gGreenHasWallY && !gGreenHasGhost && !gGreenHasPacMan ? ((gGreenOffsetY <0 && gGreenY <= 0) ? grid.height-1 : (gGreenOffsetY > 0 && gGreenY >= grid.height - 1)? 0 : gGreenY + gGreenOffsetY) : gGreenY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gGreen.y\"\n        }\n      ]\n    },\n\n    {\n      \"name\":\"gOrange\",\n      \"init\":\"data('ghosts')[3]\"\n    },\n    {\n      \"name\":\"gOrangeDelta\",\n      \"update\":\"{dx:pacManX-gOrangeX, dy: pacManY-gOrangeY}\"\n    },\n    {\n      \"name\":\"gOrangeLastDir\",\n      \"update\":\"gOrangeDirection\"\n    },\n    {\n      \"name\":\"gOrangePreferences\",\n      \"update\":\"setdata('gOrangeDecisions',[{d:'up', i: (gOrangeLastDir === 'down' ? 4 : (abs(gOrangeDelta.dy) > abs(gOrangeDelta.dx) ? (gOrangeDelta.dy<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gOrangeDelta.dy<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'down', i:(gOrangeLastDir === 'up' ? 4 : (abs(gOrangeDelta.dy) > abs(gOrangeDelta.dx) ? (gOrangeDelta.dy<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gOrangeDelta.dy<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2))))}, {d:'left', i: (gOrangeLastDir === 'right' ? 4 : (abs(gOrangeDelta.dy) < abs(gOrangeDelta.dx) ? (gOrangeDelta.dx<0 ? (superPower ? 4 : 1) : (superPower ? 1 : 4)) : (gOrangeDelta.dx<0 ? (superPower ? 3 : 2) : (superPower ? 2 : 3))))}, {d:'right', i:(gOrangeLastDir === 'left' ? 4 : abs(gOrangeDelta.dy) < abs(gOrangeDelta.dx) ? (gOrangeDelta.dx<0 ? (superPower ? 1 : 4) : (superPower ? 4 : 1)) : (gOrangeDelta.dx<0 ? (superPower ? 2 : 3) : (superPower ? 3 : 2)))}])\"\n    },\n    {\n      \"name\":\"gOrangeHasWallX\",\n      \"update\":\"(gOrangeOffsetX<0 && !gOrangeCanLeft) || (gOrangeOffsetX>0 && !gOrangeCanRight) ? true : false\"\n    },\n    {\n      \"name\":\"gOrangeHasWallY\",\n      \"update\":\"(gOrangeOffsetY<0 && !gOrangeCanUp) || (gOrangeOffsetY>0 && !gOrangeCanDown) ? true : false\"\n    },\n    {\n      \"name\":\"gOrangeHasGhost\",\n      \"update\":\"(gOrangeX === gRedX && gOrangeY === gRedY) || (gOrangeX === gBlueX && gOrangeY === gBlueY) || (gOrangeX === gGreenX && gOrangeY === gGreenY)\"\n    },\n    {\n      \"name\":\"gOrangeCanLeft\",\n      \"update\":\"indata('walls', 'key', gOrangeX + '-' + gOrangeY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gOrangeCanUp\",\n      \"update\":\"indata('walls', 'key', gOrangeX + '-' + gOrangeY + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gOrangeCanRight\",\n      \"update\":\"indata('walls', 'key', (gOrangeX + 1) + '-' + gOrangeY + '-true') ? false : true\"\n    },\n    {\n      \"name\":\"gOrangeCanDown\",\n      \"update\":\"indata('walls', 'key', gOrangeX + '-' + (gOrangeY+1) + '-false')? false : true\"\n    },\n    {\n      \"name\":\"gOrangeBlocked\",\n      \"on\": [\n        {\n          \"events\":{\"signal\":\"gOrangeProposedDirection\"}, \"force\": true, \"update\":\"!gOrangeProposedDirection || (gOrangeProposedDirection === 'up' && !gOrangeCanUp) || (gOrangeProposedDirection === 'down' && !gOrangeCanDown) || (gOrangeProposedDirection === 'left' && !gOrangeCanLeft) || (gOrangeProposedDirection === 'right' && !gOrangeCanRight) ? true : false\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeTry\",\n      \"on\": [\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 400}, \"update\":\"gOrangeBlocked && gOrangeTry <=3 ? gOrangeTry+1 : 0\"\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeHasPacMan\",\n      \"update\":\"superPower && ((gOrangeX + gOrangeOffsetX === pacManX) && (gOrangeY + gOrangeOffsetY === pacManY)) \"\n    },\n    {\n      \"name\":\"gOrangeDecision\",\n      \"update\":\"data('gOrangeDecisions')[gOrangeTry]\"\n    },\n    {\n      \"name\":\"gOrangeProposedDirection\",\n      \"on\": [{\"events\":{\"signal\":\"gOrangeDecision\"}, \"force\": true, \"update\":\"gOrangeDecision ? gOrangeDecision.d : 'none'\"}]\n    },\n    {\n      \"name\":\"gOrangeDirection\",\n      \"update\":\"gOrangeProposedDirection && !gOrangeBlocked ? gOrangeProposedDirection : gOrangeDirection\"\n    },\n    {\n      \"name\":\"gOrangeOffsetX\",\n      \"update\":\"gOrangeDirection === 'left'? - 1 : gOrangeDirection === 'right'? 1 : 0\"\n      \n    },\n    {\n      \"name\":\"gOrangeOffsetY\",\n      \"update\":\"gOrangeDirection === 'up' ? -1 : gOrangeDirection === 'down' ? 1 : 0\"\n    },\n    {\n      \"name\":\"gOrangeX\",\n      \"init\":\"gOrange.x\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'orange') ? 7 : (!restart && !gOrangeHasWallX && !gOrangeHasGhost && !gOrangeHasPacMan ? ((gOrangeOffsetX <0 && gOrangeX <= 0) ? grid.width - 1 : ((gOrangeOffsetX > 0 && gOrangeX >= grid.width -1) ? 0 : (gOrangeX + gOrangeOffsetX))) : gOrangeX)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"update\":\"gOrange.x\", \"force\": true\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeY\",\n      \"init\":\"gOrange.y\",\n      \"on\":[\n        {\n          \"events\":{\"type\":\"timer\", \"throttle\": 500}, \"update\":\"indata('eatenGhosts', 'color', 'orange') ? 7 : (!restart && !gOrangeHasWallY && !gOrangeHasGhost && !gOrangeHasPacMan  ? ((gOrangeOffsetY <0 && gOrangeY <= 0) ? grid.height-1 : (gOrangeOffsetY > 0 && gOrangeY >= grid.height - 1)? 0 : gOrangeY + gOrangeOffsetY) : gOrangeY)\"\n        },\n        {\n          \"events\":{\"signal\":\"restart\"}, \"force\":true, \"update\":\"gOrange.y\"\n        }\n      ]\n    }\n\n  ],\n  \"scales\":[\n    {\n      \"name\":\"scaleX\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"columns\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeWidthDelta\"},{\"signal\":\"width-rangeWidthDelta\"}]\n    },\n    {\n      \"name\":\"scaleY\",\n      \"type\":\"band\",\n      \"domain\":{\"data\":\"rows\", \"field\":\"data\"},\n      \"range\":[{\"signal\": \"rangeHeightDelta\"},{\"signal\":\"height-rangeHeightDelta\"}]\n    }\n  ],\n  \"marks\":[\n     {\n      \"type\":\"rect\",\n      \"from\":{\"data\":\"walls\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"signal\":\"datum.x < grid.width ? datum.x : grid.width-1\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"datum.vertical? (datum.x < grid.width ? datum.x === 0 ? 0 : -1 : blockSize - blockSize/10):0\"}},\n          \"y\":{\"signal\":\"datum.y < grid.height ? datum.y : grid.height-1\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"datum.vertical? 0: datum.y < grid.height? datum.y === 0 ? 0 : -1 : blockSize -blockSize/10\"}},\n          \"fill\":{\"value\":\"blue\"},\n          \"width\":{\"signal\":\"datum.vertical?blockSize/10:blockSize\"},\n          \"height\":{\"signal\":\"datum.vertical?blockSize:blockSize/10\"} \n\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"gums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"grey\"},\n          \"size\":{\"signal\":\"pow(10*sizeFactor, 2)\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"symbol\",\n      \"from\":{\"data\":\"powerGums\"},\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"field\":\"x\", \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"field\":\"y\", \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"size\":{\"signal\":\"pow(18*sizeFactor, 2)\"},\n          \"fill\":{\"value\":\"white\"}\n        },\n        \"update\":{\n          \"opacity\":[{\"test\":\"indata('eatenGums', 'key', datum.x+'-'+datum.y)\", \"value\": 0}, {\"value\":1}]\n        }\n      }\n    },\n    {\n      \"type\":\"group\",\n      \"name\":\"pacMan\",\n      \"encode\":{\n        \"update\":{\n          \"x\":{\"signal\":\"pacManX\", \"scale\":\"scaleX\"},\n          \"y\":{\"signal\":\"pacManY\", \"scale\":\"scaleY\"}\n        }\n      },\n      \"marks\":[\n        {\n          \"type\":\"arc\",\n          \"encode\":{\n            \"enter\":{\n              \"outerRadius\":{\"signal\":\"(blockSize/2)*0.8\"},\n              \"stroke\":{\"value\":\"black\"},\n              \"x\":{\"signal\":\"blockSize/2\"},\n              \"y\":{\"signal\":\"blockSize/2\"}\n\n            },\n            \"update\":{\n              \"fill\":{\"signal\":\"superPower ? 'red' : 'yellow'\"},\n              \"endAngle\":{\"signal\":\"(pacManIsOpen? 5*PI/2-PI/6:5*PI/2-0.001) * (pacManXOffset ? pacManXOffset : 1)\"},\n              \"startAngle\":{\"signal\":\"(pacManIsOpen? PI/2+PI/6:PI/2) * (pacManXOffset ? pacManXOffset : 1)\"}\n            }\n          }\n        },\n        {\n          \"type\":\"symbol\",\n          \"encode\":{\n            \"enter\":{\n              \"y\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"-blockSize/5\"}},\n              \"size\":{\"signal\":\"pow(blockSize/10, 2)\"},\n              \"fill\":{\"value\":\"black\"}          \n              },\n            \"update\":{\n              \"x\":{\"signal\":\"blockSize/2\", \"offset\":{\"signal\":\"2 * (pacManXOffset ? pacManXOffset : 1)\"}}\n            }\n          }\n        }\n      ]\n     },\n     {\n          \"type\":\"symbol\",\n          \"from\":{\"data\":\"ghosts\"},\n          \"encode\":{\n            \"enter\":{\n              \"size\":{\"signal\":\"pow(blockSize/20,2)\"}\n            },\n            \"update\":{\n              \"x\":{\"signal\":\"datum.color === 'red' ? gRedX : datum.color === 'steelblue'? gBlueX : datum.color === 'green'? gGreenX : gOrangeX\", \"offset\":{\"signal\":\"blockSize/8\"}, \"scale\":\"scaleX\"},\n              \"y\":{\"signal\":\"datum.color === 'red' ? gRedY : datum.color === 'steelblue'? gBlueY : datum.color === 'green'? gGreenY : gOrangeY\", \"offset\":{\"signal\":\"blockSize/9\"}, \"scale\":\"scaleY\"},\n              \"shape\":{\"signal\":\"indata('eatenGhosts', 'color', datum.color) ? 'M16.459004,11.555034C15.659003,11.555034 15.009003,12.205034 15.009003,13.005036 15.009003,13.804038 15.659003,14.454039 16.459004,14.454039 17.258005,14.454039 17.909006,13.804038 17.909006,13.005036 17.909006,12.205034 17.258005,11.555034 16.459004,11.555034z M7.5419962,11.555034C6.7429954,11.555034 6.0919949,12.205034 6.0919949,13.005036 6.0919949,13.804038 6.7429954,14.454039 7.5419962,14.454039 8.3419973,14.454039 8.9919979,13.804038 8.9919979,13.005036 8.9919979,12.205034 8.3419973,11.555034 7.5419962,11.555034z M16.459004,9.5550298C18.361006,9.5550298 19.909006,11.103033 19.909006,13.005036 19.909006,14.90804 18.361006,16.454042 16.459004,16.454042 14.557002,16.454042 13.009001,14.90804 13.009001,13.005036 13.009001,11.103033 14.557002,9.5550298 16.459004,9.5550298z M7.5419962,9.5550298C9.4439976,9.5550298 10.991999,11.103033 10.991999,13.005036 10.991999,14.90804 9.4439976,16.454042 7.5419962,16.454042 5.6399948,16.454042 4.091993,14.90804 4.091993,13.005036 4.091993,11.103033 5.6399948,9.5550298 7.5419962,9.5550298z M12,1.9999994C6.4860079,1.9999995,2.0000002,6.3300156,2.0000004,11.650998L2.0000004,28.669975 5.102997,27.200983 8.9929964,29.12896 12.742996,27.202997 16.98201,29.106987 19.895004,27.116999 22,28.439995 22,11.650998C22,6.3300156,17.515,1.9999995,12,1.9999994z M12,0C18.617005,0,24,5.2260117,24,11.650998L24,32.056999 19.940003,29.507988 17.184998,31.390007 12.80101,29.421989 9.0080111,31.369011 5.0820009,29.424004 0,31.827995 0,11.650998C1.8747701E-07,5.2260117,5.3840029,0,12,0z' : 'M13.952596,15.068143C13.767538,15.066144 13.583578,15.095151 13.403586,15.157148 12.252587,15.553147 11.725549,17.163162 12.224572,18.753189 12.725547,20.342192 14.062582,21.309212 15.211566,20.914204 16.362564,20.518204 16.889541,18.908188 16.390579,17.318163 15.968584,15.977162 14.95058,15.077146 13.952596,15.068143z M7.7945876,6.1100698C7.2026091,6.0760732 6.4365583,6.7850791 5.9736071,7.8550807 5.4445558,9.0761004 5.5105953,10.302109 6.1215563,10.590106 6.7316013,10.881108 7.65555,10.126112 8.1855779,8.9070922 8.7145686,7.6860881 8.6485896,6.4610711 8.036592,6.1710754 7.9606028,6.1350642 7.8795486,6.1150752 7.7945876,6.1100698z M15.404559,5.9590679C15.383563,5.9580608 15.362566,5.9580608 15.34157,5.960075 14.674579,6.0020671 14.194539,7.1220723 14.275593,8.4590903 14.354573,9.7981063 14.962543,10.848119 15.631547,10.802114 16.300554,10.759113 16.778579,9.6401005 16.700576,8.3020907 16.622573,7.006074 16.049577,5.980064 15.404559,5.9590679z M12.317589,1.4699259E-05C15.527545,0.0050196948 18.757579,1.2870288 21.236579,3.8010436 24.038576,6.6430793 25.533567,12.005127 25.825559,15.861164 26.09155,19.371191 27.844537,19.518194 30.765552,22.228211 31.592515,22.995216 33.904521,25.825243 28.733512,26.053242 26.619564,26.146244 25.60156,25.739243 21.732549,22.850226 21.235542,22.545214 20.664558,22.733219 20.373542,22.885214 20.017526,23.07122 19.741586,23.925232 19.851572,24.215227 20.16456,25.583237 22.25855,25.135235 23.427553,26.313253 24.41156,27.305252 22.795536,29.807287 18.926586,29.29027 18.926586,29.29027 16.343582,28.587277 13.853597,25.258236 11.910547,25.242245 9.6305823,25.258236 9.6305823,25.258236 9.6305823,25.258236 9.6025672,26.705256 9.6425452,27.10626 10.271573,27.256254 10.777553,27.021252 13.298544,27.736271 14.150593,27.978262 16.663589,31.170292 8.7236018,30.424282 7.0135832,30.263287 7.1875944,30.721283 5.2576051,26.025242 4.2626119,23.604229 2.0076115,22.396212 0.6345674,17.082169 -0.27241354,14.207143 -0.21040192,11.068107 0.84159805,8.2280856 0.97556992,7.8450862 1.1235799,7.5130826 1.2786091,7.1980773 1.8406196,6.0020671 2.5815849,4.8720523 3.5156043,3.863056 5.9166007,1.2680314 9.107573,-0.0049901602 12.317589,1.4699259E-05z'\"},\n              \"fill\":{\"signal\":\"superPower? 'white' :datum.color\"},\n              \"opacity\":[{\"test\":\"restart\", \"value\": 0},{\"signal\":\"superPower?0.8:1\"}]\n            }\n          }\n        }\n  ],\n  \"data\":[\n        {\n      \"name\": \"columns\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.width\" },\n          \"step\": 1\n        }\n      ]\n    },\n    {\n      \"name\": \"rows\",\n      \"transform\": [\n        {\n          \"type\": \"sequence\",\n          \"start\": 0,\n          \"stop\": { \"signal\": \"grid.height\" },\n          \"step\": 1\n        }\n      ]\n    },\n        {\n      \"name\":\"ghosts\",\n      \"values\":[\n      {\n        \"x\":0,\n        \"y\":0,\n        \"color\":\"red\"\n      },\n      {\n        \"x\":14,\n        \"y\":0,\n        \"color\":\"steelblue\"\n      },\n       {\n        \"x\":0,\n        \"y\":14,\n        \"color\":\"green\"\n      },\n      {\n        \"x\":14,\n        \"y\":14,\n        \"color\":\"orange\"\n      }\n      ]\n    },\n    {\n      \"name\":\"eatenGhosts\",\n      \"on\": [{\n        \"trigger\":\"testEatenGhost\",\n        \"insert\":\"testEatenGhost\"\n      },\n      {\n        \"trigger\":\"!superPower\",\n        \"remove\":\"!superPower\"\n      }]\n    },\n    {\n      \"name\":\"gRedDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gBlueDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gGreenDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gOrangeDecisions\",\n      \"values\":[],\n      \"transform\":[\n        {\"type\":\"collect\",\n          \"sort\":{\"field\":\"i\"}\n        }\n      ]\n    },\n    {\n      \"name\":\"gums\",\n      \"values\":[\n        {\"x\":0, \"y\":1},\n        {\"x\":0, \"y\":2},\n        {\"x\":0, \"y\":3},\n        {\"x\":0, \"y\":4},\n        {\"x\":0, \"y\":7},\n        {\"x\":0, \"y\":10},\n        {\"x\":0, \"y\":11},\n        {\"x\":0, \"y\":12},\n        {\"x\":0, \"y\":14},\n\n        {\"x\":1, \"y\":0},\n        {\"x\":1, \"y\":2},\n        {\"x\":1, \"y\":4},\n        {\"x\":1, \"y\":7},\n        {\"x\":1, \"y\":10},\n        {\"x\":1, \"y\":12},\n        {\"x\":1, \"y\":13},\n        {\"x\":1, \"y\":14},\n\n        {\"x\":2, \"y\":0},\n        {\"x\":2, \"y\":2},\n        {\"x\":2, \"y\":3},\n        {\"x\":2, \"y\":4},\n        {\"x\":2, \"y\":7},\n        {\"x\":2, \"y\":10},\n        {\"x\":2, \"y\":13},\n        {\"x\":2, \"y\":14},\n\n        {\"x\":3, \"y\":0},\n        {\"x\":3, \"y\":1},\n        {\"x\":3, \"y\":2},\n        {\"x\":3, \"y\":4},\n        {\"x\":3, \"y\":5},\n        {\"x\":3, \"y\":6},\n        {\"x\":3, \"y\":7},\n        {\"x\":3, \"y\":8},\n        {\"x\":3, \"y\":9},\n        {\"x\":3, \"y\":10},\n        {\"x\":3, \"y\":12},\n        {\"x\":3, \"y\":13},\n        {\"x\":3, \"y\":14},\n\n        {\"x\":4, \"y\":0},\n        {\"x\":4, \"y\":2},\n        {\"x\":4, \"y\":6},\n        {\"x\":4, \"y\":10},\n        {\"x\":4, \"y\":11},\n        {\"x\":4, \"y\":12},\n        {\"x\":4, \"y\":14},\n\n        {\"x\":5, \"y\":0},\n        {\"x\":5, \"y\":2},\n        {\"x\":5, \"y\":3},\n        {\"x\":5, \"y\":4},\n        {\"x\":5, \"y\":5},\n        {\"x\":5, \"y\":6},\n        {\"x\":5, \"y\":7},\n        {\"x\":5, \"y\":8},\n        {\"x\":5, \"y\":10},\n        {\"x\":5, \"y\":12},\n        {\"x\":5, \"y\":14},\n\n        {\"x\":6, \"y\":0},\n        {\"x\":6, \"y\":2},\n        {\"x\":6, \"y\":5},\n        {\"x\":6, \"y\":6},\n        {\"x\":6, \"y\":7},\n        {\"x\":6, \"y\":8},\n        {\"x\":6, \"y\":10},\n        {\"x\":6, \"y\":12},\n        {\"x\":6, \"y\":13},\n        {\"x\":6, \"y\":14},\n\n        {\"x\":7, \"y\":0},\n        {\"x\":7, \"y\":1},\n        {\"x\":7, \"y\":2},\n        {\"x\":7, \"y\":6},\n        {\"x\":7, \"y\":8},\n        {\"x\":7, \"y\":9},\n        {\"x\":7, \"y\":10},\n        {\"x\":7, \"y\":14},\n\n        {\"x\":14, \"y\":0},\n        {\"x\":14, \"y\":1},\n        {\"x\":14, \"y\":2},\n        {\"x\":14, \"y\":3},\n        {\"x\":14, \"y\":4},\n        {\"x\":14, \"y\":7},\n        {\"x\":14, \"y\":10},\n        {\"x\":14, \"y\":11},\n        {\"x\":14, \"y\":12},\n        {\"x\":14, \"y\":14},\n\n        {\"x\":13, \"y\":0},\n        {\"x\":13, \"y\":2},\n        {\"x\":13, \"y\":4},\n        {\"x\":13, \"y\":7},\n        {\"x\":13, \"y\":10},\n        {\"x\":13, \"y\":12},\n        {\"x\":13, \"y\":13},\n        {\"x\":13, \"y\":14},\n\n        {\"x\":12, \"y\":0},\n        {\"x\":12, \"y\":2},\n        {\"x\":12, \"y\":3},\n        {\"x\":12, \"y\":4},\n        {\"x\":12, \"y\":7},\n        {\"x\":12, \"y\":10},\n        {\"x\":12, \"y\":13},\n        {\"x\":12, \"y\":14},\n\n        {\"x\":11, \"y\":0},\n        {\"x\":11, \"y\":1},\n        {\"x\":11, \"y\":2},\n        {\"x\":11, \"y\":4},\n        {\"x\":11, \"y\":5},\n        {\"x\":11, \"y\":6},\n        {\"x\":11, \"y\":7},\n        {\"x\":11, \"y\":8},\n        {\"x\":11, \"y\":9},\n        {\"x\":11, \"y\":10},\n        {\"x\":11, \"y\":12},\n        {\"x\":11, \"y\":13},\n        {\"x\":11, \"y\":14},\n\n        {\"x\":10, \"y\":0},\n        {\"x\":10, \"y\":2},\n        {\"x\":10, \"y\":6},\n        {\"x\":10, \"y\":10},\n        {\"x\":10, \"y\":11},\n        {\"x\":10, \"y\":12},\n        {\"x\":10, \"y\":14},\n\n        {\"x\":9, \"y\":0},\n        {\"x\":9, \"y\":2},\n        {\"x\":9, \"y\":3},\n        {\"x\":9, \"y\":4},\n        {\"x\":9, \"y\":5},\n        {\"x\":9, \"y\":6},\n        {\"x\":9, \"y\":7},\n        {\"x\":9, \"y\":8},\n        {\"x\":9, \"y\":10},\n        {\"x\":9, \"y\":12},\n        {\"x\":9, \"y\":14},\n\n        {\"x\":8, \"y\":0},\n        {\"x\":8, \"y\":2},\n        {\"x\":8, \"y\":5},\n        {\"x\":8, \"y\":6},\n        {\"x\":8, \"y\":7},\n        {\"x\":8, \"y\":8},\n        {\"x\":8, \"y\":10},\n        {\"x\":8, \"y\":12},\n        {\"x\":8, \"y\":13},\n        {\"x\":8, \"y\":14}\n        \n      ],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"powerGums\",\n      \"values\":[{\"x\":0, \"y\":0},{\"x\":14, \"y\":0}, {\"x\":0, \"y\":14}, {\"x\":14, \"y\":14}],\n      \"transform\":[\n        {\"type\":\"formula\", \"expr\":\"datum.x+'-'+datum.y\", \"as\":\"key\"}\n      ]\n    },\n    {\n      \"name\":\"eatenGums\",\n      \"on\":[\n        {\n          \"trigger\":\"testEaten\",\n          \"insert\":\"testEaten\"\n        },\n        {\n          \"trigger\":\"testPowerEaten\",\n          \"insert\":\"testPowerEaten\"\n        },\n        {\n          \"trigger\":\"restart\",\n          \"remove\":\"restart\"\n        }\n      ]\n    },\n    { \n      \"name\":\"walls\",\n      \"values\":[\n          {\"x\":0, \"y\":0, \"vertical\":false},\n          {\"x\":1, \"y\":0, \"vertical\":false},\n          {\"x\":2, \"y\":0, \"vertical\":false},\n          {\"x\":3, \"y\":0, \"vertical\":false},\n          {\"x\":4, \"y\":0, \"vertical\":false},\n          {\"x\":5, \"y\":0, \"vertical\":false},\n          {\"x\":6, \"y\":0, \"vertical\":false},\n          {\"x\":7, \"y\":0, \"vertical\":false},\n          {\"x\":8, \"y\":0, \"vertical\":false},\n          {\"x\":9, \"y\":0, \"vertical\":false},\n          {\"x\":10, \"y\":0, \"vertical\":false},\n          {\"x\":11, \"y\":0, \"vertical\":false},\n          {\"x\":12, \"y\":0, \"vertical\":false},\n          {\"x\":13, \"y\":0, \"vertical\":false},\n          {\"x\":14, \"y\":0, \"vertical\":false},\n          {\"x\":0, \"y\":15, \"vertical\":false},\n          {\"x\":1, \"y\":15, \"vertical\":false},\n          {\"x\":2, \"y\":15, \"vertical\":false},\n          {\"x\":3, \"y\":15, \"vertical\":false},\n          {\"x\":4, \"y\":15, \"vertical\":false},\n          {\"x\":5, \"y\":15, \"vertical\":false},\n          {\"x\":6, \"y\":15, \"vertical\":false},\n          {\"x\":7, \"y\":15, \"vertical\":false},\n          {\"x\":8, \"y\":15, \"vertical\":false},\n          {\"x\":9, \"y\":15, \"vertical\":false},\n          {\"x\":10, \"y\":15, \"vertical\":false},\n          {\"x\":11, \"y\":15, \"vertical\":false},\n          {\"x\":12, \"y\":15, \"vertical\":false},\n          {\"x\":13, \"y\":15, \"vertical\":false},\n          {\"x\":14, \"y\":15, \"vertical\":false}, \n\n          {\"x\":0, \"y\":0, \"vertical\":true},\n          {\"x\":0, \"y\":1, \"vertical\":true},\n          {\"x\":0, \"y\":2, \"vertical\":true},\n          {\"x\":0, \"y\":3, \"vertical\":true},\n          {\"x\":0, \"y\":4, \"vertical\":true},\n          {\"x\":0, \"y\":5, \"vertical\":false},\n          {\"x\":1, \"y\":5, \"vertical\":false},\n          {\"x\":2, \"y\":5, \"vertical\":false},\n          {\"x\":0, \"y\":7, \"vertical\":false},\n          {\"x\":1, \"y\":7, \"vertical\":false},\n          {\"x\":2, \"y\":7, \"vertical\":false},\n          {\"x\":0, \"y\":8, \"vertical\":false},\n          {\"x\":1, \"y\":8, \"vertical\":false},\n          {\"x\":0, \"y\":10, \"vertical\":false},\n          {\"x\":1, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":10, \"vertical\":false},\n          {\"x\":2, \"y\":8, \"vertical\":false},\n          {\"x\":3, \"y\":5, \"vertical\":true},\n          {\"x\":3, \"y\":6, \"vertical\":true},\n          {\"x\":3, \"y\":8, \"vertical\":true},\n          {\"x\":3, \"y\":9, \"vertical\":true},\n          {\"x\":0, \"y\":10, \"vertical\":true},\n          {\"x\":0, \"y\":11, \"vertical\":true},\n          {\"x\":0, \"y\":12, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":14, \"vertical\":true},\n\n          {\"x\":15, \"y\":0, \"vertical\":true},\n          {\"x\":15, \"y\":1, \"vertical\":true},\n          {\"x\":15, \"y\":2, \"vertical\":true},\n          {\"x\":15, \"y\":3, \"vertical\":true},\n          {\"x\":15, \"y\":4, \"vertical\":true},\n          {\"x\":12, \"y\":5, \"vertical\":true},\n          {\"x\":14, \"y\":5, \"vertical\":false},\n          {\"x\":13, \"y\":5, \"vertical\":false},\n          {\"x\":14, \"y\":7, \"vertical\":false},\n          {\"x\":13, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":7, \"vertical\":false},\n          {\"x\":12, \"y\":5, \"vertical\":false},\n          {\"x\":12, \"y\":6, \"vertical\":true},\n          {\"x\":14, \"y\":8, \"vertical\":false},\n          {\"x\":13, \"y\":8, \"vertical\":false},\n          {\"x\":14, \"y\":10, \"vertical\":false},\n          {\"x\":13, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":10, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":false},\n          {\"x\":12, \"y\":8, \"vertical\":true},\n          {\"x\":12, \"y\":9, \"vertical\":true},\n          {\"x\":15, \"y\":10, \"vertical\":true},\n          {\"x\":15, \"y\":11, \"vertical\":true},\n          {\"x\":15, \"y\":12, \"vertical\":true},\n          {\"x\":15, \"y\":13, \"vertical\":true},\n          {\"x\":15, \"y\":14, \"vertical\":true},\n\n          {\"x\":6, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":6, \"vertical\":false},\n          {\"x\":8, \"y\":5, \"vertical\":true},\n          {\"x\":8, \"y\":5, \"vertical\":false},\n          {\"x\":7, \"y\":5, \"vertical\":true},\n          {\"x\":7, \"y\":3, \"vertical\":false},\n          {\"x\":8, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":3, \"vertical\":false},\n          {\"x\":6, \"y\":4, \"vertical\":true},\n          {\"x\":9, \"y\":3, \"vertical\":true},\n          {\"x\":9, \"y\":4, \"vertical\":true},\n          {\"x\":6, \"y\":3, \"vertical\":true},\n\n          {\"x\":3, \"y\":3, \"vertical\":false},\n          {\"x\":4, \"y\":3, \"vertical\":false},\n          {\"x\":3, \"y\":3, \"vertical\":true},\n          {\"x\":5, \"y\":3, \"vertical\":true},\n          {\"x\":3, \"y\":4, \"vertical\":false},\n          {\"x\":4, \"y\":4, \"vertical\":true},\n          {\"x\":5, \"y\":4, \"vertical\":true},\n          {\"x\":4, \"y\":5, \"vertical\":true},\n          {\"x\":5, \"y\":5, \"vertical\":true},\n          {\"x\":4, \"y\":6, \"vertical\":false},\n\n          {\"x\":10, \"y\":3, \"vertical\":false},\n          {\"x\":11, \"y\":3, \"vertical\":false},\n          {\"x\":10, \"y\":3, \"vertical\":true},\n          {\"x\":12, \"y\":3, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":false},\n          {\"x\":10, \"y\":4, \"vertical\":true},\n          {\"x\":11, \"y\":4, \"vertical\":true},\n          {\"x\":10, \"y\":5, \"vertical\":true},\n          {\"x\":11, \"y\":5, \"vertical\":true},\n          {\"x\":10, \"y\":6, \"vertical\":false},\n\n          {\"x\":1, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":1, \"vertical\":false},\n          {\"x\":2, \"y\":1, \"vertical\":false},\n          {\"x\":1, \"y\":2, \"vertical\":false},\n          {\"x\":2, \"y\":2, \"vertical\":false},\n          {\"x\":3, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":true},\n          {\"x\":4, \"y\":1, \"vertical\":false},\n          {\"x\":4, \"y\":2, \"vertical\":false},\n          {\"x\":5, \"y\":1, \"vertical\":false},\n          {\"x\":6, \"y\":1, \"vertical\":false},\n          {\"x\":5, \"y\":2, \"vertical\":false},\n          {\"x\":6, \"y\":2, \"vertical\":false},\n          {\"x\":7, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":true},\n          {\"x\":8, \"y\":1, \"vertical\":false},\n          {\"x\":9, \"y\":1, \"vertical\":false},\n          {\"x\":8, \"y\":2, \"vertical\":false},\n          {\"x\":9, \"y\":2, \"vertical\":false},\n          {\"x\":11, \"y\":1, \"vertical\":true},\n          {\"x\":10, \"y\":1, \"vertical\":false},\n          {\"x\":10, \"y\":2, \"vertical\":false},\n          {\"x\":12, \"y\":1, \"vertical\":true},\n          {\"x\":12, \"y\":1, \"vertical\":false},\n          {\"x\":13, \"y\":1, \"vertical\":false},\n          {\"x\":12, \"y\":2, \"vertical\":false},\n          {\"x\":13, \"y\":2, \"vertical\":false},\n          {\"x\":14, \"y\":1, \"vertical\":true},\n          {\"x\":1, \"y\":3, \"vertical\":true},\n          {\"x\":2, \"y\":3, \"vertical\":true}, \n          {\"x\":1, \"y\":3, \"vertical\":false},\n          {\"x\":13, \"y\":4, \"vertical\":false},\n          {\"x\":13, \"y\":3, \"vertical\":true},\n          {\"x\":14, \"y\":3, \"vertical\":true}, \n          {\"x\":13, \"y\":3, \"vertical\":false},\n          {\"x\":1, \"y\":4, \"vertical\":false},\n\n          {\"x\":6, \"y\":7, \"vertical\":true},\n          {\"x\":9, \"y\":7, \"vertical\":true}, \n          {\"x\":7, \"y\":8, \"vertical\":false},\n          {\"x\":6, \"y\":8, \"vertical\":false},\n          {\"x\":8, \"y\":8, \"vertical\":false},\n\n          {\"x\":4, \"y\":7, \"vertical\":false},\n          {\"x\":4, \"y\":10, \"vertical\":false},\n          {\"x\":5, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":4, \"y\":7, \"vertical\":true},\n          {\"x\":4, \"y\":8, \"vertical\":true},\n          {\"x\":4, \"y\":9, \"vertical\":true},\n          {\"x\":5, \"y\":7, \"vertical\":true},\n          {\"x\":5, \"y\":8, \"vertical\":true},\n          {\"x\":7, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":6, \"y\":9, \"vertical\":false},\n          {\"x\":5, \"y\":9, \"vertical\":false},\n\n          {\"x\":10, \"y\":7, \"vertical\":false},\n          {\"x\":10, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":10, \"vertical\":false},\n          {\"x\":8, \"y\":10, \"vertical\":false},\n          {\"x\":10, \"y\":7, \"vertical\":true},\n          {\"x\":10, \"y\":8, \"vertical\":true},\n          {\"x\":11, \"y\":9, \"vertical\":true},\n          {\"x\":11, \"y\":7, \"vertical\":true},\n          {\"x\":11, \"y\":8, \"vertical\":true},\n          {\"x\":8, \"y\":9, \"vertical\":true},\n          {\"x\":6, \"y\":10, \"vertical\":false},\n          {\"x\":9, \"y\":9, \"vertical\":false},\n          {\"x\":8, \"y\":9, \"vertical\":false},\n\n          {\"x\":5, \"y\":11, \"vertical\":false},\n          {\"x\":6, \"y\":11, \"vertical\":false},\n          {\"x\":7, \"y\":11, \"vertical\":false},\n          {\"x\":8, \"y\":11, \"vertical\":false},\n          {\"x\":9, \"y\":11, \"vertical\":false},\n          {\"x\":10, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":11, \"vertical\":true},\n          {\"x\":5, \"y\":12, \"vertical\":false},\n          {\"x\":6, \"y\":12, \"vertical\":false},\n          {\"x\":8, \"y\":12, \"vertical\":false},\n          {\"x\":9, \"y\":12, \"vertical\":false},\n          {\"x\":7, \"y\":12, \"vertical\":true},\n          {\"x\":8, \"y\":12, \"vertical\":true},\n          {\"x\":7, \"y\":13, \"vertical\":true},\n          {\"x\":8, \"y\":13, \"vertical\":true},\n          {\"x\":7, \"y\":14, \"vertical\":false},\n\n          {\"x\":1, \"y\":13, \"vertical\":true},\n          {\"x\":0, \"y\":13, \"vertical\":false},\n          {\"x\":0, \"y\":14, \"vertical\":false},\n\n          {\"x\":2, \"y\":11, \"vertical\":false},\n          {\"x\":3, \"y\":11, \"vertical\":false},\n          {\"x\":1, \"y\":12, \"vertical\":false},\n          {\"x\":1, \"y\":11, \"vertical\":false},\n          {\"x\":2, \"y\":13, \"vertical\":false},\n          {\"x\":3, \"y\":12, \"vertical\":false},\n          {\"x\":4, \"y\":11, \"vertical\":true},\n          {\"x\":2, \"y\":12, \"vertical\":true},\n          {\"x\":1, \"y\":11, \"vertical\":true},\n          {\"x\":3, \"y\":12, \"vertical\":true},\n\n          {\"x\":4, \"y\":13, \"vertical\":false},\n          {\"x\":5, \"y\":13, \"vertical\":false},\n          {\"x\":4, \"y\":14, \"vertical\":false},\n          {\"x\":5, \"y\":14, \"vertical\":false},\n          {\"x\":4, \"y\":13, \"vertical\":true},\n          {\"x\":6, \"y\":13, \"vertical\":true},\n\n          {\"x\":9, \"y\":13, \"vertical\":false},\n          {\"x\":10, \"y\":13, \"vertical\":false},\n          {\"x\":9, \"y\":14, \"vertical\":false},\n          {\"x\":10, \"y\":14, \"vertical\":false},\n          {\"x\":9, \"y\":13, \"vertical\":true},\n          {\"x\":11, \"y\":13, \"vertical\":true},\n\n          {\"x\":14, \"y\":13, \"vertical\":true},\n          {\"x\":14, \"y\":13, \"vertical\":false},\n          {\"x\":14, \"y\":14, \"vertical\":false},\n\n          {\"x\":11, \"y\":11, \"vertical\":false},\n          {\"x\":13, \"y\":11, \"vertical\":false},\n          {\"x\":11, \"y\":12, \"vertical\":false},\n          {\"x\":12, \"y\":11, \"vertical\":false},\n          {\"x\":12, \"y\":13, \"vertical\":false},\n          {\"x\":13, \"y\":12, \"vertical\":false},\n          {\"x\":14, \"y\":11, \"vertical\":true},\n          {\"x\":12, \"y\":12, \"vertical\":true},\n          {\"x\":11, \"y\":11, \"vertical\":true},\n          {\"x\":13, \"y\":12, \"vertical\":true}\n          \n          \n      ],\n      \"transform\":[\n        {\n          \"type\":\"formula\",\n          \"expr\":\"datum.x+'-'+datum.y+'-'+datum.vertical\",\n          \"as\":\"key\"\n        }\n      ]\n    }\n  ]\n})","pinCode":false,"dname":"3bbb0f55-d940-4aa1-b89c-6de9fe838036","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`## <a name=\"score\"></a>Score\n\n This is a final touch: score adds user interest, and more if she have a high-score to beat.\n\n Let's add some signals:\n`","pinCode":false,"dname":"c68795d4-de8a-4625-af34-5a6bb67ff8f4","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"name\":\"score\",\n      \"init\":\"0\",\n      \"on\": [\n        {\"events\":{\"signal\":\"testEaten\"},\"update\":\"testEaten ? score + 10 : score\"},\n        {\"events\":{\"signal\":\"testPowerEaten\"},\"update\":\"testPowerEaten ? score + 50 : score\"},\n        {\"events\":{\"signal\":\"testEatenGhost\"},\"update\":\"testEatenGhost ? score + 100 : score\"},\n        {\"events\":{\"signal\":\"loose\"}, \"force\":true ,\"update\":\"restart ? 0 : score\"}\n      ]\n    },\n    {\n      \"name\":\"highScore\",\n      \"init\":\"0\",\n      \"on\":[\n        {\"events\":{\"signal\":\"score\"}, \"update\":\"max(score,highScore)\"}\n      ]\n    }]","pinCode":false,"dname":"c52f1a94-dfca-4694-a7fb-5cae30a4f11d","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`\n- \"score\" will be increased when PacMan eats a gum a power gum or a ghost and will be set to 0 when is eaten by a ghost\n- \"highScore\" will stores the best score\n\nThe scores are represented by text marks:\n`","pinCode":false,"dname":"c2fd7302-6d7b-4c47-ae13-0bd456740599","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"[{\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":7, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":3, \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"yellow\"},\n          \"align\":{\"value\":\"center\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"14*sizeFactor\"}\n        },\n        \"update\":{\n          \"text\":{\"value\":\"score\"}\n        }\n      }\n    },\n    {\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":7, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":4, \"scale\":\"scaleY\"},\n          \"fill\":{\"value\":\"yellow\"},\n          \"align\":{\"value\":\"center\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"25*sizeFactor\"}\n        },\n        \"update\":{\n          \"text\":{\"signal\":\"score\"}\n        }\n      }\n    },\n    {\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":5, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":11, \"scale\":\"scaleY\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"lightblue\"},\n          \"align\":{\"value\":\"left\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"14*sizeFactor\"}\n        },\n        \"update\":{\n          \"opacity\":{\"signal\":\"highScore?1:0\"},\n          \"text\":{\"value\":\"high score\"}\n        }\n      }\n    },\n    {\n      \"type\":\"text\",\n      \"encode\":{\n        \"enter\":{\n          \"x\":{\"value\":8, \"scale\":\"scaleX\", \"offset\":{\"signal\":\"blockSize/2\"}},\n          \"y\":{\"value\":11, \"scale\":\"scaleY\",\"offset\":{\"signal\":\"blockSize/2\"}},\n          \"fill\":{\"value\":\"lightblue\"},\n          \"align\":{\"value\":\"center\"},\n          \"baseline\":{\"value\":\"middle\"},\n          \"fontSize\":{\"signal\":\"20*sizeFactor\"}\n        },\n        \"update\":{\n          \"opacity\":{\"signal\":\"highScore?1:0\"},\n          \"text\":{\"signal\":\"highScore\"}\n        }\n      }\n    }]","pinCode":false,"dname":"112a700b-b1b7-476f-9721-fabd7bd1f1e1","codeMode":"javascript2"}}},{"type":"codeTool","data":{"codeData":{"value":"md`The \"fontSize\" property is related to \"sizeFactor\" to ensure responsivity.\n\n## <a name=\"improvments\"></a>Possible Improvments\n\nHere are some ideas, for people who wants to improve the game.\n\n-\tThe IA could certainly be improved, and also individualized as in the original version\n-\tShould handle levels with different maze\n-\tCreate an animation when PacMan die\n-\tCreate a win animation\n-\tSupports PacMan lives`","pinCode":false,"dname":"529fee9f-1dfd-45b8-92e6-56511c289f4f","codeMode":"javascript2"}}}],"version":"2.19.1"}